import { db } from "./db";
import { ciphers, achievements, cosmetics, storyContent } from "@shared/schema";
import { caesarCipher, atbashCipher, vigenereCipher } from "./cipher-logic";

export async function seedDatabase() {
  const existingCiphers = await db.select().from(ciphers);
  if (existingCiphers.length === 0) {
    await seedAll();
  } else {
    const existingStory = await db.select().from(storyContent);
    if (existingStory.length === 0) {
      await seedStoryContent();
    } else {
      const cipherIds = [1, 2, 3];
      for (const cid of cipherIds) {
        const hasContent = existingStory.some((s: any) => s.cipherId === cid);
        if (!hasContent) {
          await seedStoryContentForCipher(cid);
        }
      }
    }
  }
}

async function seedAll() {

  await db.insert(ciphers).values([
    {
      name: "Caesar Cipher",
      description: "The classic shift cipher used by Julius Caesar. Shift each letter forward or backward by a fixed number.",
      isReleased: true,
      baseUnlockCost: 150,
    },
    {
      name: "Atbash Cipher",
      description: "A Hebrew cipher that reverses the alphabet. A becomes Z, B becomes Y, and so on.",
      isReleased: true,
      baseUnlockCost: 150,
    },
    {
      name: "Vigenère Cipher",
      description: "A polyalphabetic cipher using a keyword to shift letters by varying amounts.",
      isReleased: true,
      baseUnlockCost: 150,
    },
    {
      name: "Rail Fence Cipher",
      description: "A transposition cipher that writes the message in a zigzag pattern across multiple rails, then reads off each rail in order.",
      isReleased: false,
      baseUnlockCost: 150,
    },
    {
      name: "Playfair Cipher",
      description: "A digraph substitution cipher that encrypts pairs of letters using a 5x5 key square matrix.",
      isReleased: false,
      baseUnlockCost: 150,
    },
    {
      name: "Polybius Square",
      description: "An ancient Greek cipher that converts each letter into a pair of coordinates using a 5x5 grid.",
      isReleased: false,
      baseUnlockCost: 150,
    },
  ]);

  const achievementDefs = [
    { title: "Baby's First Shift", description: "Complete Caesar Story Chapter 1 Step 1", hint: "Follow the story and finish the very first interactive step.", difficulty: "Easy", conditionKey: "caesar_story_step_1", conditionValue: 1, sigilId: "sigil-baby-shift" },
    { title: "Et Tu, Tutorial?", description: "Finish Caesar Story Chapter 1 (all 10 steps)", hint: "Complete every step in Chapter 1.", difficulty: "Easy", conditionKey: "caesar_ch1_complete", conditionValue: 1, sigilId: "sigil-tutorial" },
    { title: "Coin Sprinkle", description: "Reach 200 total coins at any time", hint: "Save up… or win some points.", difficulty: "Easy", conditionKey: "coins_total", conditionValue: 200, sigilId: "sigil-coin" },
    { title: "Streak Peek", description: "Claim daily login reward 2 days in a row", hint: "Come back tomorrow.", difficulty: "Easy", conditionKey: "streak_count", conditionValue: 2, sigilId: "sigil-streak" },
    { title: "Right For Once", description: "Get 5 correct answers in Endless mode (any cipher)", hint: "Five clean hits. No panic typing.", difficulty: "Easy", conditionKey: "endless_correct_total", conditionValue: 5, sigilId: "sigil-target" },
    { title: "Caps Lock Champion", description: "Submit 10 answers in Endless mode", hint: "Doesn't matter if they're right. Just play.", difficulty: "Easy", conditionKey: "endless_total_submissions", conditionValue: 10, sigilId: "sigil-keyboard" },
    { title: "Roman Holiday Grind", description: "Earn 200 points total", hint: "Keep playing Endless.", difficulty: "Medium", conditionKey: "points_total", conditionValue: 200, sigilId: "sigil-grind" },
    { title: "Shift Happens", description: "Get a 10-correct streak in Endless (Caesar)", hint: "Ten in a row with Caesar.", difficulty: "Medium", conditionKey: "endless_streak_caesar", conditionValue: 10, sigilId: "sigil-flame" },
    { title: "Punctuation Paladin", description: "Correctly solve a challenge containing punctuation", hint: "Look for commas, periods… don't delete them.", difficulty: "Medium", conditionKey: "punctuation_solve", conditionValue: 1, sigilId: "sigil-punctuation" },
    { title: "Wallet Warrior", description: "Spend coins to unlock a released cipher", hint: "When a cipher is released, buy it for 150.", difficulty: "Medium", conditionKey: "unlock_via_coins", conditionValue: 1, sigilId: "sigil-wallet" },
    { title: "Token of My Appreciation", description: "Unlock a cipher using a free unlock token", hint: "Use a token instead of coins.", difficulty: "Medium", conditionKey: "unlock_via_token", conditionValue: 1, sigilId: "sigil-token" },
    { title: "Daily Ritualist", description: "Claim daily login reward 7 days in a row", hint: "Streak to 7.", difficulty: "Medium", conditionKey: "streak_count", conditionValue: 7, sigilId: "sigil-ritual" },
    { title: "Unbroken Chain", description: "25-correct streak in Endless (any unlocked cipher)", hint: "Don't miss.", difficulty: "Hard", conditionKey: "endless_streak_any", conditionValue: 25, sigilId: "sigil-chain" },
    { title: "Cipher Furnace", description: "Earn 1,000 points total", hint: "Long-term grind.", difficulty: "Hard", conditionKey: "points_total", conditionValue: 1000, sigilId: "sigil-furnace" },
    { title: "Zero Mercy", description: "Finish an Endless session of 20 questions with 0 wrong", hint: "Perfect 20.", difficulty: "Hard", conditionKey: "endless_perfect_20", conditionValue: 1, sigilId: "sigil-perfect" },
    { title: "Coin Architect", description: "Reach 1,000 coins total", hint: "Hoard respectfully.", difficulty: "Hard", conditionKey: "coins_total", conditionValue: 1000, sigilId: "sigil-architect" },
    { title: "Late-Night Legible", description: "Play Endless and get 10 correct after local midnight", hint: "Try again after midnight.", difficulty: "Hard", conditionKey: "late_night_correct", conditionValue: 10, sigilId: "sigil-moon" },
    { title: "Story Speedrunner", description: "Complete Caesar Chapter 1 in under 5 minutes", hint: "Read fast. Solve faster.", difficulty: "Hard", conditionKey: "story_speedrun", conditionValue: 1, sigilId: "sigil-speedrun" },
    { title: "Streak Royalty", description: "Reach a 14-day streak tier bonus", hint: "Two weeks of showing up.", difficulty: "Hard", conditionKey: "streak_count", conditionValue: 14, sigilId: "sigil-crown" },
    { title: "Ancient Accuracy", description: "Solve a decrypt challenge with shift 19 correctly (Caesar)", hint: "A very specific shift… think XIX.", difficulty: "Hard", conditionKey: "shift_19_decrypt", conditionValue: 1, sigilId: "sigil-ancient" },
  ];

  await db.insert(achievements).values(achievementDefs);

  const cosmeticDefs = [
    { type: "title", name: "Fresh Cipher", svgData: "", unlockCondition: "default", unlockValue: 0 },
    { type: "title", name: "Caesar's Apprentice", svgData: "", unlockCondition: "finish_caesar_ch1", unlockValue: 1 },
    { type: "title", name: "Point Hunter", svgData: "", unlockCondition: "200_points", unlockValue: 200 },
    { type: "title", name: "Streak Master", svgData: "", unlockCondition: "7_day_streak", unlockValue: 7 },
    { type: "title", name: "Cipher Legend", svgData: "", unlockCondition: "1000_points", unlockValue: 1000 },
    { type: "avatar", name: "Avatar 1", svgData: "1", unlockCondition: "default", unlockValue: 0 },
    { type: "avatar", name: "Avatar 2", svgData: "2", unlockCondition: "default", unlockValue: 0 },
    { type: "avatar", name: "Avatar 3", svgData: "3", unlockCondition: "default", unlockValue: 0 },
    { type: "avatar", name: "Avatar 4", svgData: "4", unlockCondition: "default", unlockValue: 0 },
    { type: "avatar", name: "Avatar 5", svgData: "5", unlockCondition: "default", unlockValue: 0 },
    { type: "frame", name: "Simple Circle", svgData: "1", unlockCondition: "default", unlockValue: 0 },
    { type: "frame", name: "Mystic Ring", svgData: "2", unlockCondition: "achievement_8", unlockValue: 8 },
    { type: "frame", name: "Rose Frame", svgData: "3", unlockCondition: "achievement_12", unlockValue: 12 },
    { type: "frame", name: "Diamond Frame", svgData: "4", unlockCondition: "achievement_13", unlockValue: 13 },
    { type: "frame", name: "Gradient Crown", svgData: "5", unlockCondition: "achievement_16", unlockValue: 16 },
  ];

  await db.insert(cosmetics).values(cosmeticDefs);

  await seedStoryContent();

  console.log("Database seeded successfully");
}

async function seedStoryContent(filterCipherId?: number) {
  const storySteps: Array<{
    cipherId: number;
    chapterNumber: number;
    chapterTitle?: string;
    stepNumber: number;
    storyText: string;
    taskType: string;
    taskPlaintext: string;
    taskShift: number;
    taskCiphertext: string;
    taskKeyword?: string;
    speaker: string;
    speakerAvatar: string;
    dialogueLines: { speaker: string; text: string; isUser?: boolean }[];
    responseChoices: { id: string; text: string; reaction: string }[];
    stepType: string;
  }> = [
    // ===== CAESAR CIPHER (cipherId: 1) - 10 Chapters =====


    // Chapter 1: The War Tent (shift 3, 10 steps)
    {
      cipherId: 1,
      chapterNumber: 1,
      chapterTitle: "The War Tent",
      stepNumber: 1,
      storyText: "Caesar welcomes you into his war tent and introduces the concept of shifting letters.",
      taskType: "encrypt",
      taskPlaintext: "ROME",
      taskShift: 3,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "General! Come closer. The lamplight is dim, but what I am about to show you will illuminate everything." },
        { speaker: "Caesar", text: "Our messengers are being intercepted by Gallic scouts. Every order we send is read by enemy eyes." },
        { speaker: "Caesar", text: "I have devised a method: shift every letter forward by a fixed number. With a shift of 3, A becomes D, B becomes E, C becomes F." },
        { speaker: "Caesar", text: "Try it yourself. Encrypt the word ROME with a shift of 3. Replace each letter with the one 3 positions ahead in the alphabet." },
      ],
      responseChoices: [
        { id: "c1ch1s1a", text: "I'm ready to learn, Caesar. Show me the way.", reaction: "Good. Eagerness is the first quality of a great soldier." },
        { id: "c1ch1s1b", text: "Shift letters? How does moving A to D help us?", reaction: "Because the enemy sees gibberish where we see orders. That is the power." },
        { id: "c1ch1s1c", text: "Can I just stab the Gallic scouts instead?", reaction: "Ha! I admire the spirit, but subtlety wins more wars than swords." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 1,
      chapterTitle: "The War Tent",
      stepNumber: 2,
      storyText: "Caesar reinforces the basics with another short encryption exercise.",
      taskType: "encrypt",
      taskPlaintext: "ARMY",
      taskShift: 3,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Well done! You shifted each letter forward by 3. The enemy would see nonsense where we see a city." },
        { speaker: "Caesar", text: "Let us practice once more. The key to mastery is repetition, General." },
        { speaker: "Caesar", text: "This time, encrypt the word ARMY. Same shift of 3. Each letter moves forward three places in the alphabet." },
      ],
      responseChoices: [
        { id: "c1ch1s2a", text: "Repetition builds instinct. Let me try again.", reaction: "Good. A soldier who practices once is learning. A soldier who practices twice is dangerous." },
        { id: "c1ch1s2b", text: "So A becomes D, R becomes U, and so on?", reaction: "Exactly. You are already thinking in shifted letters. That is progress." },
        { id: "c1ch1s2c", text: "I feel like I am back in school. Do I get a gold star?", reaction: "You get something better than a gold star. You get to not be killed by Gauls." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 1,
      chapterTitle: "The War Tent",
      stepNumber: 3,
      storyText: "Caesar tests a very short word to build confidence before introducing decryption.",
      taskType: "encrypt",
      taskPlaintext: "WAR",
      taskShift: 3,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "You are a natural, General. Most recruits fumble their first few attempts." },
        { speaker: "Caesar", text: "One more encryption before we move to the reverse operation. A short word this time." },
        { speaker: "Caesar", text: "Encrypt WAR with a shift of 3. Three letters, three shifts. Simple and quick." },
      ],
      responseChoices: [
        { id: "c1ch1s3a", text: "Short words are the building blocks. I will master each one.", reaction: "Precisely. And from these blocks, we will build an unbreakable wall of secrecy." },
        { id: "c1ch1s3b", text: "Is it always the same shift for every letter in the word?", reaction: "Yes. Every letter shifts by the same amount. That is the beauty of its simplicity." },
        { id: "c1ch1s3c", text: "WAR in three letters. Very on brand for Rome.", reaction: "We are efficient in all things, General. Even our vocabulary." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 1,
      chapterTitle: "The War Tent",
      stepNumber: 4,
      storyText: "Caesar introduces decryption by reversing the shift.",
      taskType: "decrypt",
      taskPlaintext: "MARCH",
      taskShift: 3,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Now the reverse. When we intercept an enemy message, we must decrypt it." },
        { speaker: "Caesar", text: "Decryption means shifting every letter backward by the same number. If the shift is 3, then D becomes A, E becomes B, and so on." },
        { speaker: "Caesar", text: "Think of it as undoing the lock. Encryption locks the message. Decryption unlocks it." },
        { speaker: "Caesar", text: "We intercepted this word from a Gallic courier. Shift of 3. Decrypt it and tell me what it says." },
      ],
      responseChoices: [
        { id: "c1ch1s4a", text: "Understood. Shift backward by 3. I will decode it now.", reaction: "Swift and decisive. Exactly what Rome needs." },
        { id: "c1ch1s4b", text: "So decryption is just encryption in reverse?", reaction: "Precisely. Every cipher hides a simple symmetry. Remember that." },
        { id: "c1ch1s4c", text: "What if I just guess? Could save time.", reaction: "Guessing is for gamblers. We are soldiers. Decode it properly." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 1,
      chapterTitle: "The War Tent",
      stepNumber: 5,
      storyText: "Caesar gives another decryption exercise to solidify the reverse operation.",
      taskType: "decrypt",
      taskPlaintext: "SWORD",
      taskShift: 3,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Excellent work. Decryption comes naturally to you." },
        { speaker: "Caesar", text: "Here is another intercepted word. Same shift of 3, same backward technique." },
        { speaker: "Caesar", text: "A good codebreaker must be equally skilled at encrypting and decrypting. Both halves of the same coin." },
        { speaker: "Caesar", text: "Decrypt this word. Our scouts need to know what weapon the enemy is rallying around." },
      ],
      responseChoices: [
        { id: "c1ch1s5a", text: "Encrypting and decrypting are two sides of one skill. I will master both.", reaction: "That balance is what separates a cipher clerk from a cipher master." },
        { id: "c1ch1s5b", text: "How do we know the enemy used a shift of 3?", reaction: "Our spies confirmed it. Intelligence and cryptography work hand in hand." },
        { id: "c1ch1s5c", text: "Another intercepted message? Our scouts are busy today.", reaction: "Busy scouts mean a safe general. Be grateful for their sweat." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 1,
      chapterTitle: "The War Tent",
      stepNumber: 6,
      storyText: "Caesar tests decryption of another word to push the player's growing skills.",
      taskType: "decrypt",
      taskPlaintext: "CAMP",
      taskShift: 3,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "You are progressing faster than any recruit I have trained, General." },
        { speaker: "Caesar", text: "One more decryption to prove your skill before we discuss a crucial detail about the alphabet." },
        { speaker: "Caesar", text: "Decrypt this intercepted word. Shift of 3, as before. Tell me where the enemy is gathering." },
      ],
      responseChoices: [
        { id: "c1ch1s6a", text: "I am finding a rhythm now. Each word comes easier than the last.", reaction: "That rhythm is the cipher becoming part of your instincts. Exactly what I want." },
        { id: "c1ch1s6b", text: "Will the shift always be 3?", reaction: "For now, yes. But soon we will explore other shifts. One must crawl before one conquers." },
        { id: "c1ch1s6c", text: "If I keep decrypting, do I eventually get promoted?", reaction: "Keep performing like this and you might get my job. Almost." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 1,
      chapterTitle: "The War Tent",
      stepNumber: 7,
      storyText: "Caesar explains wrapping: Z loops back to A when shifting forward.",
      taskType: "encrypt",
      taskPlaintext: "SPY",
      taskShift: 3,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "One crucial detail, General. The alphabet wraps around." },
        { speaker: "Caesar", text: "If you shift X by 3, you do not fall off the edge. You loop back to A. X becomes A, Y becomes B, Z becomes C." },
        { speaker: "Caesar", text: "Think of the alphabet as a circle, not a line. The end connects to the beginning." },
        { speaker: "Caesar", text: "Now encrypt SPY with a shift of 3. Watch how Y wraps around to B." },
      ],
      responseChoices: [
        { id: "c1ch1s7a", text: "A circular alphabet. Elegant and simple.", reaction: "Elegance is the hallmark of Roman engineering, in roads and in ciphers." },
        { id: "c1ch1s7b", text: "So there is no letter the cipher cannot handle?", reaction: "None. Every letter has a partner. That is what makes it complete." },
        { id: "c1ch1s7c", text: "My head is spinning in circles like this alphabet.", reaction: "Steady yourself. A dizzy codebreaker is a dangerous thing." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 1,
      chapterTitle: "The War Tent",
      stepNumber: 8,
      storyText: "Caesar reinforces wrapping with a decrypt that crosses the A-Z boundary.",
      taskType: "decrypt",
      taskPlaintext: "GATE",
      taskShift: 3,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Wrapping works in reverse too. When decrypting, if you shift backward past A, you loop to Z." },
        { speaker: "Caesar", text: "So if the ciphertext letter is B and the shift is 3, you go backward past A to reach Y." },
        { speaker: "Caesar", text: "The circle works in both directions. Forward for encryption, backward for decryption." },
        { speaker: "Caesar", text: "Decrypt this word. Shift of 3. Mind the wrapping." },
      ],
      responseChoices: [
        { id: "c1ch1s8a", text: "Forward or backward, the circle holds. I understand.", reaction: "Then you understand more than most tribunes learn in a month." },
        { id: "c1ch1s8b", text: "Does wrapping make the cipher harder to break?", reaction: "Not harder mathematically, but it ensures no letter is left unprotected. Completeness matters." },
        { id: "c1ch1s8c", text: "Circles, loops, wrapping... are we doing cryptography or knitting?", reaction: "Both require patience and precision, General. Now decrypt." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 1,
      chapterTitle: "The War Tent",
      stepNumber: 9,
      storyText: "Caesar gives a mixed test to check understanding of both encrypt and wrapping.",
      taskType: "encrypt",
      taskPlaintext: "FORT",
      taskShift: 3,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Let us test everything you have learned so far, General." },
        { speaker: "Caesar", text: "You know how to shift forward for encryption, shift backward for decryption, and wrap around the alphabet." },
        { speaker: "Caesar", text: "Encrypt this word. Shift of 3. Show me the basics are solid before we move to the field." },
      ],
      responseChoices: [
        { id: "c1ch1s9a", text: "The basics are solid. I am ready for the real thing.", reaction: "Good. The foundation must be strong before we build higher." },
        { id: "c1ch1s9b", text: "Will real missions be this straightforward?", reaction: "The method stays the same. Only the stakes change. Dramatically." },
        { id: "c1ch1s9c", text: "Another test? I was just getting comfortable.", reaction: "Comfort is the enemy of progress. Encrypt it." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 1,
      chapterTitle: "The War Tent",
      stepNumber: 10,
      storyText: "Caesar gives a final warm-up decryption challenge to complete training.",
      taskType: "decrypt",
      taskPlaintext: "GUARD",
      taskShift: 3,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "One final test, General. Prove you can handle anything I throw at you." },
        { speaker: "Caesar", text: "This message was found on a captured scout. Decrypt it. Shift of 3." },
        { speaker: "Caesar", text: "When you succeed, you will be ready for your first real mission beyond these tent walls." },
        { speaker: "Caesar", text: "Knowledge without practice is a sword without an edge. Show me your edge." },
      ],
      responseChoices: [
        { id: "c1ch1s10a", text: "I will not let you down, Caesar. The training ends here and the mission begins.", reaction: "That is the spirit of Rome speaking through you, General." },
        { id: "c1ch1s10b", text: "How long until I can encrypt without counting on my fingers?", reaction: "Practice, General. Soon the letters will shift in your mind like instinct." },
        { id: "c1ch1s10c", text: "A captured scout? I hope you offered him some water at least.", reaction: "We offered him a choice: talk or thirst. He chose wisely." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 2: The First Dispatch (shift 3-5, 10 steps)
    {
      cipherId: 1,
      chapterNumber: 2,
      chapterTitle: "The First Dispatch",
      stepNumber: 1,
      storyText: "Caesar sends you on your first real mission to deliver an encrypted dispatch.",
      taskType: "encrypt",
      taskPlaintext: "SEND",
      taskShift: 3,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Enough training in the tent. It is time for your first real mission, General." },
        { speaker: "Caesar", text: "Our garrison at the river crossing needs reinforcements, but the road is watched by enemy scouts." },
        { speaker: "Caesar", text: "You will carry this message yourself. Encrypt it with a shift of 3 so only our commander can read it." },
        { speaker: "Caesar", text: "Encrypt the word SEND. Our commander must know to dispatch riders at once." },
      ],
      responseChoices: [
        { id: "c1ch2s1a", text: "My first dispatch. I will not fail you, Caesar.", reaction: "I know you won't. That is why I chose you." },
        { id: "c1ch2s1b", text: "What happens if the message is intercepted?", reaction: "They will see meaningless letters. That is the beauty of our cipher." },
        { id: "c1ch2s1c", text: "Can I take the scenic route? I hear Gaul is lovely this time of year.", reaction: "Scenic routes get soldiers killed. Encrypt and ride fast." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 2,
      chapterTitle: "The First Dispatch",
      stepNumber: 2,
      storyText: "A reply arrives from the garrison. Caesar asks you to decrypt it.",
      taskType: "decrypt",
      taskPlaintext: "RIDE",
      taskShift: 3,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "A reply has arrived from the garrison commander. He used the same shift of 3." },
        { speaker: "Caesar", text: "In the field, speed matters more than complexity. A shared shift of 3 keeps things simple under pressure." },
        { speaker: "Caesar", text: "Decrypt his reply. I need to know what he is telling our cavalry to do." },
      ],
      responseChoices: [
        { id: "c1ch2s2a", text: "Speed and simplicity in the field. The cipher serves the mission.", reaction: "Exactly. A cipher that slows you down is worse than no cipher at all." },
        { id: "c1ch2s2b", text: "Does the entire garrison know the shift?", reaction: "Only the commander and his adjutant. The fewer who know, the safer the secret." },
        { id: "c1ch2s2c", text: "I hope the reply is not 'we surrender.'", reaction: "Roman garrisons do not surrender, General. They hold or they fall." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 2,
      chapterTitle: "The First Dispatch",
      stepNumber: 3,
      storyText: "Caesar sends an order to halt troop movements using the familiar shift.",
      taskType: "encrypt",
      taskPlaintext: "HALT",
      taskShift: 3,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Our scouts report enemy movement ahead. We must freeze our column in place." },
        { speaker: "Caesar", text: "Encrypt HALT with a shift of 3. This order must reach every unit before they advance into a trap." },
        { speaker: "Caesar", text: "In war, the ability to stop is as important as the ability to charge. Control wins battles." },
      ],
      responseChoices: [
        { id: "c1ch2s3a", text: "Control and discipline. The cipher enables both.", reaction: "A commander who cannot communicate securely cannot command at all." },
        { id: "c1ch2s3b", text: "What if the order arrives too late?", reaction: "Then men die. Which is why you must encrypt quickly and ride faster." },
        { id: "c1ch2s3c", text: "HALT? But I just got my horse warmed up.", reaction: "Your horse will thank you. The enemy ambush ahead would not." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 2,
      chapterTitle: "The First Dispatch",
      stepNumber: 4,
      storyText: "Caesar introduces the idea of changing shifts, using shift 4 for the first time.",
      taskType: "decrypt",
      taskPlaintext: "SCOUT",
      taskShift: 4,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "A new dispatch has arrived, General. But notice something different." },
        { speaker: "Caesar", text: "This message uses a shift of 4, not 3. The garrison commander changed the shift for security." },
        { speaker: "Caesar", text: "As long as both sides agree on the shift beforehand, any number from 1 to 25 will work. The method is the same." },
        { speaker: "Caesar", text: "Decrypt this word with a shift of 4. Tell me what the commander is requesting." },
      ],
      responseChoices: [
        { id: "c1ch2s4a", text: "A different shift adds another layer of security. Smart.", reaction: "Exactly. Predictability is the enemy of secrecy." },
        { id: "c1ch2s4b", text: "How do both sides agree on the new shift number?", reaction: "We establish it in person before the campaign begins. A shared secret between commanders." },
        { id: "c1ch2s4c", text: "Shift of 4? The commander is showing off.", reaction: "Ha! Perhaps. But a little ambition never hurt a cipher." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 2,
      chapterTitle: "The First Dispatch",
      stepNumber: 5,
      storyText: "Caesar sends tactical orders using the new shift of 4.",
      taskType: "encrypt",
      taskPlaintext: "FLANK",
      taskShift: 4,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "The enemy is moving faster than expected. We must adjust our tactics." },
        { speaker: "Caesar", text: "I want to send a flanking order to our cavalry. We will use the new shift of 4 for this dispatch." },
        { speaker: "Caesar", text: "Different shifts for different dispatches. If one is intercepted, the others remain safe." },
        { speaker: "Caesar", text: "Encrypt FLANK with a shift of 4. Speed is everything now." },
      ],
      responseChoices: [
        { id: "c1ch2s5a", text: "Compartmentalized shifts for compartmentalized security. I see the logic.", reaction: "You are beginning to think like a cryptographer, General." },
        { id: "c1ch2s5b", text: "Is a shift of 4 significantly harder to break than 3?", reaction: "Not much harder to brute-force. But every bit of confusion helps when time is short." },
        { id: "c1ch2s5c", text: "FLANK the enemy? I thought we were having a picnic.", reaction: "The only thing being served today is defeat, to our enemies." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 2,
      chapterTitle: "The First Dispatch",
      stepNumber: 6,
      storyText: "Caesar tests decryption with shift 4 on an intercepted enemy dispatch.",
      taskType: "decrypt",
      taskPlaintext: "READY",
      taskShift: 4,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Fortune smiles upon us! Our scouts captured an enemy rider carrying a sealed scroll." },
        { speaker: "Caesar", text: "It appears the Gauls have started using our own method against us. Flattering, if annoying." },
        { speaker: "Caesar", text: "Our analysts believe they used a shift of 4. Decrypt it and confirm their orders." },
      ],
      responseChoices: [
        { id: "c1ch2s6a", text: "They copied our cipher? We should take it as a compliment.", reaction: "Imitation is the sincerest form of flattery, and the most dangerous." },
        { id: "c1ch2s6b", text: "How did our analysts figure out the shift was 4?", reaction: "By trying each shift until one produced readable words. Brute but effective." },
        { id: "c1ch2s6c", text: "The Gauls are encrypting now? This war just got interesting.", reaction: "Wars are always interesting when both sides have secrets." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 2,
      chapterTitle: "The First Dispatch",
      stepNumber: 7,
      storyText: "Caesar increases the shift to 5 for higher-priority messages.",
      taskType: "encrypt",
      taskPlaintext: "HORSE",
      taskShift: 5,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "We need to requisition fresh mounts from the next town. This order uses a shift of 5." },
        { speaker: "Caesar", text: "Higher shifts make the ciphertext look less like the original. A shift of 1 is barely a disguise. A shift of 5 is a proper mask." },
        { speaker: "Caesar", text: "Each increase in shift pushes the letters further from recognition. The enemy must work harder to guess." },
        { speaker: "Caesar", text: "Encrypt HORSE with a shift of 5. Our cavalry depends on this message." },
      ],
      responseChoices: [
        { id: "c1ch2s7a", text: "Higher shifts, stronger disguise. The logic scales naturally.", reaction: "It does. Though remember, the method itself is what must remain secret." },
        { id: "c1ch2s7b", text: "Does a higher shift change the difficulty of decryption for us?", reaction: "Not at all. If you know the shift, decryption is equally simple regardless of the number." },
        { id: "c1ch2s7c", text: "Fresh horses? Can I request a chariot while we are at it?", reaction: "You get a horse, General. Chariots are for parades, not battlefields." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 2,
      chapterTitle: "The First Dispatch",
      stepNumber: 8,
      storyText: "Caesar sends orders about a river crossing with shift 5.",
      taskType: "encrypt",
      taskPlaintext: "RIVER",
      taskShift: 5,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "There is a river ahead. Crossing it will expose our column to enemy archers on the far bank." },
        { speaker: "Caesar", text: "We must coordinate with the garrison on the other side. They need to provide covering fire." },
        { speaker: "Caesar", text: "Encrypt RIVER with a shift of 5. The garrison will know exactly what we are planning." },
      ],
      responseChoices: [
        { id: "c1ch2s8a", text: "A single word tells them everything. Brevity is power.", reaction: "In military communication, every unnecessary word is a risk. Keep it lean." },
        { id: "c1ch2s8b", text: "What if they do not get the message in time?", reaction: "Then we cross under fire and hope for the best. Which is why encryption must be fast." },
        { id: "c1ch2s8c", text: "Can we just swim across and skip the encryption?", reaction: "In full armor? You would make an excellent anchor, General." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 2,
      chapterTitle: "The First Dispatch",
      stepNumber: 9,
      storyText: "Caesar sends orders to secure a bridge with shift 5.",
      taskType: "encrypt",
      taskPlaintext: "BRIDGE",
      taskShift: 5,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Our scouts have found a bridge upstream. If we secure it, we can cross without exposing the column." },
        { speaker: "Caesar", text: "Encrypt BRIDGE with a shift of 5. This order goes to our advance guard." },
        { speaker: "Caesar", text: "Notice how comfortable you are with the cipher now. Shift 3, 4, or 5, the method remains the same." },
        { speaker: "Caesar", text: "The shift changes. The technique does not. That is the elegance of this system." },
      ],
      responseChoices: [
        { id: "c1ch2s9a", text: "Same method, different shift. The system is adaptable.", reaction: "Adaptability is what makes this cipher useful across an entire empire." },
        { id: "c1ch2s9b", text: "How many different shifts can we use in a single campaign?", reaction: "As many as needed. Each unit, each day, each mission can have its own." },
        { id: "c1ch2s9c", text: "A bridge! Finally, something that does not involve swimming.", reaction: "Bridges are for strategists, General. Swimming is for fish." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 2,
      chapterTitle: "The First Dispatch",
      stepNumber: 10,
      storyText: "Caesar gives a final decrypt challenge to conclude the first dispatch mission.",
      taskType: "decrypt",
      taskPlaintext: "CROSS",
      taskShift: 5,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "A reply from the advance guard has arrived. Shift of 5, as agreed." },
        { speaker: "Caesar", text: "This is your final test for this mission, General. You have handled shifts of 3, 4, and 5 with ease." },
        { speaker: "Caesar", text: "Decrypt their response. I need to know if the bridge is secured and ready for the column." },
        { speaker: "Caesar", text: "After this, we head to the border. The real challenges begin." },
      ],
      responseChoices: [
        { id: "c1ch2s10a", text: "Three different shifts in one mission. I am ready for whatever comes next.", reaction: "And next comes the border, where the stakes are life and death." },
        { id: "c1ch2s10b", text: "Each new shift felt natural after the first. The system is elegant.", reaction: "That elegance is by design. Complexity without confusion. That is Roman engineering." },
        { id: "c1ch2s10c", text: "The border? I was hoping for a vacation.", reaction: "Your vacation is called 'not being captured by Gauls.' You are welcome." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 3: Scouts at the Border (shift 5-7, 10 steps)
    {
      cipherId: 1,
      chapterNumber: 3,
      chapterTitle: "Scouts at the Border",
      stepNumber: 1,
      storyText: "Caesar sends scouts into hostile territory with encrypted reports using shift 5.",
      taskType: "encrypt",
      taskPlaintext: "BORDER",
      taskShift: 5,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "We are deep in Gallic territory now. The border is a shifting line drawn in mud and blood." },
        { speaker: "Caesar", text: "I am sending scouts ahead to map enemy positions. Their reports must be encrypted." },
        { speaker: "Caesar", text: "We will use a shift of 5 for scouting reports. Different from our battle orders, so if one cipher is compromised, the other holds." },
        { speaker: "Caesar", text: "Encrypt BORDER with a shift of 5. This marks the extent of our patrol range." },
      ],
      responseChoices: [
        { id: "c1ch3s1a", text: "Using different shifts for different purposes. Brilliant compartmentalization.", reaction: "A breach in one channel should never sink the entire fleet. Remember that." },
        { id: "c1ch3s1b", text: "How many different shifts do we use across the army?", reaction: "Each legion has its own. That way, a captured scroll only compromises one unit." },
        { id: "c1ch3s1c", text: "Do the scouts get hazard pay for all this encryption?", reaction: "They get to serve Rome. That is payment enough. Now encrypt." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 3,
      chapterTitle: "Scouts at the Border",
      stepNumber: 2,
      storyText: "A scout's first report arrives and needs decryption.",
      taskType: "decrypt",
      taskPlaintext: "WATCH",
      taskShift: 5,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Our first scout has returned with a report. Encrypted with our agreed shift of 5." },
        { speaker: "Caesar", text: "Speed in decryption can save lives, General. Every moment you spend decoding is a moment the enemy could be moving." },
        { speaker: "Caesar", text: "Decrypt this report word. Tell me what our scouts have observed." },
      ],
      responseChoices: [
        { id: "c1ch3s2a", text: "Speed and accuracy. I will balance both.", reaction: "That balance is the mark of a true field cryptographer." },
        { id: "c1ch3s2b", text: "Are all scout reports just single words?", reaction: "In the field, yes. Single words are faster to encrypt, transmit, and decrypt. Efficiency saves lives." },
        { id: "c1ch3s2c", text: "One word? Scouts are not exactly verbose, are they?", reaction: "Brevity is a scout's greatest virtue. Right after not dying." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 3,
      chapterTitle: "Scouts at the Border",
      stepNumber: 3,
      storyText: "Caesar sends an urgent warning to the patrol line using shift 5.",
      taskType: "encrypt",
      taskPlaintext: "ENEMY",
      taskShift: 5,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "The scout's report confirms movement on the far side of the border. We must warn our patrol line." },
        { speaker: "Caesar", text: "Encrypt ENEMY with a shift of 5. Every patrol post must receive this warning before nightfall." },
        { speaker: "Caesar", text: "In scouting operations, the cipher is not just about secrecy. It is about trust. Our patrols trust that only genuine orders arrive encrypted." },
      ],
      responseChoices: [
        { id: "c1ch3s3a", text: "The cipher as authentication, not just secrecy. I had not considered that.", reaction: "A message without encryption could be a forgery. The cipher proves its origin." },
        { id: "c1ch3s3b", text: "Could an enemy forge an encrypted message?", reaction: "Only if they know the shift. Which is why we guard it with our lives." },
        { id: "c1ch3s3c", text: "Warning every patrol post before nightfall? I hope someone packed torches.", reaction: "Torches and fast horses. The twin tools of urgent communication." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 3,
      chapterTitle: "Scouts at the Border",
      stepNumber: 4,
      storyText: "Caesar increases the shift to 6 for higher-priority border communications.",
      taskType: "decrypt",
      taskPlaintext: "REPORT",
      taskShift: 6,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "A new dispatch from our northern outpost. This one uses a shift of 6." },
        { speaker: "Caesar", text: "I have assigned shift 6 to our border captains. It keeps their communications separate from the scouts." },
        { speaker: "Caesar", text: "Layers of shifts, layers of security. Each level has its own key." },
        { speaker: "Caesar", text: "Decrypt this report. The northern captain does not send messages lightly." },
      ],
      responseChoices: [
        { id: "c1ch3s4a", text: "Different shifts for different ranks. A layered system.", reaction: "Exactly. If a scout is captured, the captain's cipher remains safe." },
        { id: "c1ch3s4b", text: "How do the captains remember their assigned shifts?", reaction: "Memorization. The shift must never be written down. It lives only in the mind." },
        { id: "c1ch3s4c", text: "The northern captain never sends messages lightly? He sounds fun at parties.", reaction: "He is not invited to parties, General. He is invited to wars." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 3,
      chapterTitle: "Scouts at the Border",
      stepNumber: 5,
      storyText: "Caesar orders a signal word encrypted with shift 6 to coordinate patrols.",
      taskType: "encrypt",
      taskPlaintext: "SIGNAL",
      taskShift: 6,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "We need to coordinate a simultaneous patrol sweep along the border." },
        { speaker: "Caesar", text: "Each patrol post will receive the same encrypted word. When they decrypt it, they will know to begin the sweep." },
        { speaker: "Caesar", text: "Encrypt SIGNAL with a shift of 6. This single word synchronizes a hundred soldiers." },
        { speaker: "Caesar", text: "The power of encryption is not just hiding words. It is coordinating actions across distance." },
      ],
      responseChoices: [
        { id: "c1ch3s5a", text: "One encrypted word moves a hundred soldiers in unison. Remarkable.", reaction: "That is the true power of the cipher. Not secrecy alone, but coordinated action." },
        { id: "c1ch3s5b", text: "What if one patrol post misses the message?", reaction: "Then they do not sweep, and there is a gap. Which is why we send multiple riders." },
        { id: "c1ch3s5c", text: "A hundred soldiers, one word. Very efficient. Very Roman.", reaction: "Efficiency is the Roman virtue the world fears most." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 3,
      chapterTitle: "Scouts at the Border",
      stepNumber: 6,
      storyText: "An urgent scout report arrives encrypted with shift 6.",
      taskType: "decrypt",
      taskPlaintext: "AMBUSH",
      taskShift: 6,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "A scout has returned, wounded and breathless. He managed to scrawl a single encrypted word before collapsing." },
        { speaker: "Caesar", text: "The shift is 6. Whatever this says, it is urgent." },
        { speaker: "Caesar", text: "Decrypt it immediately, General. Lives may depend on what this word reveals." },
      ],
      responseChoices: [
        { id: "c1ch3s6a", text: "I will decode it at once. Every second counts.", reaction: "That sense of urgency will serve you well, General." },
        { id: "c1ch3s6b", text: "The scout was wounded? Is he going to be alright?", reaction: "He will live. But only if we act on his message fast enough." },
        { id: "c1ch3s6c", text: "The scout collapsed? I hope the medical tent has wine.", reaction: "Wine and bandages. The two pillars of Roman field medicine." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 3,
      chapterTitle: "Scouts at the Border",
      stepNumber: 7,
      storyText: "Caesar raises the shift to 7 for emergency border communications.",
      taskType: "encrypt",
      taskPlaintext: "PATROL",
      taskShift: 7,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "The ambush report changes everything. We are raising the alert level across the border." },
        { speaker: "Caesar", text: "From now on, all emergency communications use a shift of 7. Higher urgency, higher shift." },
        { speaker: "Caesar", text: "This way, even if someone captures a routine message with shift 5 or 6, they cannot read our emergency orders." },
        { speaker: "Caesar", text: "Encrypt PATROL with a shift of 7. Every unit must increase their vigilance immediately." },
      ],
      responseChoices: [
        { id: "c1ch3s7a", text: "Different shifts signal different urgency levels. The cipher carries two messages.", reaction: "Exactly. The words are the message. The shift is the context." },
        { id: "c1ch3s7b", text: "How do all units know to switch to shift 7?", reaction: "A pre-arranged code phrase sent in person at the start of each campaign. Analog backup for digital security." },
        { id: "c1ch3s7c", text: "Higher urgency, higher shift. At this rate shift 25 means the world is ending.", reaction: "If we reach shift 25, it very well might be. Encrypt now, joke later." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 3,
      chapterTitle: "Scouts at the Border",
      stepNumber: 8,
      storyText: "An emergency report arrives encrypted with shift 7.",
      taskType: "decrypt",
      taskPlaintext: "DANGER",
      taskShift: 7,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Another emergency dispatch. Shift of 7, our highest border alert code." },
        { speaker: "Caesar", text: "Notice how the shift has increased as the situation grew more serious. From 5 to 6 to 7." },
        { speaker: "Caesar", text: "Each shift tells a story beyond the letters. Context, urgency, authority. The cipher speaks volumes." },
        { speaker: "Caesar", text: "Decrypt this at once. I need to know what our patrols have found." },
      ],
      responseChoices: [
        { id: "c1ch3s8a", text: "The shift as metadata. Clever and efficient.", reaction: "You are thinking at the system level now. That is where true mastery lives." },
        { id: "c1ch3s8b", text: "Does the enemy understand our shift-urgency system?", reaction: "If they did, the shifts themselves would reveal our state of readiness. Another layer to protect." },
        { id: "c1ch3s8c", text: "Three shifts in one chapter? My fingers are getting a workout.", reaction: "Strong fingers, strong empire. Welcome to border duty." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 3,
      chapterTitle: "Scouts at the Border",
      stepNumber: 9,
      storyText: "Caesar sends orders to the northern garrison using shift 7.",
      taskType: "encrypt",
      taskPlaintext: "NORTH",
      taskShift: 7,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "The northern border is the most vulnerable. I am redirecting reinforcements there." },
        { speaker: "Caesar", text: "Encrypt NORTH with a shift of 7. Our commanders will know exactly where to focus their defenses." },
        { speaker: "Caesar", text: "You have now worked with shifts 5, 6, and 7 in a single operation. Each one serving a different purpose within the same system." },
      ],
      responseChoices: [
        { id: "c1ch3s9a", text: "Multiple shifts in one operation. The system scales beautifully.", reaction: "And that scalability is what allows Rome to manage borders spanning thousands of miles." },
        { id: "c1ch3s9b", text: "Is there a limit to how many different shifts we can use?", reaction: "Twenty-five possible shifts. More than enough for any campaign." },
        { id: "c1ch3s9c", text: "The north again. I am starting to think the Gauls have a favorite direction.", reaction: "They follow the sun, General. Unfortunately, so do we." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 3,
      chapterTitle: "Scouts at the Border",
      stepNumber: 10,
      storyText: "Caesar gives a final shift-7 decryption challenge to conclude the border mission.",
      taskType: "decrypt",
      taskPlaintext: "ALERT",
      taskShift: 7,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "One final report from the border. Our outermost patrol has sent an encrypted word." },
        { speaker: "Caesar", text: "Shift of 7. Emergency priority. Decrypt it and tell me the status of our perimeter." },
        { speaker: "Caesar", text: "After this, we leave the border behind. The roads of the empire await, and with them, greater distances and greater shifts." },
        { speaker: "Caesar", text: "You have proven yourself at the border. Now prove yourself across the empire." },
      ],
      responseChoices: [
        { id: "c1ch3s10a", text: "From the border to the empire. Each chapter raises the stakes.", reaction: "And with higher stakes come higher shifts. The cipher grows with the challenge." },
        { id: "c1ch3s10b", text: "Greater distances mean more opportunities for interception. The cipher becomes even more critical.", reaction: "You understand perfectly. Distance is the cipher's truest test." },
        { id: "c1ch3s10c", text: "Greater shifts? My alphabet wheel is going to need an upgrade.", reaction: "Your mind is the only wheel you need, General. Keep it sharp." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 4: Roads of the Empire (shift 7-10, 10 steps)
    {
      cipherId: 1,
      chapterNumber: 4,
      chapterTitle: "Roads of the Empire",
      stepNumber: 1,
      storyText: "Caesar explains why encryption matters across the vast Roman road network.",
      taskType: "encrypt",
      taskPlaintext: "LEGION",
      taskShift: 7,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Rome's roads stretch from Britannia to Syria. Thousands of miles of stone and ambition." },
        { speaker: "Caesar", text: "A message from Rome to our eastern provinces takes weeks. It passes through dozens of hands along the way." },
        { speaker: "Caesar", text: "Any one of those hands could be a spy. The cipher is our shield across distance." },
        { speaker: "Caesar", text: "Encrypt LEGION with a shift of 7. This order must travel safely to the eastern frontier." },
      ],
      responseChoices: [
        { id: "c1ch4s1a", text: "The longer the road, the greater the need for encryption.", reaction: "Precisely. Distance multiplies vulnerability. The cipher compensates." },
        { id: "c1ch4s1b", text: "Can a message really survive weeks of travel undetected?", reaction: "With encryption, it does not matter if it is detected. Only if it is understood." },
        { id: "c1ch4s1c", text: "Thousands of miles? Can we not just shout really loudly?", reaction: "If your voice carries from Rome to Syria, I will promote you immediately." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 4,
      chapterTitle: "Roads of the Empire",
      stepNumber: 2,
      storyText: "A provincial governor sends an encrypted report. Decrypt it with shift 8.",
      taskType: "decrypt",
      taskPlaintext: "TRADE",
      taskShift: 8,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "A dispatch has arrived from the governor of Hispania. Encrypted with a shift of 8." },
        { speaker: "Caesar", text: "Our provincial governors each use a unique shift assigned to them. Hispania uses 8, Egypt uses 12, Britannia uses 15." },
        { speaker: "Caesar", text: "This way, if one governor's shift is compromised, the others remain secure." },
        { speaker: "Caesar", text: "Decrypt this report. I suspect it concerns the trade routes." },
      ],
      responseChoices: [
        { id: "c1ch4s2a", text: "Assigning unique shifts to each province is a sound strategy.", reaction: "It is how we manage an empire, General. Through systems, not just strength." },
        { id: "c1ch4s2b", text: "How do you keep track of which province uses which shift?", reaction: "A master ledger, kept in a vault beneath my private chambers. Only two people know the combination." },
        { id: "c1ch4s2c", text: "Hispania, Egypt, Britannia... do we own everything?", reaction: "Not yet. But we are working on it." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 4,
      chapterTitle: "Roads of the Empire",
      stepNumber: 3,
      storyText: "Caesar sends orders to a distant outpost using shift 8.",
      taskType: "encrypt",
      taskPlaintext: "BRIDGE",
      taskShift: 8,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "There is a strategic bridge on the Rhine that must be held at all costs." },
        { speaker: "Caesar", text: "The message will take five days to reach the garrison. Five days of vulnerability on the road." },
        { speaker: "Caesar", text: "With a shift of 8, the ciphertext is deeply transformed. The original letters are well disguised." },
        { speaker: "Caesar", text: "Encrypt BRIDGE. That single word tells our commander exactly which position to fortify." },
      ],
      responseChoices: [
        { id: "c1ch4s3a", text: "A single encrypted word can carry an entire tactical order. Efficient.", reaction: "Brevity is security. The fewer letters, the fewer clues for the enemy." },
        { id: "c1ch4s3b", text: "Why not send a longer, more detailed message?", reaction: "Because every extra letter is another opportunity for the enemy to find patterns. Keep it short." },
        { id: "c1ch4s3c", text: "Five days on the road? I hope the rider packed snacks.", reaction: "Roman riders carry dried meat and determination. Both last long enough." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 4,
      chapterTitle: "Roads of the Empire",
      stepNumber: 4,
      storyText: "Caesar discusses the empire's infrastructure while testing decryption with shift 8.",
      taskType: "decrypt",
      taskPlaintext: "EMPIRE",
      taskShift: 8,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "The roads are the arteries of the empire. Without them, orders would never reach the frontiers." },
        { speaker: "Caesar", text: "And without encryption, those orders would be read by every bandit and spy along the way." },
        { speaker: "Caesar", text: "A message has arrived from the road commissioner. Shift of 8. Decrypt it." },
        { speaker: "Caesar", text: "The roads carry our words. The cipher protects their meaning." },
      ],
      responseChoices: [
        { id: "c1ch4s4a", text: "Roads and ciphers. The twin pillars of imperial communication.", reaction: "You see the big picture, General. Infrastructure and security, inseparable." },
        { id: "c1ch4s4b", text: "How many messages travel the roads each day?", reaction: "Hundreds. And every one of strategic importance must be encrypted." },
        { id: "c1ch4s4c", text: "Road commissioner? That sounds like the least exciting job in Rome.", reaction: "Until a road fails and an army is stranded. Then it becomes very exciting indeed." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 4,
      chapterTitle: "Roads of the Empire",
      stepNumber: 5,
      storyText: "Caesar sends supply orders using shift 9.",
      taskType: "encrypt",
      taskPlaintext: "ROAD",
      taskShift: 9,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "We are moving to shift 9 now. The further a message travels, the higher the shift I prefer." },
        { speaker: "Caesar", text: "A shift of 9 means each letter jumps nearly a third of the alphabet. The transformation is significant." },
        { speaker: "Caesar", text: "Encrypt ROAD with a shift of 9. Our supply convoys need to know which route is safe." },
      ],
      responseChoices: [
        { id: "c1ch4s5a", text: "Higher shifts for longer distances. A practical rule of thumb.", reaction: "Practical rules win wars, General. Theories win debates." },
        { id: "c1ch4s5b", text: "Does a shift of 9 make brute-force attacks harder?", reaction: "Not mathematically. But it increases the time an interceptor needs. And time is our ally." },
        { id: "c1ch4s5c", text: "Supply convoys? Less glamorous than battles but equally important.", reaction: "An army marches on its stomach, General. Logistics is the secret war behind every war." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 4,
      chapterTitle: "Roads of the Empire",
      stepNumber: 6,
      storyText: "A message about supply lines arrives encrypted with shift 9.",
      taskType: "decrypt",
      taskPlaintext: "SUPPLY",
      taskShift: 9,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "An urgent message from our quartermaster. Shift of 9, as per our eastern province protocol." },
        { speaker: "Caesar", text: "The higher the shift, the more the letters transform. With shift 9, A becomes J. The original is deeply buried." },
        { speaker: "Caesar", text: "But for us, with the key in hand, it is still just counting backward. Decrypt it." },
      ],
      responseChoices: [
        { id: "c1ch4s6a", text: "The key makes all the difference. Without it, chaos. With it, clarity.", reaction: "That is the fundamental truth of all cryptography. The key is everything." },
        { id: "c1ch4s6b", text: "Counting backward by 9 is getting more challenging.", reaction: "It is. But your mind is sharpening with each word. That is the point of practice." },
        { id: "c1ch4s6c", text: "The quartermaster sends encrypted supply lists? Very thorough.", reaction: "Thorough quartermasters keep armies alive. I pay them well." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 4,
      chapterTitle: "Roads of the Empire",
      stepNumber: 7,
      storyText: "Caesar increases to shift 10 for the most sensitive imperial communications.",
      taskType: "encrypt",
      taskPlaintext: "SHIELD",
      taskShift: 10,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "We now reach shift 10, General. A becomes K. The original letters are deeply buried." },
        { speaker: "Caesar", text: "With higher shifts, the transformation is more dramatic. Each letter is pushed far from its original position." },
        { speaker: "Caesar", text: "This level of shift is reserved for the most sensitive imperial communications." },
        { speaker: "Caesar", text: "Encrypt SHIELD with a shift of 10. This order protects the entire eastern flank." },
      ],
      responseChoices: [
        { id: "c1ch4s7a", text: "Shift 10 pushes letters far from recognition. A strong disguise.", reaction: "Strong enough to buy us time, which is all a field cipher needs to do." },
        { id: "c1ch4s7b", text: "Is there a point where the shift is too high to be practical?", reaction: "Not for single words. The method stays simple regardless of the shift number." },
        { id: "c1ch4s7c", text: "The eastern flank? How many flanks does this empire have?", reaction: "As many as there are enemies, General. Which is to say, quite a few." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 4,
      chapterTitle: "Roads of the Empire",
      stepNumber: 8,
      storyText: "An urgent message from Britannia arrives encrypted with shift 10.",
      taskType: "decrypt",
      taskPlaintext: "REVOLT",
      taskShift: 10,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Troubling news from the north. A rider has arrived from Britannia, half-dead from the journey." },
        { speaker: "Caesar", text: "He carried a single encrypted word. Shift of 10, our emergency code for the British garrison." },
        { speaker: "Caesar", text: "With shift 10, A becomes K. The original letters are deeply buried in the ciphertext." },
        { speaker: "Caesar", text: "Decrypt this at once. The fate of our northern territories may rest on this single word." },
      ],
      responseChoices: [
        { id: "c1ch4s8a", text: "The higher the shift, the deeper the disguise. I will uncover it.", reaction: "That determination is why I trust you with Rome's secrets." },
        { id: "c1ch4s8b", text: "Shift of 10 makes the letters almost unrecognizable. Impressive.", reaction: "That is the point. Even a literate spy sees only chaos." },
        { id: "c1ch4s8c", text: "Half-dead rider? We really need to invest in better horses.", reaction: "Or shorter empires. But where is the glory in that?" },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 4,
      chapterTitle: "Roads of the Empire",
      stepNumber: 9,
      storyText: "Caesar sends a response back to Britannia using shift 10.",
      taskType: "encrypt",
      taskPlaintext: "HOLD",
      taskShift: 10,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "We cannot send reinforcements for two weeks. The garrison must stand firm." },
        { speaker: "Caesar", text: "Sometimes the most powerful message is the simplest. A single word of command." },
        { speaker: "Caesar", text: "Encrypt HOLD with a shift of 10. Our commander in Britannia will understand exactly what is expected." },
        { speaker: "Caesar", text: "This is the essence of military encryption: clarity for allies, confusion for enemies." },
      ],
      responseChoices: [
        { id: "c1ch4s9a", text: "One word, fully encrypted. Maximum impact, minimum risk.", reaction: "You understand the philosophy of field encryption perfectly, General." },
        { id: "c1ch4s9b", text: "Will a single word be enough to inspire them?", reaction: "When that word comes from Caesar, it carries the weight of Rome itself." },
        { id: "c1ch4s9c", text: "HOLD? I would have sent PANIC.", reaction: "And that, General, is why I write the orders and you encrypt them." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 4,
      chapterTitle: "Roads of the Empire",
      stepNumber: 10,
      storyText: "Caesar gives a final shift 10 challenge to conclude the empire roads chapter.",
      taskType: "decrypt",
      taskPlaintext: "HARBOR",
      taskShift: 10,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "One final message from the empire's network. A coastal garrison has sent an encrypted report." },
        { speaker: "Caesar", text: "Shift of 10. You have handled shifts from 7 to 10 across this chapter. The range of an empire." },
        { speaker: "Caesar", text: "Decrypt their report. I need to know the status of our Mediterranean ports." },
        { speaker: "Caesar", text: "After this, we return to Rome itself. The Senate awaits, and with it, a very different kind of war." },
      ],
      responseChoices: [
        { id: "c1ch4s10a", text: "From border to empire to Senate. Each arena demands its own level of secrecy.", reaction: "And the Senate is the most treacherous arena of all. Prepare yourself." },
        { id: "c1ch4s10b", text: "Shifts 7 through 10. The empire's communication backbone.", reaction: "And you are now part of that backbone. Rome's secrets travel safely through your hands." },
        { id: "c1ch4s10c", text: "The Senate? I was hoping for something less terrifying than politics.", reaction: "I would rather face a Gallic horde than a Senate committee. And I have faced both." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 5: Senate Shadows (shift 10-13, 10 steps)
    {
      cipherId: 1,
      chapterNumber: 5,
      chapterTitle: "Senate Shadows",
      stepNumber: 1,
      storyText: "Caesar reveals that political enemies in the Senate require a different kind of secrecy.",
      taskType: "encrypt",
      taskPlaintext: "SENATE",
      taskShift: 10,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Not all wars are fought on battlefields, General. Some are fought in marble halls with whispered words." },
        { speaker: "Caesar", text: "The Senate is full of men who smile to my face and plot behind my back. I need eyes and ears among them." },
        { speaker: "Caesar", text: "For political messages, we use higher shifts. The stakes are different. Exposure here means not death, but disgrace." },
        { speaker: "Caesar", text: "Encrypt SENATE with a shift of 10. My informant will know how to read it." },
      ],
      responseChoices: [
        { id: "c1ch5s1a", text: "Politics is a battlefield of its own. I understand the need.", reaction: "You see clearly, General. The Senate floor is as treacherous as any frontier." },
        { id: "c1ch5s1b", text: "Why not just confront the plotters directly?", reaction: "Because in politics, the moment you reveal what you know, you lose the advantage." },
        { id: "c1ch5s1c", text: "Can we just dissolve the Senate? Seems easier.", reaction: "Tempting. But even dictators need to maintain appearances. For now." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 5,
      chapterTitle: "Senate Shadows",
      stepNumber: 2,
      storyText: "An informant sends an encrypted warning about a conspiracy.",
      taskType: "decrypt",
      taskPlaintext: "PLOT",
      taskShift: 10,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "My informant in the Senate has sent an urgent message. Encrypted with a shift of 10." },
        { speaker: "Caesar", text: "He uses the same shift as our eastern provinces. Smart. It blends his messages with routine military traffic." },
        { speaker: "Caesar", text: "Decrypt this warning. I need to know what the conspirators are planning." },
      ],
      responseChoices: [
        { id: "c1ch5s2a", text: "Hiding political messages among military traffic. Clever misdirection.", reaction: "The best hiding place is in plain sight, buried among thousands of similar-looking dispatches." },
        { id: "c1ch5s2b", text: "How does the informant send messages without being noticed?", reaction: "He passes them to a trusted courier disguised as routine Senate business. Layers within layers." },
        { id: "c1ch5s2c", text: "Senate conspirators? Sounds like a bad play.", reaction: "If only it were fiction. Unfortunately, the daggers in the Senate are quite real." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 5,
      chapterTitle: "Senate Shadows",
      stepNumber: 3,
      storyText: "Caesar sends instructions to a trusted ally using shift 11.",
      taskType: "encrypt",
      taskPlaintext: "ALLY",
      taskShift: 11,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "I need to send word to my most trusted supporter in the Senate. We will use a shift of 11." },
        { speaker: "Caesar", text: "I change shifts regularly with my political contacts. If the same shift is used too often, patterns emerge." },
        { speaker: "Caesar", text: "This is an important lesson: security through obscurity has limits. A cipher is only as strong as its secrecy." },
        { speaker: "Caesar", text: "Encrypt ALLY with a shift of 11. He will know what to do." },
      ],
      responseChoices: [
        { id: "c1ch5s3a", text: "Changing shifts regularly is wise. Patterns are the enemy of secrecy.", reaction: "Precisely. A predictable cipher is a broken cipher, no matter the shift." },
        { id: "c1ch5s3b", text: "What do you mean by security through obscurity?", reaction: "Hiding the method is not enough. If the enemy learns the shift, everything falls." },
        { id: "c1ch5s3c", text: "Your most trusted supporter? How many do you have?", reaction: "Fewer than I would like. Which is why each one is precious." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 5,
      chapterTitle: "Senate Shadows",
      stepNumber: 4,
      storyText: "A secret message reveals dangerous political maneuvering.",
      taskType: "decrypt",
      taskPlaintext: "DANGER",
      taskShift: 11,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Another message from the shadows. This one uses shift 11, our current political cipher." },
        { speaker: "Caesar", text: "The informant has been changing shifts with each message. 10, now 11. Unpredictability keeps him safe." },
        { speaker: "Caesar", text: "Decrypt it quickly, General. The political winds shift faster than any cipher." },
      ],
      responseChoices: [
        { id: "c1ch5s4a", text: "Rotating shifts add a layer of temporal security. Each message is unique.", reaction: "Exactly. Even if one message is compromised, the next uses a different key." },
        { id: "c1ch5s4b", text: "How does the informant tell you which shift he used?", reaction: "A pre-arranged sequence. We agreed on a pattern of shifts before the operation began." },
        { id: "c1ch5s4c", text: "Political winds and shifting ciphers. Rome is exhausting.", reaction: "Rome is eternal, General. But it does demand constant vigilance." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 5,
      chapterTitle: "Senate Shadows",
      stepNumber: 5,
      storyText: "Caesar sends a decree to a loyal consul using shift 11.",
      taskType: "encrypt",
      taskPlaintext: "CONSUL",
      taskShift: 11,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "I need to send a private message to a consul who has remained loyal through the conspiracy." },
        { speaker: "Caesar", text: "The consul will receive this and know to block a vote that would strip my command." },
        { speaker: "Caesar", text: "Encrypt CONSUL with a shift of 11. In the Senate, a single vote can change the course of an empire." },
        { speaker: "Caesar", text: "In politics, secrecy is not just useful. It is survival." },
      ],
      responseChoices: [
        { id: "c1ch5s5a", text: "Political encryption to protect political alliances. A different kind of warfare.", reaction: "The deadliest kind. Swords leave scars. Senate votes leave ruins." },
        { id: "c1ch5s5b", text: "Can a single vote really threaten your command?", reaction: "A single vote can topple a dictator, General. Never underestimate the Senate." },
        { id: "c1ch5s5c", text: "Blocking votes through encrypted messages? Democracy is complicated.", reaction: "Democracy is a battlefield with rules. I merely play by them. Mostly." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 5,
      chapterTitle: "Senate Shadows",
      stepNumber: 6,
      storyText: "A spy's message reveals the conspirators are growing bolder. Shift 12.",
      taskType: "decrypt",
      taskPlaintext: "BETRAY",
      taskShift: 12,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Our spy has sent another report. The shift has increased to 12. He feels the noose tightening." },
        { speaker: "Caesar", text: "A higher shift from our informant means higher danger. He is using the escalation protocol we established." },
        { speaker: "Caesar", text: "Decrypt this at once. The conspirators grow bolder with each passing day." },
        { speaker: "Caesar", text: "Notice we are now at shift 12. Nearly half the alphabet. The disguise is deep." },
      ],
      responseChoices: [
        { id: "c1ch5s6a", text: "Shift 12. The letters are transformed almost beyond recognition.", reaction: "Almost. But 'almost' is not 'completely.' The key still unlocks everything." },
        { id: "c1ch5s6b", text: "If the spy feels the noose, should we extract him?", reaction: "Not yet. His information is too valuable. But we will be ready if needed." },
        { id: "c1ch5s6c", text: "The conspirators grow bolder? Perhaps they need a strongly worded letter.", reaction: "They will get more than words if I have anything to say about it." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 5,
      chapterTitle: "Senate Shadows",
      stepNumber: 7,
      storyText: "Caesar introduces shift 12 encryption and explains we approach the special ROT13.",
      taskType: "encrypt",
      taskPlaintext: "DECREE",
      taskShift: 12,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "We use shift 12 now for our Senate operations. One more step and we reach something special." },
        { speaker: "Caesar", text: "A shift of 13 splits the alphabet exactly in half. But we are not there yet. First, master 12." },
        { speaker: "Caesar", text: "Encrypt DECREE with a shift of 12. I must issue an official order through unofficial channels." },
        { speaker: "Caesar", text: "The irony of a decree delivered in secret is not lost on me, General." },
      ],
      responseChoices: [
        { id: "c1ch5s7a", text: "Approaching shift 13. I can sense something important ahead.", reaction: "Your instincts are sharp. Shift 13 has a property unlike any other." },
        { id: "c1ch5s7b", text: "What makes shift 13 special?", reaction: "Patience, General. One more step and I will reveal its secret." },
        { id: "c1ch5s7c", text: "A secret decree? That is peak Roman bureaucracy.", reaction: "Bureaucracy keeps the empire running. Secrecy keeps the bureaucrats alive." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 5,
      chapterTitle: "Senate Shadows",
      stepNumber: 8,
      storyText: "Caesar explains the special property of shift 13 (ROT13).",
      taskType: "decrypt",
      taskPlaintext: "POWER",
      taskShift: 13,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Now we reach shift 13. This number is special, General. It splits the alphabet exactly in half." },
        { speaker: "Caesar", text: "With shift 13, A becomes N and N becomes A. Encryption and decryption become the same operation." },
        { speaker: "Caesar", text: "Apply the cipher once to encrypt. Apply it again to decrypt. The same key works both ways." },
        { speaker: "Caesar", text: "Some would later call this ROT13. But I called it first. Naturally." },
        { speaker: "Caesar", text: "Decrypt this word with shift 13. Notice how the operation feels identical to encryption." },
      ],
      responseChoices: [
        { id: "c1ch5s8a", text: "Shift 13 is self-reciprocal. Encrypt and decrypt are the same. Fascinating.", reaction: "It means the sender and receiver need only remember one operation. Elegant." },
        { id: "c1ch5s8b", text: "So with shift 13, encrypting twice gives you the original?", reaction: "Exactly. Apply the cipher twice and you are back where you started. A perfect mirror." },
        { id: "c1ch5s8c", text: "ROT13? Is that a type of cheese?", reaction: "It is a type of genius, General. My genius, specifically." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 5,
      chapterTitle: "Senate Shadows",
      stepNumber: 9,
      storyText: "Caesar uses shift 13 to send a message about the political power struggle.",
      taskType: "encrypt",
      taskPlaintext: "THRONE",
      taskShift: 13,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "With ROT13, I can send a message and the recipient decrypts it using the exact same process. No confusion possible." },
        { speaker: "Caesar", text: "For the most sensitive political messages, this symmetry is invaluable. One operation to rule them all." },
        { speaker: "Caesar", text: "Encrypt THRONE with a shift of 13. The question of who sits upon it consumes the Senate." },
      ],
      responseChoices: [
        { id: "c1ch5s9a", text: "One operation for both encryption and decryption. Maximum simplicity.", reaction: "In a world of complexity, simplicity is the ultimate sophistication." },
        { id: "c1ch5s9b", text: "Does the symmetry of ROT13 make it easier to break?", reaction: "Not harder or easier than any other shift. But it is easier to use, which means fewer errors." },
        { id: "c1ch5s9c", text: "The THRONE? Are we encrypting or playing a board game?", reaction: "In Rome, the throne is the ultimate board game. And every senator is a player." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 5,
      chapterTitle: "Senate Shadows",
      stepNumber: 10,
      storyText: "Caesar gives a final shift 13 decryption challenge to conclude the Senate chapter.",
      taskType: "decrypt",
      taskPlaintext: "SHADOW",
      taskShift: 13,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "One final message from the Senate's underbelly. Shift of 13. Our ROT13 code." },
        { speaker: "Caesar", text: "You have navigated the shadows of Roman politics with the same skill you showed on the battlefield." },
        { speaker: "Caesar", text: "Decrypt this word. It describes what lurks behind every smile in the Senate." },
        { speaker: "Caesar", text: "From shift 3 in the war tent to shift 13 in the Senate. You have come far, General." },
        { speaker: "Caesar", text: "The shadows will always be there. But now you have the cipher to see through them." },
      ],
      responseChoices: [
        { id: "c1ch5s10a", text: "From battlefields to politics, the cipher has been my constant companion.", reaction: "And it always will be. The cipher is your torch in every dark corridor of power." },
        { id: "c1ch5s10b", text: "Shift 3 to shift 13. Each chapter taught me something new about secrecy.", reaction: "And the lessons are not over. There are more shifts, more secrets, more challenges ahead." },
        { id: "c1ch5s10c", text: "Senate shadows? I think I prefer the Gauls. At least they are honest about wanting to fight.", reaction: "An honest enemy is a luxury, General. In Rome, luxury is in short supply." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 6: The Rubicon Crossing (shift 13-16, 10 steps)
    {
      cipherId: 1,
      chapterNumber: 6,
      chapterTitle: "The Rubicon Crossing",
      stepNumber: 1,
      storyText: "Caesar stands at the Rubicon river. The army gathers behind him, awaiting the order that will change history.",
      taskType: "encrypt",
      taskPlaintext: "CROSS",
      taskShift: 13,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "We stand at the banks of the Rubicon, General. Beyond this river lies Rome itself." },
        { speaker: "Caesar", text: "No general may cross this boundary with an army. To do so is to declare war on the Republic." },
        { speaker: "Caesar", text: "Alea iacta est. The die is cast. But before we move, our allies must know our intent." },
        { speaker: "Caesar", text: "Encrypt CROSS with a shift of 13. This single word will set the course of history." },
      ],
      responseChoices: [
        { id: "c1ch6s1a", text: "For Rome, for Caesar. This message will change the world.", reaction: "And the world will never be the same. Encrypt it well, General." },
        { id: "c1ch6s1b", text: "Why shift 13 for such a critical message?", reaction: "Shift 13 is the self-reciprocal shift. Encrypt and decrypt are the same operation. Elegant for urgent times." },
        { id: "c1ch6s1c", text: "Can we uncross the Rubicon if this goes badly?", reaction: "There is no uncrossing, General. Only forward. Only victory." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 6,
      chapterTitle: "The Rubicon Crossing",
      stepNumber: 2,
      storyText: "A scout returns with an encrypted reply from the advance guard across the river.",
      taskType: "decrypt",
      taskPlaintext: "MARCH",
      taskShift: 13,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "A rider has returned from our advance guard. They sent a single encrypted word." },
        { speaker: "Caesar", text: "With shift 13, remember its unique property: encrypting twice returns the original text." },
        { speaker: "Caesar", text: "This is why shift 13 is favored in urgent situations. One operation serves both purposes." },
        { speaker: "Caesar", text: "Decrypt their reply. Our next move depends on what they have reported." },
      ],
      responseChoices: [
        { id: "c1ch6s2a", text: "The self-reciprocal property makes shift 13 invaluable in the field.", reaction: "Speed and simplicity. In war, those twin virtues save more lives than any fortress." },
        { id: "c1ch6s2b", text: "So the advance guard used the same shift we sent?", reaction: "Precisely. One shared key, one shared understanding. That is efficient communication." },
        { id: "c1ch6s2c", text: "I hope they are saying something encouraging and not 'run away.'", reaction: "Roman soldiers do not run, General. They advance in the opposite direction." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 6,
      chapterTitle: "The Rubicon Crossing",
      stepNumber: 3,
      storyText: "Caesar orders the first cohorts into the water. A message must reach the far bank.",
      taskType: "encrypt",
      taskPlaintext: "RIVER",
      taskShift: 14,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "The first cohorts are wading in. The water is cold, the current swift, but Roman resolve is swifter." },
        { speaker: "Caesar", text: "We increase the shift to 14 now. Each stage of this crossing demands a fresh key." },
        { speaker: "Caesar", text: "Rotating shifts between messages is a tactic called key rotation. Even if one message is broken, the next remains secure." },
        { speaker: "Caesar", text: "Encrypt RIVER with shift 14. Let the far bank know we are coming." },
      ],
      responseChoices: [
        { id: "c1ch6s3a", text: "Key rotation. Changing the shift between messages adds another layer of protection.", reaction: "Exactly. A moving target is harder to hit, whether it is a soldier or a cipher key." },
        { id: "c1ch6s3b", text: "How do our allies know which shift we are using now?", reaction: "Pre-arranged schedules. Each hour, the shift advances by one. Time itself becomes part of the key." },
        { id: "c1ch6s3c", text: "The river is cold? I suddenly have a deep appreciation for desk work.", reaction: "Desk work does not conquer nations, General. Now encrypt while others wade." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 6,
      chapterTitle: "The Rubicon Crossing",
      stepNumber: 4,
      storyText: "Enemy cavalry spotted. Caesar intercepts a Pompeian dispatch and needs it decoded.",
      taskType: "decrypt",
      taskPlaintext: "BATTLE",
      taskShift: 14,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Enemy cavalry on the eastern ridge! Our outriders captured one of Pompey's messengers." },
        { speaker: "Caesar", text: "The fool was carrying an encrypted dispatch. Our spies tell us Pompey uses shift 14 this week." },
        { speaker: "Caesar", text: "When you know your enemy's key, their secrets become your weapons. Intelligence gathering and cryptography are inseparable arts." },
        { speaker: "Caesar", text: "Decrypt this captured word. I need to know what Pompey is planning." },
      ],
      responseChoices: [
        { id: "c1ch6s4a", text: "Knowing the enemy's key turns their cipher against them. A powerful advantage.", reaction: "The greatest victories are won before the first sword is drawn. Information is the ultimate weapon." },
        { id: "c1ch6s4b", text: "How did our spies learn Pompey's shift?", reaction: "A disloyal centurion, a bag of gold, and a quiet conversation. The oldest intelligence method." },
        { id: "c1ch6s4c", text: "Pompey only uses shift 14? Amateur hour over there.", reaction: "Do not underestimate Pompey. He is no fool. He simply trusts the wrong people." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 6,
      chapterTitle: "The Rubicon Crossing",
      stepNumber: 5,
      storyText: "The crossing is underway. Caesar rallies the troops with an encrypted battle cry.",
      taskType: "encrypt",
      taskPlaintext: "CHARGE",
      taskShift: 15,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Half the army is across! The Rubicon is behind us, General. History is being made." },
        { speaker: "Caesar", text: "We advance the shift to 15. In a fast-moving operation, we rotate keys frequently to stay ahead of interceptors." },
        { speaker: "Caesar", text: "Every minute a key remains in use, the enemy has more ciphertext to analyze. Rotation limits their material." },
        { speaker: "Caesar", text: "Encrypt CHARGE with shift 15. The order to advance must fly faster than Pompey's scouts." },
      ],
      responseChoices: [
        { id: "c1ch6s5a", text: "Frequent rotation limits the ciphertext available for analysis. A sound strategy.", reaction: "You think like a general now, not just a codebreaker. That pleases me greatly." },
        { id: "c1ch6s5b", text: "How frequently should keys be rotated in practice?", reaction: "As often as practical. Every message, if possible. Every hour at minimum." },
        { id: "c1ch6s5c", text: "Half the army across and I am still doing paperwork. Typical.", reaction: "The pen that encrypts moves more armies than the sword that swings. Keep writing." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 6,
      chapterTitle: "The Rubicon Crossing",
      stepNumber: 6,
      storyText: "A loyal centurion sends word from the vanguard. His message must be decrypted.",
      taskType: "decrypt",
      taskPlaintext: "HONOR",
      taskShift: 15,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Centurion Cassius Longus sends word from the vanguard. A man of few words but absolute loyalty." },
        { speaker: "Caesar", text: "He uses our current rotation: shift 15. In a network of many correspondents, discipline in key usage is paramount." },
        { speaker: "Caesar", text: "One soldier using the wrong shift can expose an entire operation. The chain is only as strong as its weakest link." },
        { speaker: "Caesar", text: "Decrypt his message. Longus would not send a word unless it mattered." },
      ],
      responseChoices: [
        { id: "c1ch6s6a", text: "Discipline in key usage across an army. That requires tremendous coordination.", reaction: "It does. And that coordination is what separates a rabble from a Roman legion." },
        { id: "c1ch6s6b", text: "What happens if someone forgets the current shift?", reaction: "They send in plaintext. And then we have a very uncomfortable conversation about security." },
        { id: "c1ch6s6c", text: "A man of few words? He would hate Cicero's letters.", reaction: "Ha! Those two would be an interesting dinner party. Brevity meets verbosity." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 6,
      chapterTitle: "The Rubicon Crossing",
      stepNumber: 7,
      storyText: "The army regroups on the far bank. Caesar prepares the final push toward Rome.",
      taskType: "encrypt",
      taskPlaintext: "GLORY",
      taskShift: 15,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "The army is across. The Rubicon is behind us. Ahead lies Rome and everything we have fought for." },
        { speaker: "Caesar", text: "Notice how with higher shifts, the transformed letters look nothing like the originals. G does not resemble V." },
        { speaker: "Caesar", text: "This visual dissimilarity is the whole point. The greater the apparent randomness, the better the disguise." },
        { speaker: "Caesar", text: "Encrypt GLORY with shift 15. Rome's glory awaits us on the road ahead." },
      ],
      responseChoices: [
        { id: "c1ch6s7a", text: "The letters are unrecognizable at higher shifts. The disguise is nearly complete.", reaction: "Nearly. Remember, the pattern is still there for those who know where to look. But to casual eyes, it is gibberish." },
        { id: "c1ch6s7b", text: "Does a higher shift provide any real additional security?", reaction: "Against brute force, no. All 25 shifts fall equally fast. But against a quick glance? Absolutely." },
        { id: "c1ch6s7c", text: "Rome's glory? I was hoping for Rome's hot baths, honestly.", reaction: "First glory, then baths. That is the correct order of Roman priorities." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 6,
      chapterTitle: "The Rubicon Crossing",
      stepNumber: 8,
      storyText: "Intelligence reports arrive about Pompey's defensive positions. Decrypt the scout's finding.",
      taskType: "decrypt",
      taskPlaintext: "SHIELD",
      taskShift: 16,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Our scouts have returned from Pompey's lines. Their report is encrypted with shift 16." },
        { speaker: "Caesar", text: "We are now working with shifts above 13. Notice that shift 16 forward is the same as shift 10 backward." },
        { speaker: "Caesar", text: "A skilled codebreaker always takes the shorter path. If forward is longer, count backward instead." },
        { speaker: "Caesar", text: "Decrypt this word. I need to know what defenses stand between us and Rome." },
      ],
      responseChoices: [
        { id: "c1ch6s8a", text: "Forward 16 or backward 10. I will take whichever path is shorter.", reaction: "Efficiency is a Roman virtue, General. Apply it to everything, including counting." },
        { id: "c1ch6s8b", text: "So for shifts above 13, it is faster to count backward?", reaction: "Precisely. Shift 14 forward is shift 12 backward. The complement always sums to 26." },
        { id: "c1ch6s8c", text: "Counting backward is how I do most things. Finally my instincts are useful.", reaction: "Every skill has its moment, General. Yours has arrived." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 6,
      chapterTitle: "The Rubicon Crossing",
      stepNumber: 9,
      storyText: "Caesar arms the vanguard with one final order before the march on Rome begins.",
      taskType: "encrypt",
      taskPlaintext: "SPEAR",
      taskShift: 16,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "The vanguard needs one final order before we march. Every soldier must know the formation." },
        { speaker: "Caesar", text: "We have used shifts from 3 all the way to 16 now. Your alphabet has expanded, General." },
        { speaker: "Caesar", text: "What began as a simple trick in a war tent is now a full operational communication system." },
        { speaker: "Caesar", text: "Encrypt SPEAR with shift 16. Arm the vanguard with orders no enemy can read." },
      ],
      responseChoices: [
        { id: "c1ch6s9a", text: "From a trick to a system. The cipher has grown alongside my skills.", reaction: "And like any system, it is only as reliable as the people who operate it. You have proven reliable." },
        { id: "c1ch6s9b", text: "Will we continue increasing the shift as we advance?", reaction: "The shift will change as the situation demands. Flexibility is the mark of a mature cipher network." },
        { id: "c1ch6s9c", text: "Arm the vanguard with unreadable orders. Very reassuring for the soldiers.", reaction: "Unreadable to the enemy, General. Our soldiers have the key. That is rather the point." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 6,
      chapterTitle: "The Rubicon Crossing",
      stepNumber: 10,
      storyText: "The Rubicon is crossed. Caesar sends the final word that will echo through the ages.",
      taskType: "decrypt",
      taskPlaintext: "TRIUMPH",
      taskShift: 16,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "The crossing is complete. Every soldier stands on Roman soil, ready to march on the capital." },
        { speaker: "Caesar", text: "This word arrived from our allies inside Rome. It tells us what awaits if we succeed." },
        { speaker: "Caesar", text: "Shift 16. Seven letters. The longest word you have decrypted with a shift this high." },
        { speaker: "Caesar", text: "Prove that word length and shift size do not intimidate you. Decrypt it, General." },
        { speaker: "Caesar", text: "When you speak this word aloud, the Rubicon chapter of our story will be complete." },
      ],
      responseChoices: [
        { id: "c1ch6s10a", text: "Length and shift are just numbers. The method remains the same.", reaction: "That understanding is the mark of true mastery. The Rubicon is behind us. Rome lies ahead." },
        { id: "c1ch6s10b", text: "Seven letters at shift 16. My longest decryption yet at this level.", reaction: "And you handled it with the confidence of a seasoned codebreaker. I am proud, General." },
        { id: "c1ch6s10c", text: "If the word is 'retreat' I am going to be very disappointed.", reaction: "Ha! Rome does not retreat. Decrypt it and see for yourself." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 7: Letters to Cicero (shift 15-19, 10 steps)
    {
      cipherId: 1,
      chapterNumber: 7,
      chapterTitle: "Letters to Cicero",
      stepNumber: 1,
      storyText: "Caesar discusses using different shifts for different correspondents, starting with a letter to Cicero.",
      taskType: "encrypt",
      taskPlaintext: "PEACE",
      taskShift: 15,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Not all messages are battle orders, General. Some are personal. Some are delicate." },
        { speaker: "Caesar", text: "I write to Cicero regularly. He is a brilliant man, if insufferably verbose. We use a shift of 15 for our correspondence." },
        { speaker: "Caesar", text: "Each of my correspondents has a unique shift. Cicero gets 15. Brutus gets 18. Cleopatra gets 19." },
        { speaker: "Caesar", text: "Encrypt PEACE with shift 15. I wish to assure Cicero that my intentions are benign." },
      ],
      responseChoices: [
        { id: "c1ch7s1a", text: "Unique shifts for unique relationships. A personal cipher network.", reaction: "Trust is built one letter at a time, General. And each letter is encrypted." },
        { id: "c1ch7s1b", text: "Does Cicero actually believe your intentions are peaceful?", reaction: "Cicero believes what his rhetoric allows. But encrypted assurances help." },
        { id: "c1ch7s1c", text: "Cleopatra gets shift 19? Someone is showing off.", reaction: "A queen deserves a higher shift than a senator. It is simple etiquette." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 7,
      chapterTitle: "Letters to Cicero",
      stepNumber: 2,
      storyText: "Cicero's reply arrives with his characteristic eloquence, encrypted with shift 15.",
      taskType: "decrypt",
      taskPlaintext: "WORDS",
      taskShift: 15,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Cicero has replied. The man cannot write a short letter to save his life, but this one is just a single word." },
        { speaker: "Caesar", text: "He uses our agreed shift of 15. Consistency in the key is what makes long-term correspondence possible." },
        { speaker: "Caesar", text: "Decrypt his reply. Knowing Cicero, it will be either profound or infuriating." },
      ],
      responseChoices: [
        { id: "c1ch7s2a", text: "Consistent shifts between correspondents build trust. I see the logic.", reaction: "Changing shifts too often invites confusion. In personal letters, stability matters." },
        { id: "c1ch7s2b", text: "Cicero sent just one word? That must be a record for him.", reaction: "Indeed. I suspect he is being deliberately cryptic. Which is ironic, given the cipher." },
        { id: "c1ch7s2c", text: "Profound or infuriating? Why not both?", reaction: "You know Cicero well already. He has that effect on people." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 7,
      chapterTitle: "Letters to Cicero",
      stepNumber: 3,
      storyText: "Caesar writes to a trusted ally, emphasizing the importance of shared secrets.",
      taskType: "encrypt",
      taskPlaintext: "TRUST",
      taskShift: 16,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Now a letter to Brutus. He uses shift 16 for our private channel." },
        { speaker: "Caesar", text: "Allowing each correspondent to choose their own shift gives them ownership of the secret. It builds loyalty." },
        { speaker: "Caesar", text: "Brutus is a good man. Principled. Perhaps too principled for politics. But I trust him." },
        { speaker: "Caesar", text: "Encrypt TRUST with a shift of 16. The word itself is the message." },
      ],
      responseChoices: [
        { id: "c1ch7s3a", text: "Letting them choose their shift is a gesture of respect. Wise.", reaction: "People protect what they feel they own. Even a shift number." },
        { id: "c1ch7s3b", text: "You trust Brutus completely?", reaction: "With my life, General. He is like a son to me." },
        { id: "c1ch7s3c", text: "TRUST and Brutus in the same sentence. What could go wrong?", reaction: "You have a dark sense of humor, General. I hope it is unfounded." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 7,
      chapterTitle: "Letters to Cicero",
      stepNumber: 4,
      storyText: "A letter from Cleopatra arrives encrypted with a higher shift. Caesar explains psychological security.",
      taskType: "decrypt",
      taskPlaintext: "CROWN",
      taskShift: 17,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "A message from Egypt. Cleopatra writes with her characteristic boldness." },
        { speaker: "Caesar", text: "She uses shift 17. Higher shifts do not make the cipher mathematically stronger, but they signal importance." },
        { speaker: "Caesar", text: "This is a psychological layer of security. The higher the shift, the more serious the sender considers the message." },
        { speaker: "Caesar", text: "Decrypt her message. Queens do not like to be kept waiting." },
      ],
      responseChoices: [
        { id: "c1ch7s4a", text: "The shift as a signal of importance. Encryption carries meaning beyond the words.", reaction: "You understand something most soldiers never grasp. The cipher speaks twice." },
        { id: "c1ch7s4b", text: "Is a shift of 17 really harder to break than shift 3?", reaction: "Not mathematically. But an enemy expecting 3 will not try 17 first. Time is the weapon." },
        { id: "c1ch7s4c", text: "Cleopatra insisted on a high shift? She does not do anything small.", reaction: "She is a queen. Everything is on her terms. Including the encryption." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 7,
      chapterTitle: "Letters to Cicero",
      stepNumber: 5,
      storyText: "Caesar reflects on the personal side of encryption and sends a letter to an old friend.",
      taskType: "encrypt",
      taskPlaintext: "BOND",
      taskShift: 18,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Every encrypted letter is a thread connecting two minds across distance." },
        { speaker: "Caesar", text: "The shift number becomes a shared secret, a private language between two people." },
        { speaker: "Caesar", text: "In a world full of ears and eyes, that privacy is precious." },
        { speaker: "Caesar", text: "Encrypt BOND with shift 18. This letter goes to an old friend who stood by me when no one else would." },
      ],
      responseChoices: [
        { id: "c1ch7s5a", text: "A cipher is more than security. It is a bond between allies.", reaction: "Beautifully put, General. You have a poet's heart beneath that armor." },
        { id: "c1ch7s5b", text: "Do all your friends communicate through ciphers?", reaction: "Only the ones I want to keep alive. Which is most of them." },
        { id: "c1ch7s5c", text: "You are getting sentimental, Caesar. Should I be worried?", reaction: "Even conquerors have feelings, General. We just encrypt them." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 7,
      chapterTitle: "Letters to Cicero",
      stepNumber: 6,
      storyText: "A reply from the old friend arrives. Caesar discusses how key distribution works in practice.",
      taskType: "decrypt",
      taskPlaintext: "WISDOM",
      taskShift: 18,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "My old friend Decimus has replied. He uses our shared shift of 18, as agreed when we last met in person." },
        { speaker: "Caesar", text: "This is the key distribution problem, General. How do you share the shift with someone securely?" },
        { speaker: "Caesar", text: "We solve it by exchanging keys face to face. No message, no courier. Only a whispered number between trusted men." },
        { speaker: "Caesar", text: "Decrypt his reply. Decimus is a man of deep thought and few pretensions." },
      ],
      responseChoices: [
        { id: "c1ch7s6a", text: "The key distribution problem. The cipher is only as secure as the key exchange.", reaction: "Exactly. The strongest cipher in the world is useless if the enemy knows the key." },
        { id: "c1ch7s6b", text: "Face-to-face key exchange. Simple but effective.", reaction: "And impossible to intercept. No courier, no message, no vulnerability." },
        { id: "c1ch7s6c", text: "Whispered numbers between men in togas. Very cloak-and-dagger.", reaction: "Cloak-and-cipher, General. We leave the daggers for less civilized solutions." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 7,
      chapterTitle: "Letters to Cicero",
      stepNumber: 7,
      storyText: "Caesar composes a philosophical letter about the nature of virtue in leadership.",
      taskType: "encrypt",
      taskPlaintext: "VIRTUE",
      taskShift: 18,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Cicero and I often debate the nature of virtue. He believes it is found in words. I believe it is found in action." },
        { speaker: "Caesar", text: "Our debates, of course, are encrypted. Even philosophical disagreements have political consequences in Rome." },
        { speaker: "Caesar", text: "Notice how with shift 18, the letter V becomes N. The transformation is significant but follows the same rule." },
        { speaker: "Caesar", text: "Encrypt VIRTUE with shift 18. Let Cicero chew on this word for a while." },
      ],
      responseChoices: [
        { id: "c1ch7s7a", text: "Even philosophy requires encryption in Roman politics. Nothing is safe.", reaction: "In Rome, a misquoted opinion can end a career faster than a lost battle." },
        { id: "c1ch7s7b", text: "Words versus action. I imagine these debates get heated.", reaction: "Cicero brings the heat of rhetoric. I bring the heat of a thousand campfires. We balance each other." },
        { id: "c1ch7s7c", text: "Encrypted philosophy. That is the most Roman thing I have ever heard.", reaction: "Wait until you hear about our encrypted dinner invitations. We are thorough." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 7,
      chapterTitle: "Letters to Cicero",
      stepNumber: 8,
      storyText: "A carefully penned letter arrives from a senator seeking an audience. Decrypt with shift 19.",
      taskType: "decrypt",
      taskPlaintext: "LETTER",
      taskShift: 19,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "A senator I barely know has sent a message encrypted with shift 19. He learned our methods from a mutual friend." },
        { speaker: "Caesar", text: "This raises an important concern: the more people who know a system, the more vulnerable it becomes." },
        { speaker: "Caesar", text: "The cipher method itself is not secret. The shift value is the secret. As long as each pair has a unique shift, the system holds." },
        { speaker: "Caesar", text: "Decrypt his message. Let us see what this senator wants." },
      ],
      responseChoices: [
        { id: "c1ch7s8a", text: "The method is public, the key is private. That distinction is crucial.", reaction: "You have grasped a principle that will echo through the ages. The algorithm can be known. The key must not." },
        { id: "c1ch7s8b", text: "What if two correspondents accidentally use the same shift?", reaction: "Then their messages could be confused. Unique shifts per pair prevent that chaos." },
        { id: "c1ch7s8c", text: "A senator I barely know? That screams 'favor incoming.'", reaction: "Ha! You understand Roman politics better than most senators." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 7,
      chapterTitle: "Letters to Cicero",
      stepNumber: 9,
      storyText: "Caesar sends a message about loyalty and honor to his inner circle.",
      taskType: "encrypt",
      taskPlaintext: "HONOR",
      taskShift: 19,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "My inner circle grows smaller as the political winds shift. Those who remain deserve my deepest respect." },
        { speaker: "Caesar", text: "I send the same word to each of them, but encrypted with their individual shifts. The same message, twenty different ciphertexts." },
        { speaker: "Caesar", text: "If any one message is intercepted, the others remain safe. Compartmentalization through unique keys." },
        { speaker: "Caesar", text: "Encrypt HONOR with shift 19. This one goes to my most trusted lieutenant." },
      ],
      responseChoices: [
        { id: "c1ch7s9a", text: "Same message, different keys. Compartmentalized security. Brilliant.", reaction: "If one link breaks, the chain holds. That is the beauty of individual keys." },
        { id: "c1ch7s9b", text: "How many unique shifts can you maintain before it gets confusing?", reaction: "In practice, about a dozen. Beyond that, a written key schedule is needed. Securely stored, of course." },
        { id: "c1ch7s9c", text: "Twenty different ciphertexts? Your wrist must be exhausted.", reaction: "That is what scribes are for, General. I dictate. They suffer." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 7,
      chapterTitle: "Letters to Cicero",
      stepNumber: 10,
      storyText: "The final letter of the chapter. Caesar reflects on faith and the power of encrypted bonds.",
      taskType: "decrypt",
      taskPlaintext: "FAITH",
      taskShift: 19,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "One last letter to decrypt, General. This one arrived from a friend I have not heard from in years." },
        { speaker: "Caesar", text: "He used our old shift of 19. After all this time, he remembers. That is what loyalty looks like." },
        { speaker: "Caesar", text: "A shared key that survives the years is more than a number. It is a covenant between two minds." },
        { speaker: "Caesar", text: "Decrypt this word. Let it close this chapter of personal correspondence with the weight it deserves." },
        { speaker: "Caesar", text: "Every letter you have touched in this chapter carried the soul of a relationship. Remember that." },
      ],
      responseChoices: [
        { id: "c1ch7s10a", text: "A key remembered across years. That is the deepest form of trust.", reaction: "And trust, General, is the foundation upon which all encryption rests. Without it, keys are just numbers." },
        { id: "c1ch7s10b", text: "This chapter showed me that ciphers are as much about people as about letters.", reaction: "That is the lesson I hoped you would learn. The cipher serves the relationship, not the other way around." },
        { id: "c1ch7s10c", text: "I am not crying. It is just the ink fumes from all these letters.", reaction: "Of course, General. The ink fumes. I will not tell anyone." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 8: The Ides Approach (shift 17-21, 10 steps)
    {
      cipherId: 1,
      chapterNumber: 8,
      chapterTitle: "The Ides Approach",
      stepNumber: 1,
      storyText: "Caesar discusses the weaknesses of his cipher as whispers of conspiracy grow louder.",
      taskType: "encrypt",
      taskPlaintext: "BEWARE",
      taskShift: 17,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "I must be honest with you, General. My cipher has a weakness." },
        { speaker: "Caesar", text: "There are only 25 possible shifts. A determined enemy could try all of them in less than an hour." },
        { speaker: "Caesar", text: "This is called a brute-force attack. Simply try every key until one produces readable text." },
        { speaker: "Caesar", text: "Encrypt BEWARE with a shift of 17. Even a flawed cipher is better than none." },
      ],
      responseChoices: [
        { id: "c1ch8s1a", text: "Only 25 possible keys. That is a small number to exhaust.", reaction: "It is. But remember, our enemies must first realize a cipher is being used at all." },
        { id: "c1ch8s1b", text: "What is this brute-force attack exactly?", reaction: "Try shift 1. No? Try shift 2. No? Keep going. Eventually, one shift produces real words." },
        { id: "c1ch8s1c", text: "25 tries? My nephew could crack this over breakfast.", reaction: "Your nephew sounds dangerous. Remind me to recruit him." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 8,
      chapterTitle: "The Ides Approach",
      stepNumber: 2,
      storyText: "A dark warning arrives from a spy within the Senate. Decrypt it quickly.",
      taskType: "decrypt",
      taskPlaintext: "BLADE",
      taskShift: 17,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "A message from our spy inside the Senate. He risked everything to send this single word." },
        { speaker: "Caesar", text: "The shadows are closing in, General. I can feel it in the way men look at me. Sideways. Calculating." },
        { speaker: "Caesar", text: "Shift 17. Decrypt it quickly. Every moment this message sits unread is a moment wasted." },
      ],
      responseChoices: [
        { id: "c1ch8s2a", text: "A spy risking everything for a single word. It must be important.", reaction: "The most important messages are often the shortest. One word can save an empire." },
        { id: "c1ch8s2b", text: "The shadows are closing in? That sounds ominous, Caesar.", reaction: "Ominous is a kind word for it. But knowledge is armor. Decrypt it." },
        { id: "c1ch8s2c", text: "Sideways looks and calculating eyes? Sounds like every Senate session.", reaction: "Ha. True enough. But these looks carry a sharper edge than usual." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 8,
      chapterTitle: "The Ides Approach",
      stepNumber: 3,
      storyText: "Caesar explains frequency analysis, the elegant method that threatens his cipher.",
      taskType: "encrypt",
      taskPlaintext: "DAGGER",
      taskShift: 18,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "There is a method even more elegant than brute force. It is called frequency analysis." },
        { speaker: "Caesar", text: "In any language, some letters appear more often than others. The letter E appears far more than Q or Z." },
        { speaker: "Caesar", text: "A codebreaker who counts letter frequencies in the ciphertext can guess which letter represents E, and from there, the shift unravels." },
        { speaker: "Caesar", text: "Encrypt DAGGER with shift 18. Even as I teach you the weakness, we must continue using what we have." },
      ],
      responseChoices: [
        { id: "c1ch8s3a", text: "Frequency analysis. The patterns in language betray the cipher.", reaction: "Language is beautiful, but it is also predictable. And predictability is the enemy of secrecy." },
        { id: "c1ch8s3b", text: "So the weakness is not in the cipher, but in the language itself?", reaction: "Precisely. The cipher is mechanical perfection. Language is messy, patterned, human." },
        { id: "c1ch8s3c", text: "Note to self: use really weird words to throw off the analysts.", reaction: "Ha! That would help, actually. Uncommon words disrupt frequency patterns." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 8,
      chapterTitle: "The Ides Approach",
      stepNumber: 4,
      storyText: "An intercepted conspirator message reveals a chilling timeline. Decrypt it.",
      taskType: "decrypt",
      taskPlaintext: "FLEE",
      taskShift: 19,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Our agents intercepted a message between two senators. Shift 19." },
        { speaker: "Caesar", text: "A soothsayer told me to beware the Ides of March. Superstitious nonsense, perhaps. But perhaps not." },
        { speaker: "Caesar", text: "I must warn my most loyal supporters. Some of them should leave Rome before the storm breaks." },
        { speaker: "Caesar", text: "Decrypt this captured word. I need to know what they are planning." },
      ],
      responseChoices: [
        { id: "c1ch8s4a", text: "The Ides of March. I pray the soothsayer is wrong.", reaction: "So do I, General. But prayers are no substitute for preparation." },
        { id: "c1ch8s4b", text: "Should you not flee as well, Caesar?", reaction: "Caesar does not flee. Caesar faces what comes. But I will not let my friends face it unprepared." },
        { id: "c1ch8s4c", text: "A soothsayer? Did you get a second opinion?", reaction: "From whom? The Senate? I trust them even less than fortune tellers." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 8,
      chapterTitle: "The Ides Approach",
      stepNumber: 5,
      storyText: "Caesar sends an urgent warning to his allies about blood being spilled.",
      taskType: "encrypt",
      taskPlaintext: "BLOOD",
      taskShift: 19,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "The conspiracy grows bolder. They no longer whisper. They plot openly, thinking I am deaf." },
        { speaker: "Caesar", text: "But my cipher network hears everything. Every shifted letter is a thread in a web of intelligence." },
        { speaker: "Caesar", text: "I must warn my allies of what is coming. Not all of them will listen, but I must try." },
        { speaker: "Caesar", text: "Encrypt BLOOD with shift 19. This warning must reach them before it is too late." },
      ],
      responseChoices: [
        { id: "c1ch8s5a", text: "The cipher network as an intelligence web. Every message a thread.", reaction: "And when you pull enough threads, the full picture emerges. That is counterintelligence." },
        { id: "c1ch8s5b", text: "Why do they plot openly if they know you have spies?", reaction: "Arrogance, General. They think a great man cannot fall. History proves otherwise." },
        { id: "c1ch8s5c", text: "This chapter is getting darker than a Roman catacomb.", reaction: "The darkest chapters teach the most enduring lessons. Keep encrypting." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 8,
      chapterTitle: "The Ides Approach",
      stepNumber: 6,
      storyText: "A chilling word is intercepted from the conspirators. Caesar must know who betrays him.",
      taskType: "decrypt",
      taskPlaintext: "TRAITOR",
      taskShift: 20,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Another intercepted message. Shift 20. The conspirators are growing careless with their encryption." },
        { speaker: "Caesar", text: "Carelessness in encryption is the beginning of the end. When urgency overrides caution, mistakes multiply." },
        { speaker: "Caesar", text: "This is a lesson for you as well, General. Never let haste compromise your cipher work. Accuracy is survival." },
        { speaker: "Caesar", text: "Decrypt this word. Seven letters. I suspect I will not enjoy what it says." },
      ],
      responseChoices: [
        { id: "c1ch8s6a", text: "Haste and encryption are mortal enemies. I will always take care.", reaction: "That discipline will serve you long after these dark days pass." },
        { id: "c1ch8s6b", text: "Why would conspirators use such an obvious word?", reaction: "Because even conspirators are human. And humans are careless when they feel safe." },
        { id: "c1ch8s6c", text: "Seven letters of bad news. My favorite kind of decryption.", reaction: "Your humor is a shield, General. I appreciate it, even now." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 8,
      chapterTitle: "The Ides Approach",
      stepNumber: 7,
      storyText: "Caesar conceals a warning in the shadows, using a high shift to hide his most urgent message.",
      taskType: "encrypt",
      taskPlaintext: "SHADOW",
      taskShift: 20,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "I must send a message that even the most skilled codebreaker would struggle to crack quickly." },
        { speaker: "Caesar", text: "With shift 20, the transformation is dramatic. Every letter leaps far from its origin." },
        { speaker: "Caesar", text: "In times of danger, we use the highest shifts available. Not for mathematical security, but for time." },
        { speaker: "Caesar", text: "Encrypt SHADOW with shift 20. Let it slip through the darkness unseen." },
      ],
      responseChoices: [
        { id: "c1ch8s7a", text: "High shifts buy time. Even minutes matter when lives are at stake.", reaction: "Exactly. A brute-force attacker starts at shift 1. By the time they reach 20, we have moved." },
        { id: "c1ch8s7b", text: "Do you start brute-force attacks from the lowest or highest shift?", reaction: "Most start low. That is why we use high shifts in emergencies. Simple but effective misdirection." },
        { id: "c1ch8s7c", text: "Shadows and ciphers. We are living a spy novel, Caesar.", reaction: "This is not fiction, General. The blades are very real." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 8,
      chapterTitle: "The Ides Approach",
      stepNumber: 8,
      storyText: "A fateful word is decrypted from the conspirators' latest exchange.",
      taskType: "decrypt",
      taskPlaintext: "DOOM",
      taskShift: 21,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Our spy sent one final interception. The conspirators have set a date. Shift 21." },
        { speaker: "Caesar", text: "With each chapter of your training, the shifts have grown. And so has the darkness around us." },
        { speaker: "Caesar", text: "Even knowing the cipher's weaknesses, it has served us faithfully. No tool is perfect." },
        { speaker: "Caesar", text: "Decrypt this word. I must know the shape of what is coming." },
      ],
      responseChoices: [
        { id: "c1ch8s8a", text: "Even a flawed cipher saved countless lives. Its legacy is secure.", reaction: "As is yours, General. Whatever happens next, remember that." },
        { id: "c1ch8s8b", text: "Shift 21. Nearly the full alphabet. The disguise is almost total.", reaction: "Almost. But 'almost' is not 'complete.' That gap is where future ciphers must improve." },
        { id: "c1ch8s8c", text: "The shape of what is coming? I was hoping for a nice shape, like a circle.", reaction: "I fear the shape is rather more pointed than a circle, General." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 8,
      chapterTitle: "The Ides Approach",
      stepNumber: 9,
      storyText: "Caesar uncovers the final piece of the conspiracy. A plot against Rome itself.",
      taskType: "encrypt",
      taskPlaintext: "PLOT",
      taskShift: 21,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "The pieces come together, General. Names, dates, locations. All decrypted from intercepted messages." },
        { speaker: "Caesar", text: "Without our cipher network, we would be blind. The encryption kept our communications safe. The decryptions revealed theirs." },
        { speaker: "Caesar", text: "Both sides of the cipher served us. That is the dual nature of this craft: defense and offense." },
        { speaker: "Caesar", text: "Encrypt PLOT with shift 21. I must send this intelligence to those who can still act." },
      ],
      responseChoices: [
        { id: "c1ch8s9a", text: "Defense and offense. Encryption protects us, decryption reveals them.", reaction: "Two edges of the same blade, General. A codebreaker wields both." },
        { id: "c1ch8s9b", text: "Can those who receive this warning do anything to stop it?", reaction: "Perhaps. Perhaps not. But knowledge is never wasted, even if it comes too late." },
        { id: "c1ch8s9c", text: "I feel like I am encrypting the script of a tragedy.", reaction: "All great stories carry weight, General. Ours more than most." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 8,
      chapterTitle: "The Ides Approach",
      stepNumber: 10,
      storyText: "The darkest word arrives. Caesar faces his fate with the dignity of a cipher master.",
      taskType: "decrypt",
      taskPlaintext: "OMEN",
      taskShift: 21,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "One final message, General. The last interception before the storm." },
        { speaker: "Caesar", text: "I have faced armies, crossed rivers, and conquered nations. But some battles cannot be won with swords or ciphers." },
        { speaker: "Caesar", text: "What matters is that the knowledge survives. The cipher endures beyond any one man." },
        { speaker: "Caesar", text: "Decrypt this final word with shift 21. Let it be the closing of this dark chapter." },
        { speaker: "Caesar", text: "Whatever this word says, remember: the cipher itself is immortal, even if its creator is not." },
      ],
      responseChoices: [
        { id: "c1ch8s10a", text: "The cipher endures. Your legacy is written in shifted letters across history.", reaction: "That is all any man can ask, General. To leave something that outlasts him." },
        { id: "c1ch8s10b", text: "Some battles cannot be won. But the knowledge you shared can never be lost.", reaction: "And you, General, are the keeper of that knowledge now. Guard it well." },
        { id: "c1ch8s10c", text: "I refuse to believe this is the end. Ciphers need their Caesar.", reaction: "The cipher does not need Caesar. It needs people like you who understand it. That is enough." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 9: Octavian's Inheritance (shift 19-23, 10 steps)
    {
      cipherId: 1,
      chapterNumber: 9,
      chapterTitle: "Octavian's Inheritance",
      stepNumber: 1,
      storyText: "Caesar speaks of his nephew Octavian and the future evolution of ciphers.",
      taskType: "encrypt",
      taskPlaintext: "LEGACY",
      taskShift: 19,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "My nephew Octavian will inherit more than an empire. He will inherit an idea." },
        { speaker: "Caesar", text: "The shift cipher is a beginning, not an end. One day, someone will create ciphers with multiple shifts in a single message." },
        { speaker: "Caesar", text: "And beyond that, ciphers where the key is as long as the message itself. Unbreakable, even by brute force." },
        { speaker: "Caesar", text: "Encrypt LEGACY with a shift of 19. My legacy is not just Rome. It is the very concept of encrypted communication." },
      ],
      responseChoices: [
        { id: "c1ch9s1a", text: "Your cipher started a revolution in secret communication.", reaction: "And revolutions, once started, never truly end. They only evolve." },
        { id: "c1ch9s1b", text: "Multiple shifts in one message? How would that even work?", reaction: "A keyword, perhaps. Each letter of the keyword sets a different shift. But that is a puzzle for future minds." },
        { id: "c1ch9s1c", text: "Octavian gets an empire AND a cipher? Lucky kid.", reaction: "Lucky and burdened. The two are inseparable when you inherit Rome." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 9,
      chapterTitle: "Octavian's Inheritance",
      stepNumber: 2,
      storyText: "Caesar reflects on how Octavian experiments with higher shifts. A practice message arrives.",
      taskType: "decrypt",
      taskPlaintext: "FUTURE",
      taskShift: 20,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Octavian has been experimenting with extreme shifts. The boy favors large numbers." },
        { speaker: "Caesar", text: "A shift of 20 is the same as a backward shift of 6. He discovered this symmetry on his own." },
        { speaker: "Caesar", text: "The boy sees connections I sometimes miss. He will be a formidable leader." },
        { speaker: "Caesar", text: "Decrypt one of his practice messages. Shift of 20. Show me you can keep up with the next generation." },
      ],
      responseChoices: [
        { id: "c1ch9s2a", text: "Shift 20 equals backward shift 6. The circle of the alphabet reveals itself again.", reaction: "Every high shift has a low mirror. The math is beautiful when you see the symmetry." },
        { id: "c1ch9s2b", text: "Does Octavian know you share his practice messages?", reaction: "He suspects. But he encrypts them well enough that he does not mind the challenge." },
        { id: "c1ch9s2c", text: "Keeping up with teenagers is exhausting, even in cryptography.", reaction: "Ha! Wait until he inherits the army. Then 'exhausting' will take new meaning." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 9,
      chapterTitle: "Octavian's Inheritance",
      stepNumber: 3,
      storyText: "Caesar teaches Octavian about the history of secret writing and asks you to encrypt a tribute.",
      taskType: "encrypt",
      taskPlaintext: "CIPHER",
      taskShift: 20,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "I told Octavian about the Spartans and their scytale. A strip of leather wrapped around a rod to align hidden letters." },
        { speaker: "Caesar", text: "Secret writing is older than Rome itself. Our cipher is one branch of a great tree." },
        { speaker: "Caesar", text: "What we have added is systematic substitution. A rule that anyone can follow, not a physical device." },
        { speaker: "Caesar", text: "Encrypt CIPHER with shift 20. A tribute to the craft that spans civilizations." },
      ],
      responseChoices: [
        { id: "c1ch9s3a", text: "From Spartan leather strips to Roman letter shifts. The evolution of secrecy.", reaction: "And every step of that evolution makes the next one possible. We stand on the shoulders of ancient spies." },
        { id: "c1ch9s3b", text: "A rule anyone can follow. That is what makes the Caesar cipher so powerful.", reaction: "Simplicity is its greatest strength. A child can learn it. A general can rely on it." },
        { id: "c1ch9s3c", text: "Encrypting the word CIPHER. That is beautifully recursive.", reaction: "I do not know what recursive means, but I appreciate your enthusiasm, General." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 9,
      chapterTitle: "Octavian's Inheritance",
      stepNumber: 4,
      storyText: "Octavian sends a message about the empire he hopes to build. Decrypt it.",
      taskType: "decrypt",
      taskPlaintext: "EMPIRE",
      taskShift: 21,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Octavian writes to me about his vision. The boy dreams of an empire that spans the known world." },
        { speaker: "Caesar", text: "Shift 21. He chose this number because it is the sum of three sevens. The boy has a flair for symbolism." },
        { speaker: "Caesar", text: "An empire of that scale would need communication systems far beyond what we have today." },
        { speaker: "Caesar", text: "Decrypt his message. Let us see what grand word he has chosen for his grand vision." },
      ],
      responseChoices: [
        { id: "c1ch9s4a", text: "A world-spanning empire would need unbreakable encryption to function.", reaction: "Exactly. The bigger the empire, the more critical the communication. Octavian understands this." },
        { id: "c1ch9s4b", text: "Three sevens. Octavian really does think about everything symbolically.", reaction: "A leader must inspire as well as command. Symbols matter more than most realize." },
        { id: "c1ch9s4c", text: "A world-spanning empire? The boy should start with cleaning his room.", reaction: "Ha! I said something similar. He was not amused." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 9,
      chapterTitle: "Octavian's Inheritance",
      stepNumber: 5,
      storyText: "Caesar prepares a lesson for Octavian about the vitality of learning.",
      taskType: "encrypt",
      taskPlaintext: "YOUTH",
      taskShift: 21,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Octavian's greatest asset is not his ambition. It is his willingness to learn." },
        { speaker: "Caesar", text: "Every generation inherits the knowledge of the last and builds upon it. That is how civilizations advance." },
        { speaker: "Caesar", text: "The shift cipher I invented will be surpassed. And that is exactly as it should be." },
        { speaker: "Caesar", text: "Encrypt YOUTH with shift 21. The young carry the torch that the old have lit." },
      ],
      responseChoices: [
        { id: "c1ch9s5a", text: "Each generation builds upon the last. The cipher will evolve beyond what we can imagine.", reaction: "And when it does, remember that every evolution began with a simple shift of 3." },
        { id: "c1ch9s5b", text: "You want your cipher to be surpassed? Most people want to be remembered forever.", reaction: "I want to be remembered as the beginning, not the end. Beginnings have more power." },
        { id: "c1ch9s5c", text: "The young carry the torch? I hope they do not drop it.", reaction: "That is what teachers are for, General. We light the torch and teach them to hold it steady." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 9,
      chapterTitle: "Octavian's Inheritance",
      stepNumber: 6,
      storyText: "Octavian asks about the nature of wisdom in cryptography. His encrypted question arrives.",
      taskType: "decrypt",
      taskPlaintext: "WISDOM",
      taskShift: 22,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Octavian asks me a question, encrypted with shift 22. He wants to know what makes a great codebreaker." },
        { speaker: "Caesar", text: "My answer: not cleverness, not speed, but judgment. Knowing when to encrypt and when to speak plainly." },
        { speaker: "Caesar", text: "A cipher used carelessly draws attention. A cipher used wisely is invisible." },
        { speaker: "Caesar", text: "Decrypt his question first. Shift 22. Then I will teach you the answer." },
      ],
      responseChoices: [
        { id: "c1ch9s6a", text: "Judgment over cleverness. Knowing when to use the cipher is as important as how.", reaction: "That wisdom took me years to learn. You have grasped it in moments." },
        { id: "c1ch9s6b", text: "A cipher used carelessly draws attention. So subtlety is key?", reaction: "Always. The best encryption is the kind nobody suspects exists." },
        { id: "c1ch9s6c", text: "When to encrypt and when to speak plainly? I encrypt my grocery lists.", reaction: "That is... thorough. Perhaps excessively so. But I admire the commitment." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 9,
      chapterTitle: "Octavian's Inheritance",
      stepNumber: 7,
      storyText: "Caesar writes a lesson on ancient scrolls that Octavian will study for years.",
      taskType: "encrypt",
      taskPlaintext: "SCROLL",
      taskShift: 22,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "I am writing a set of scrolls for Octavian. Each one contains a lesson about encryption." },
        { speaker: "Caesar", text: "One day, machines will encrypt and decrypt messages faster than any human mind." },
        { speaker: "Caesar", text: "Keys will be not 25 numbers but millions of numbers. The principle will be the same, but the scale will be unimaginable." },
        { speaker: "Caesar", text: "Encrypt SCROLL with shift 22. These lessons will outlive us both." },
      ],
      responseChoices: [
        { id: "c1ch9s7a", text: "Lessons preserved in scrolls. Knowledge that transcends generations.", reaction: "The greatest gift a teacher can give is knowledge that survives them." },
        { id: "c1ch9s7b", text: "Machines that encrypt? You have a wild imagination, Caesar.", reaction: "Every impossibility is just a future certainty waiting for its moment." },
        { id: "c1ch9s7c", text: "Encrypted scrolls for a teenager? He will never do his other homework.", reaction: "Cryptography IS his homework now. I have spoken with his tutors." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 9,
      chapterTitle: "Octavian's Inheritance",
      stepNumber: 8,
      storyText: "Octavian sends a message about his role as the future teacher of ciphers.",
      taskType: "decrypt",
      taskPlaintext: "TEACH",
      taskShift: 23,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Octavian sends a message with shift 23. Nearly the full cycle of the alphabet." },
        { speaker: "Caesar", text: "A shift of 23 is the same as a backward shift of 3. An interesting symmetry, no?" },
        { speaker: "Caesar", text: "The boy has chosen his path. He will not just use the cipher. He will teach it to others." },
        { speaker: "Caesar", text: "Decrypt his message. Shift 23. Let us see what word he has chosen to define his purpose." },
      ],
      responseChoices: [
        { id: "c1ch9s8a", text: "Shift 23 equals backward shift 3. The circle of the alphabet is truly elegant.", reaction: "Every high shift has a low mirror. 25 is backward 1. 24 is backward 2. The math is beautiful." },
        { id: "c1ch9s8b", text: "He will teach others? The knowledge will spread like ripples in water.", reaction: "And each ripple carries the same truth: substitution is the foundation of all encryption." },
        { id: "c1ch9s8c", text: "A teenager who wants to teach. Most of them just want to cause trouble.", reaction: "Octavian causes a different kind of trouble. The kind that builds empires." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 9,
      chapterTitle: "Octavian's Inheritance",
      stepNumber: 9,
      storyText: "Caesar designates Octavian as his heir in all things, including the cipher legacy.",
      taskType: "encrypt",
      taskPlaintext: "HEIR",
      taskShift: 23,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "I have made my decision. Octavian will be my heir. In politics, in power, and in cryptography." },
        { speaker: "Caesar", text: "The shift cipher will be his birthright. He will improve it, extend it, and pass it to the next generation." },
        { speaker: "Caesar", text: "And you, General, are the bridge between my knowledge and his. You carry the understanding." },
        { speaker: "Caesar", text: "Encrypt HEIR with shift 23. Let this word seal the succession of secrets." },
      ],
      responseChoices: [
        { id: "c1ch9s9a", text: "I am honored to be the bridge between generations of codebreakers.", reaction: "The bridge does not seek glory, General. It enables others to cross. That is its nobility." },
        { id: "c1ch9s9b", text: "Will Octavian truly improve upon your cipher?", reaction: "He must. If my students do not surpass me, then I have failed as a teacher." },
        { id: "c1ch9s9c", text: "Heir to an empire and a cipher? That is one heavy inheritance.", reaction: "Heavy crowns and heavy keys, General. Both require strong shoulders." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 9,
      chapterTitle: "Octavian's Inheritance",
      stepNumber: 10,
      storyText: "A final message from Octavian arrives using a near-maximum shift. The succession is sealed.",
      taskType: "decrypt",
      taskPlaintext: "MASTER",
      taskShift: 23,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Octavian sends one final message. Shift 23. He has chosen the same shift as his previous message. Consistency." },
        { speaker: "Caesar", text: "He writes with confidence now. No hesitation, no errors. He is ready." },
        { speaker: "Caesar", text: "And so are you, General. From recruit to codebreaker, your journey has been extraordinary." },
        { speaker: "Caesar", text: "Decrypt this last word from Octavian. Let it be the final lesson before your ultimate test." },
        { speaker: "Caesar", text: "The next chapter will test everything. Prepare yourself." },
      ],
      responseChoices: [
        { id: "c1ch9s10a", text: "From recruit to codebreaker. I am ready for the final challenge.", reaction: "I have no doubt. The fire has been lit. Now let it burn bright." },
        { id: "c1ch9s10b", text: "Octavian writes with confidence. Your teaching has been effective.", reaction: "Teaching is the highest form of understanding. If you can teach it, you truly know it." },
        { id: "c1ch9s10c", text: "The ultimate test? I was hoping for a graduation ceremony first.", reaction: "In Rome, the test IS the ceremony. Pass it, and you earn the wreath." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 10: Cipher Forged (mixed shifts 3-25, 10 steps)
    {
      cipherId: 1,
      chapterNumber: 10,
      chapterTitle: "Cipher Forged",
      stepNumber: 1,
      storyText: "Caesar presents the final challenge: a series of mixed-shift tests to prove mastery.",
      taskType: "encrypt",
      taskPlaintext: "ROME",
      taskShift: 3,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "You have journeyed from a curious recruit to a master of the shift cipher, General." },
        { speaker: "Caesar", text: "This final chapter is your trial by fire. Mixed shifts. No warnings. No hints beyond the shift number." },
        { speaker: "Caesar", text: "We begin where we started. Encrypt ROME with a shift of 3. The same word, the same shift as your very first lesson." },
        { speaker: "Caesar", text: "But you are not the same person. Show me how far you have come." },
      ],
      responseChoices: [
        { id: "c1ch10s1a", text: "Full circle. ROME again, but I am a different person now.", reaction: "The word is the same. The codebreaker is transformed. That is the point." },
        { id: "c1ch10s1b", text: "Starting with shift 3. A callback to the beginning.", reaction: "Every master must remember where they began. Humility is the foundation of expertise." },
        { id: "c1ch10s1c", text: "A trial by fire? Can it be a trial by comfortable chair instead?", reaction: "No. Fire. Now encrypt." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 10,
      chapterTitle: "Cipher Forged",
      stepNumber: 2,
      storyText: "Caesar tests decryption with a low shift, recalling early lessons.",
      taskType: "decrypt",
      taskPlaintext: "LEGION",
      taskShift: 5,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Now a decryption. Shift of 5. A low shift, but do not let familiarity breed carelessness." },
        { speaker: "Caesar", text: "The most common error among experienced codebreakers is overconfidence with easy tasks." },
        { speaker: "Caesar", text: "Treat every shift with the same discipline, whether it is 3 or 25." },
        { speaker: "Caesar", text: "Decrypt this word. Six letters. Precision matters." },
      ],
      responseChoices: [
        { id: "c1ch10s2a", text: "Every shift deserves equal discipline. I will not grow careless.", reaction: "That attitude is what separates a master from a journeyman. Well said." },
        { id: "c1ch10s2b", text: "Overconfidence with easy tasks. A subtle but dangerous trap.", reaction: "The trap catches the best of us. Awareness is your best defense against it." },
        { id: "c1ch10s2c", text: "Low shift, high concentration. Like using a magnifying glass to read fine print.", reaction: "An apt comparison, General. Now focus that magnifying glass." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 10,
      chapterTitle: "Cipher Forged",
      stepNumber: 3,
      storyText: "Caesar jumps to a mid-range shift, testing adaptability.",
      taskType: "encrypt",
      taskPlaintext: "CIPHER",
      taskShift: 10,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Now we jump. Shift 10. A true master does not need to work through shifts sequentially." },
        { speaker: "Caesar", text: "In the field, the shift might change mid-conversation. You must adapt instantly." },
        { speaker: "Caesar", text: "Mental agility is the hallmark of a great codebreaker. The numbers should dance in your mind." },
        { speaker: "Caesar", text: "Encrypt CIPHER with shift 10. Let the word itself pay homage to your craft." },
      ],
      responseChoices: [
        { id: "c1ch10s3a", text: "Jumping between shifts is second nature now. My mind adapts instantly.", reaction: "That adaptability is worth more than any army. Information controls the battlefield." },
        { id: "c1ch10s3b", text: "Mid-conversation shift changes. That requires both parties to be perfectly synchronized.", reaction: "It does. And that synchronization is built through trust and practice. You have both." },
        { id: "c1ch10s3c", text: "The numbers dance in my mind? More like they are doing a chaotic jig.", reaction: "Even a chaotic jig produces results, General. Keep dancing." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 10,
      chapterTitle: "Cipher Forged",
      stepNumber: 4,
      storyText: "Caesar tests the self-reciprocal shift 13, testing knowledge of its special property.",
      taskType: "decrypt",
      taskPlaintext: "MASTER",
      taskShift: 13,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Shift 13. The self-reciprocal shift. You remember its special property?" },
        { speaker: "Caesar", text: "Apply it once to encrypt. Apply it again to decrypt. The alphabet split perfectly in half." },
        { speaker: "Caesar", text: "Of all 25 shifts, this one is unique. It is its own inverse." },
        { speaker: "Caesar", text: "Decrypt this word. Let the symmetry guide you." },
      ],
      responseChoices: [
        { id: "c1ch10s4a", text: "Shift 13. The perfect mirror. I remember it well.", reaction: "A mind that remembers is a mind that conquers." },
        { id: "c1ch10s4b", text: "Self-reciprocal. The same operation encrypts and decrypts.", reaction: "Exactly. Of all the shifts, 13 is the most elegant." },
        { id: "c1ch10s4c", text: "Lucky number 13. Nothing ominous about that at all.", reaction: "Superstition has no place in mathematics, General. Only in the Senate." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 10,
      chapterTitle: "Cipher Forged",
      stepNumber: 5,
      storyText: "Caesar pushes to a higher shift range, testing mastery of larger transformations.",
      taskType: "encrypt",
      taskPlaintext: "FORGED",
      taskShift: 15,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Shift 15 now. We climb higher. The letters transform more dramatically with each increase." },
        { speaker: "Caesar", text: "Notice how at shift 15, A becomes P. The original and the cipher share nothing in common visually." },
        { speaker: "Caesar", text: "This visual dissimilarity is the shield that protects our words from prying eyes." },
        { speaker: "Caesar", text: "Encrypt FORGED with shift 15. The word describes what you have become through this journey." },
      ],
      responseChoices: [
        { id: "c1ch10s5a", text: "Forged in the fire of ten chapters. I have earned this word.", reaction: "You have earned it, General. Every letter of it." },
        { id: "c1ch10s5b", text: "Visual dissimilarity as a shield. The greater the shift, the better the disguise.", reaction: "For casual observers, yes. For determined analysts, the math remains equally breakable. But first impressions matter." },
        { id: "c1ch10s5c", text: "FORGED sounds dramatic. I was hoping for RELAXED.", reaction: "Relaxation comes after the trial, General. We are not there yet." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 10,
      chapterTitle: "Cipher Forged",
      stepNumber: 6,
      storyText: "Caesar tests decryption in the upper-mid range with a historically significant word.",
      taskType: "decrypt",
      taskPlaintext: "TRIUMPH",
      taskShift: 18,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Shift 18. A seven-letter word at a high shift. This is not a beginner's exercise." },
        { speaker: "Caesar", text: "Longer words mean more letters to shift, but the process is identical. Patience and consistency." },
        { speaker: "Caesar", text: "A master treats a seven-letter word the same as a three-letter word. One letter at a time." },
        { speaker: "Caesar", text: "Decrypt this word. It describes what Rome grants to its greatest generals." },
      ],
      responseChoices: [
        { id: "c1ch10s6a", text: "One letter at a time. The method never changes, only the patience required.", reaction: "And your patience has been remarkable, General. This word belongs to you." },
        { id: "c1ch10s6b", text: "Seven letters at shift 18. My most complex challenge yet.", reaction: "Complex, yes. But within your abilities. That is the balance of a good test." },
        { id: "c1ch10s6c", text: "Something Rome grants its greatest generals? I hope it comes with a pension.", reaction: "It comes with something better. Immortal glory. Which unfortunately does not pay rent." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 10,
      chapterTitle: "Cipher Forged",
      stepNumber: 7,
      storyText: "Caesar tests a high shift, pushing toward the extreme end of the alphabet.",
      taskType: "encrypt",
      taskPlaintext: "ETERNAL",
      taskShift: 20,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Shift 20. Remember: shift 20 forward is the same as shift 6 backward. Take whichever path is shorter." },
        { speaker: "Caesar", text: "A true master sees both directions simultaneously. Forward and backward are two views of the same transformation." },
        { speaker: "Caesar", text: "This word is seven letters long. At shift 20, it will look entirely alien. But you will create it with ease." },
        { speaker: "Caesar", text: "Encrypt ETERNAL. It is what this knowledge will be." },
      ],
      responseChoices: [
        { id: "c1ch10s7a", text: "Forward 20 or backward 6. Two paths, one destination. I see both.", reaction: "That duality is the deepest truth of the Caesar cipher. You have grasped it completely." },
        { id: "c1ch10s7b", text: "Does it matter which direction I count?", reaction: "The result is identical. Choose whichever path is shorter. Efficiency is a virtue." },
        { id: "c1ch10s7c", text: "ETERNAL? You are going to make me emotional, Caesar.", reaction: "Emotions are acceptable. Errors are not. Encrypt the word." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 10,
      chapterTitle: "Cipher Forged",
      stepNumber: 8,
      storyText: "Caesar gives a near-maximum shift decryption challenge.",
      taskType: "decrypt",
      taskPlaintext: "GLORY",
      taskShift: 23,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Shift 23. Nearly the full rotation. Each letter becomes the one three steps behind it." },
        { speaker: "Caesar", text: "At this level, the wrapping is constant. Almost every letter crosses the Z-A boundary." },
        { speaker: "Caesar", text: "But you have handled every shift from 3 to 23. This is no different. Trust your training." },
        { speaker: "Caesar", text: "Decrypt this word. It describes what awaits those who master the cipher." },
      ],
      responseChoices: [
        { id: "c1ch10s8a", text: "Shift 23, backward 3. I trust my training completely.", reaction: "And your training trusts you. That is the bond between teacher and student." },
        { id: "c1ch10s8b", text: "Constant wrapping around Z. My alphabet visualization is strong now.", reaction: "You see the circle in your mind. That means the cipher has become part of you." },
        { id: "c1ch10s8c", text: "Almost done? I can smell the laurel wreath from here.", reaction: "Two more steps, General. Patience. The wreath is within reach." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 10,
      chapterTitle: "Cipher Forged",
      stepNumber: 9,
      storyText: "The penultimate challenge. Caesar tests the near-maximum shift of 24.",
      taskType: "encrypt",
      taskPlaintext: "EMPIRE",
      taskShift: 24,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "Shift 24. The second-highest possible. Each letter shifts backward by just 2." },
        { speaker: "Caesar", text: "At the extremes of the alphabet, the shifts feel paradoxical. A huge forward shift produces a tiny backward step." },
        { speaker: "Caesar", text: "This is the deepest lesson of the Caesar cipher: extremes meet. The circle has no beginning and no end." },
        { speaker: "Caesar", text: "Encrypt EMPIRE with shift 24. The penultimate challenge before your final word." },
      ],
      responseChoices: [
        { id: "c1ch10s9a", text: "Extremes meet. The highest shift is the smallest backward step. Profound.", reaction: "You have seen what few ever see: the unity beneath the apparent complexity." },
        { id: "c1ch10s9b", text: "Shift 24 forward equals shift 2 backward. The circle reveals all.", reaction: "And within that circle, every secret ever whispered finds its home." },
        { id: "c1ch10s9c", text: "Penultimate? I had to look that word up. Too much cryptography, not enough vocabulary.", reaction: "Cryptography IS vocabulary, General. Just rearranged." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 1,
      chapterNumber: 10,
      chapterTitle: "Cipher Forged",
      stepNumber: 10,
      storyText: "The final test. Caesar asks you to decrypt the word that defines your transformation.",
      taskType: "decrypt",
      taskPlaintext: "VICTORY",
      taskShift: 25,
      taskCiphertext: "",
      speaker: "Caesar",
      speakerAvatar: "caesar",
      dialogueLines: [
        { speaker: "Caesar", text: "This is it, General. The final word. The last test. Shift 25, the maximum possible." },
        { speaker: "Caesar", text: "A shift of 25 is identical to a backward shift of 1. Each letter simply becomes the one before it." },
        { speaker: "Caesar", text: "The word itself describes what has happened to you across these ten chapters. You arrived as raw metal. You leave as something stronger." },
        { speaker: "Caesar", text: "Decrypt it. Speak it aloud. And know that you have earned your place among Rome's finest codebreakers." },
        { speaker: "Caesar", text: "It has been an honor, General. Now go forth and guard the secrets of the world." },
      ],
      responseChoices: [
        { id: "c1ch10s10a", text: "The honor has been mine, Caesar. I will carry this knowledge forever.", reaction: "And it will carry you. Through every challenge, every secret, every code yet unwritten." },
        { id: "c1ch10s10b", text: "From shift 3 to shift 25. The full circle. Thank you for this journey.", reaction: "The journey does not end here. It only changes direction. Go and build upon what we have started." },
        { id: "c1ch10s10c", text: "Do I finally get that laurel wreath?", reaction: "You have earned something far greater than a wreath. You have earned the cipher. Now go. Forge your own legacy." },
      ],
      stepType: "dialogue_task",
    },

    // ===== ATBASH CIPHER (cipherId: 2) - 10 Chapters =====

    // Chapter 1: The Scriptorium (4 steps)
    {
      cipherId: 2,
      chapterNumber: 1,
      chapterTitle: "The Scriptorium",
      stepNumber: 1,
      storyText: "Ezra the scribe welcomes you to his scriptorium and introduces the concept of reversing the alphabet.",
      taskType: "encrypt",
      taskPlaintext: "TRUTH",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Shalom, traveler. Come, sit by the lamplight. I have been expecting someone like you." },
        { speaker: "Ezra", text: "I am Ezra, keeper of scrolls in this scriptorium. For generations, my people have hidden sacred messages within our texts." },
        { speaker: "Ezra", text: "The method is elegant in its simplicity: reverse the alphabet. A becomes Z, B becomes Y, C becomes X, and so on to the very end." },
        { speaker: "Ezra", text: "We call it Atbash \u2014 named for the first and last letters of the Hebrew alphabet. Let us begin. Encrypt the word TRUTH." },
      ],
      responseChoices: [
        { id: "c2ch1s1a", text: "I'm honored to learn from you, Ezra.", reaction: "Humility is the first step toward wisdom. You begin well, traveler." },
        { id: "c2ch1s1b", text: "Reverse the whole alphabet? That's the entire method?", reaction: "The deepest truths are often the simplest ones, child. Do not mistake simplicity for weakness." },
        { id: "c2ch1s1c", text: "Can I just read the scrolls without all the puzzles?", reaction: "These puzzles protect the scrolls. Earn the right to read them." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 1,
      chapterTitle: "The Scriptorium",
      stepNumber: 2,
      storyText: "Ezra explains how each letter maps to its mirror counterpart and asks you to decrypt a word.",
      taskType: "decrypt",
      taskPlaintext: "SCROLL",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Beautiful. You grasp the mirror of letters quickly." },
        { speaker: "Ezra", text: "Picture the alphabet written forward on one line and backward on the line beneath. Each letter pairs with the one directly below it." },
        { speaker: "Ezra", text: "A pairs with Z, B with Y, C with X \u2014 all the way to M pairing with N. Every letter has exactly one partner." },
        { speaker: "Ezra", text: "A messenger brought this encrypted fragment. Reverse the letters and reveal what it says." },
      ],
      responseChoices: [
        { id: "c2ch1s2a", text: "Two rows of the alphabet, mirrored. I can picture it clearly.", reaction: "Hold that image in your mind. It will serve you well in the chapters ahead." },
        { id: "c2ch1s2b", text: "So there are only 13 unique letter pairs?", reaction: "Precisely. Twenty-six letters, thirteen pairs. You count like a scholar." },
        { id: "c2ch1s2c", text: "A mirror alphabet? My reflection is already confused.", reaction: "Ha. The alphabet does not judge appearances. Only accuracy." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 1,
      chapterTitle: "The Scriptorium",
      stepNumber: 3,
      storyText: "Ezra explains there is no shift value \u2014 the reversal is fixed \u2014 and tests with another encryption.",
      taskType: "encrypt",
      taskPlaintext: "LAMP",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Notice something important, traveler. Unlike the Roman cipher you may have heard of, Atbash uses no shifting number." },
        { speaker: "Ezra", text: "There is no key to share, no secret number to remember. The rule is always the same: reverse." },
        { speaker: "Ezra", text: "This makes Atbash simple to use but also means anyone who knows the method can read the message. Its strength lies in secrecy of the method itself." },
        { speaker: "Ezra", text: "Encrypt the word LAMP \u2014 the light that guides our work in this dim scriptorium." },
      ],
      responseChoices: [
        { id: "c2ch1s3a", text: "No key at all. The simplicity is its elegance.", reaction: "Elegance and simplicity are often the same thing, viewed from different angles." },
        { id: "c2ch1s3b", text: "If there is no key, isn't it easy to break?", reaction: "It is \u2014 if you know to look for it. But for centuries, no one did. That was the true protection." },
        { id: "c2ch1s3c", text: "No key? So I cannot lose it? Already better than my house keys.", reaction: "A mind that remembers is the only key you will ever need here." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 1,
      chapterTitle: "The Scriptorium",
      stepNumber: 4,
      storyText: "Ezra gives a final warm-up to cement the Atbash basics.",
      taskType: "decrypt",
      taskPlaintext: "WORD",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "You are learning well. But knowledge without practice is ink without parchment \u2014 it has nowhere to live." },
        { speaker: "Ezra", text: "One more decryption before we move deeper into the scriptorium. Build your confidence." },
        { speaker: "Ezra", text: "This encrypted fragment was found tucked between the pages of an old codex. Reveal what it says." },
      ],
      responseChoices: [
        { id: "c2ch1s4a", text: "The basics are solid. I am ready for what comes next.", reaction: "Good. The foundation must be strong before we build higher. You have laid it well." },
        { id: "c2ch1s4b", text: "How long until I can decrypt without counting letters?", reaction: "Practice, traveler. Soon the mirror alphabet will live in your mind like a second language." },
        { id: "c2ch1s4c", text: "Another one? I was just getting comfortable.", reaction: "Comfort is the enemy of growth. Decode it, and grow." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 2: Scrolls of the Elders (4 steps)
    {
      cipherId: 2,
      chapterNumber: 2,
      chapterTitle: "Scrolls of the Elders",
      stepNumber: 1,
      storyText: "Ezra brings out ancient scrolls from the elders and begins pattern recognition exercises.",
      taskType: "encrypt",
      taskPlaintext: "FAITH",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Come deeper into the scriptorium, traveler. These shelves hold the writings of our elders \u2014 texts passed down for generations." },
        { speaker: "Ezra", text: "Each scroll was touched by hands that believed the words within were worth protecting with their lives." },
        { speaker: "Ezra", text: "As you practice, notice patterns. Letters near the beginning of the alphabet become letters near the end. A becomes Z, B becomes Y." },
        { speaker: "Ezra", text: "Encrypt the word FAITH. It is what sustained the elders through every trial." },
      ],
      responseChoices: [
        { id: "c2ch2s1a", text: "I can feel the weight of history in this room.", reaction: "That weight is a privilege, not a burden. Carry it with reverence." },
        { id: "c2ch2s1b", text: "So early letters map to late letters and vice versa?", reaction: "Exactly. A and Z are partners. B and Y. The pattern is perfectly symmetrical." },
        { id: "c2ch2s1c", text: "These scrolls look older than my grandmother.", reaction: "They are older than everyone's grandmother. And far wiser. Now encrypt." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 2,
      chapterTitle: "Scrolls of the Elders",
      stepNumber: 2,
      storyText: "Ezra tests decryption and points out letter frequency patterns.",
      taskType: "decrypt",
      taskPlaintext: "LIGHT",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Good. Now observe something clever about Atbash. The letter M maps to N, and N maps to M." },
        { speaker: "Ezra", text: "They are neighbors in the alphabet, yet they swap with each other. The very center of the mirror." },
        { speaker: "Ezra", text: "These middle letters barely change at all, while letters at the edges transform dramatically. A useful pattern to recognize." },
        { speaker: "Ezra", text: "Decrypt this word. It describes what knowledge brings to those who seek it." },
      ],
      responseChoices: [
        { id: "c2ch2s2a", text: "M and N swap with each other \u2014 the center of the mirror. Fascinating.", reaction: "You see the structure beneath the surface. That is the mark of a true student." },
        { id: "c2ch2s2b", text: "Do the middle letters make Atbash easier to spot?", reaction: "For a trained eye, yes. If M and N appear swapped in a text, Atbash may be at work." },
        { id: "c2ch2s2c", text: "M and N are basically just swapping seats in class.", reaction: "If you wish to think of it that way. They have been swapping seats for three thousand years." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 2,
      chapterTitle: "Scrolls of the Elders",
      stepNumber: 3,
      storyText: "Ezra explains how to quickly compute Atbash by counting from the ends of the alphabet.",
      taskType: "encrypt",
      taskPlaintext: "SEAL",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Let me teach you a shortcut the elder scribes used. To find the Atbash partner of any letter, count its position from A, then count the same distance backward from Z." },
        { speaker: "Ezra", text: "A is the 1st letter, so count 1 from the end: Z. D is the 4th letter, so count 4 from the end: W." },
        { speaker: "Ezra", text: "With practice, you will not need to count at all. The pairs will become second nature." },
        { speaker: "Ezra", text: "Encrypt the word SEAL. As the elders sealed their scrolls, you seal yours with knowledge." },
      ],
      responseChoices: [
        { id: "c2ch2s3a", text: "Count the position, then mirror it from the end. I understand.", reaction: "That shortcut has served generations of scribes. Now it serves you." },
        { id: "c2ch2s3b", text: "Is there a mathematical formula behind this?", reaction: "Indeed. The partner of the Nth letter is the (27 minus N)th letter. Mathematics and language, intertwined." },
        { id: "c2ch2s3c", text: "Counting from both ends? My fingers are going to be very busy.", reaction: "Your fingers will rest soon enough. Your mind will do the work." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 2,
      chapterTitle: "Scrolls of the Elders",
      stepNumber: 4,
      storyText: "Ezra presents a longer word to test growing skill.",
      taskType: "decrypt",
      taskPlaintext: "WISDOM",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "The elders wrote of many things: law, prophecy, poetry, and wisdom above all." },
        { speaker: "Ezra", text: "Wisdom was considered the highest pursuit \u2014 greater than wealth, greater than power." },
        { speaker: "Ezra", text: "This encrypted word comes from one of their most treasured proverbs. Decrypt it and claim the teaching." },
      ],
      responseChoices: [
        { id: "c2ch2s4a", text: "Wisdom above all else. A noble philosophy.", reaction: "It is more than philosophy, traveler. It is a way of life. And you are living it now." },
        { id: "c2ch2s4b", text: "How did the elders decide which texts to encrypt?", reaction: "Only the most sacred. The rest were left open for all to read and learn." },
        { id: "c2ch2s4c", text: "Wisdom is great, but can it buy dinner?", reaction: "No. But it can teach you which berries are safe to eat. That is worth more." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 3: Hidden Prophecies (3 steps)
    {
      cipherId: 2,
      chapterNumber: 3,
      chapterTitle: "Hidden Prophecies",
      stepNumber: 1,
      storyText: "Ezra reveals that Atbash appears in the Book of Jeremiah and asks you to encrypt BABEL.",
      taskType: "encrypt",
      taskPlaintext: "BABEL",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Now I will show you something extraordinary, traveler. Open your mind, for this will change how you see our sacred texts." },
        { speaker: "Ezra", text: "In the Book of Jeremiah, the prophet wrote the word 'Sheshach.' For centuries, readers did not know what it meant." },
        { speaker: "Ezra", text: "But Sheshach is Atbash for Babel \u2014 Babylon. The prophet hid a prophecy against Babylon within the text itself, right under their noses." },
        { speaker: "Ezra", text: "Encrypt the word BABEL now. See with your own hands how it transforms when the alphabet is reversed." },
      ],
      responseChoices: [
        { id: "c2ch3s1a", text: "A hidden prophecy against Babylon, concealed in plain sight. Astonishing.", reaction: "The prophets trusted that the worthy would find the message when the time was right." },
        { id: "c2ch3s1b", text: "Why did Jeremiah need to hide Babylon's name?", reaction: "Because he wrote under Babylonian rule. Naming them openly would have been his death." },
        { id: "c2ch3s1c", text: "So Jeremiah was the original undercover agent?", reaction: "In a manner of speaking. Though his weapon was a reed pen, not a sword." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 3,
      chapterTitle: "Hidden Prophecies",
      stepNumber: 2,
      storyText: "Ezra discusses another biblical reference and asks you to decrypt a prophetic word.",
      taskType: "decrypt",
      taskPlaintext: "HOPE",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "The prophets did not hide words out of fear alone. They also hid messages of hope." },
        { speaker: "Ezra", text: "When a people are oppressed, hope itself becomes dangerous. The rulers feared nothing more than a hopeful populace." },
        { speaker: "Ezra", text: "So the scribes encoded the most uplifting promises, ensuring they survived even if every visible text was burned." },
        { speaker: "Ezra", text: "Decrypt this word. It is the message the prophets most wanted to preserve." },
      ],
      responseChoices: [
        { id: "c2ch3s2a", text: "Hope encoded so it could never be destroyed. That is deeply moving.", reaction: "The fire that burns brightest is the one you cannot see. That is what the prophets understood." },
        { id: "c2ch3s2b", text: "Were all prophetic hidden messages written in Atbash?", reaction: "Atbash was the most common method, but not the only one. The scribes had other tools as well." },
        { id: "c2ch3s2c", text: "Encoding hope? That is the most optimistic encryption I have ever heard of.", reaction: "Optimism wrapped in caution. The scribes would have liked you, traveler." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 3,
      chapterTitle: "Hidden Prophecies",
      stepNumber: 3,
      storyText: "Ezra reflects on how prophecy and cipher intertwine and presents another challenge.",
      taskType: "encrypt",
      taskPlaintext: "PSALM",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "The Psalms, too, contain layers of meaning that scholars still debate to this day." },
        { speaker: "Ezra", text: "Some believe that certain acrostic patterns in the Psalms conceal additional prayers visible only to those who know where to look." },
        { speaker: "Ezra", text: "Whether or not every theory is correct, the principle remains: sacred texts are deeper than they appear on the surface." },
        { speaker: "Ezra", text: "Encrypt this word. Honor the poets and prophets who layered meaning into every syllable." },
        { speaker: "Ezra", text: "And remember: what you see at first glance is never the full story." },
      ],
      responseChoices: [
        { id: "c2ch3s3a", text: "Layers within layers. The texts are alive with hidden meaning.", reaction: "Alive is the right word. A truly sacred text breathes with every reading." },
        { id: "c2ch3s3b", text: "How can scholars ever be sure they have found all the hidden meanings?", reaction: "They cannot. And that is what keeps them searching. The search itself is sacred." },
        { id: "c2ch3s3c", text: "Secret messages in hymns? The ancient world had the best surprises.", reaction: "Better than any surprise you can imagine. And some have yet to be discovered." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 4: The Temple Archives (4 steps)
    {
      cipherId: 2,
      chapterNumber: 4,
      chapterTitle: "The Temple Archives",
      stepNumber: 1,
      storyText: "Ezra leads you into the restricted temple archives where the most sacred knowledge is kept.",
      taskType: "encrypt",
      taskPlaintext: "TEMPLE",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Follow me, traveler. Beyond this door lies the temple archive \u2014 a place few are permitted to enter." },
        { speaker: "Ezra", text: "In the time of King Solomon, the location of sacred relics was encoded in these very records." },
        { speaker: "Ezra", text: "If enemies seized our writings, the hidden meanings would remain safe. Atbash was the lock, and knowledge was the key." },
        { speaker: "Ezra", text: "Encrypt the word TEMPLE. You are standing in the heart of where this cipher was born." },
      ],
      responseChoices: [
        { id: "c2ch4s1a", text: "I will protect these secrets as your ancestors did.", reaction: "Then you carry a sacred responsibility. Handle it with care and reverence." },
        { id: "c2ch4s1b", text: "Did enemies ever breach the temple archives?", reaction: "The walls fell more than once. But the encoded scrolls survived each time. Stone crumbles; ciphers endure." },
        { id: "c2ch4s1c", text: "King Solomon used ciphers? Was he also a nerd?", reaction: "He was the wisest man who ever lived. So... yes, probably." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 4,
      chapterTitle: "The Temple Archives",
      stepNumber: 2,
      storyText: "Ezra presents a longer word from a sacred inventory list.",
      taskType: "decrypt",
      taskPlaintext: "SACRED",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "The temple archives contain inventories of items considered too holy for common eyes." },
        { speaker: "Ezra", text: "Vessels of gold, tablets of law, garments of the high priest \u2014 each cataloged in Atbash to prevent theft or desecration." },
        { speaker: "Ezra", text: "This word describes the nature of everything stored within these walls. Decrypt it." },
      ],
      responseChoices: [
        { id: "c2ch4s2a", text: "An encrypted inventory of holy artifacts. The scribes thought of everything.", reaction: "Thoroughness is a virtue when the stakes are this high. Every detail mattered." },
        { id: "c2ch4s2b", text: "Were the inventory lists ever used to recover lost items?", reaction: "More than once. After the temple fell, the lists guided those who rebuilt. The cipher saved history." },
        { id: "c2ch4s2c", text: "Encrypted shopping lists? Even ancient people had to stay organized.", reaction: "Organization is the scaffolding of civilization. Even in a scriptorium." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 4,
      chapterTitle: "The Temple Archives",
      stepNumber: 3,
      storyText: "Ezra discusses why certain knowledge must be restricted and asks for an encryption.",
      taskType: "encrypt",
      taskPlaintext: "GUARD",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Not all knowledge should be freely shared, traveler. This is a truth the modern world sometimes forgets." },
        { speaker: "Ezra", text: "The names of certain rituals, the locations of hidden chambers, the words of power spoken only once a year by the high priest \u2014 these required protection." },
        { speaker: "Ezra", text: "Atbash was not about hiding from the people. It was about guarding the people from knowledge they were not prepared for." },
        { speaker: "Ezra", text: "Encrypt this word. It names the duty of every keeper of the archive." },
      ],
      responseChoices: [
        { id: "c2ch4s3a", text: "Guarding knowledge for the right time and the right people. I understand.", reaction: "Understanding is the first step. The second is the discipline to act upon it." },
        { id: "c2ch4s3b", text: "Who decided when someone was ready for restricted knowledge?", reaction: "The elders. Through years of study, character, and demonstrated wisdom. There were no shortcuts." },
        { id: "c2ch4s3c", text: "Restricted knowledge? Is there a VIP section in this archive?", reaction: "In a sense, yes. And you are standing in it. Do not squander the privilege." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 4,
      chapterTitle: "The Temple Archives",
      stepNumber: 4,
      storyText: "Ezra tests with a word that connects to the archive's purpose.",
      taskType: "decrypt",
      taskPlaintext: "RELIC",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Deep in the archive, there are records of objects so ancient that even we are uncertain of their origin." },
        { speaker: "Ezra", text: "Some say they predate Solomon himself. Artifacts from a time when the world was younger and closer to the divine." },
        { speaker: "Ezra", text: "This word was found on a clay tag attached to one such object. Decrypt it and glimpse across the ages." },
        { speaker: "Ezra", text: "Handle the meaning gently. Some words carry the weight of millennia." },
      ],
      responseChoices: [
        { id: "c2ch4s4a", text: "Objects older than Solomon. The history here is staggering.", reaction: "History does not merely sit on shelves here. It breathes in every shadow." },
        { id: "c2ch4s4b", text: "Were these ancient relics ever studied by outsiders?", reaction: "Never. The archive guarded them jealously. You are among the very few to even hear of them." },
        { id: "c2ch4s4c", text: "A clay tag? The ancient world's version of a sticky note.", reaction: "Cruder, yes. But those clay tags have lasted longer than any paper ever will." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 5: Exile and Endurance (3 steps)
    {
      cipherId: 2,
      chapterNumber: 5,
      chapterTitle: "Exile and Endurance",
      stepNumber: 1,
      storyText: "Ezra speaks of the Babylonian exile and why scribes encoded their most important texts to survive persecution.",
      taskType: "encrypt",
      taskPlaintext: "EXILE",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Now I must tell you of the darkest chapter in our history, traveler. The exile to Babylon." },
        { speaker: "Ezra", text: "The temple was destroyed. Our people were marched across the desert in chains. Everything we had built lay in ruins." },
        { speaker: "Ezra", text: "But the scribes \u2014 the scribes smuggled words. In their memories, on hidden scraps of parchment, encoded so no captor could read them." },
        { speaker: "Ezra", text: "Atbash was not a game during the exile. It was survival. Encrypt this word that defined an entire generation." },
      ],
      responseChoices: [
        { id: "c2ch5s1a", text: "The cipher became a lifeline. That gives these letters a weight I did not expect.", reaction: "Every time you reverse a letter, you echo the courage of those who did so under the shadow of death." },
        { id: "c2ch5s1b", text: "How did the scribes hide their parchments during the march?", reaction: "Sewn into garments, memorized in song, scratched onto the insides of water vessels. Desperation breeds ingenuity." },
        { id: "c2ch5s1c", text: "Smuggling words? The original underground publishing.", reaction: "Underground indeed. Sometimes literally buried in the earth until safer days." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 5,
      chapterTitle: "Exile and Endurance",
      stepNumber: 2,
      storyText: "Ezra describes how coded messages sustained hope among the exiled and asks for a decryption.",
      taskType: "decrypt",
      taskPlaintext: "PEACE",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "In Babylon, our people gathered in secret. They whispered of return, of rebuilding, of a future beyond chains." },
        { speaker: "Ezra", text: "The coded messages passed between groups carried more than information. They carried the promise that this suffering would end." },
        { speaker: "Ezra", text: "Every encrypted word was an act of defiance against despair. To encrypt was to believe in tomorrow." },
        { speaker: "Ezra", text: "Decrypt this word. It is what the exiles prayed for every night, written in a cipher their captors could not read." },
      ],
      responseChoices: [
        { id: "c2ch5s2a", text: "Encryption as an act of hope. I never thought of it that way.", reaction: "Most see ciphers as tools of secrecy. But at their best, they are tools of faith." },
        { id: "c2ch5s2b", text: "Did the Babylonians ever suspect the coded messages?", reaction: "Some did. But they dismissed them as nonsense writing. The arrogance of conquerors is a cipher's best ally." },
        { id: "c2ch5s2c", text: "Defiance through encryption. The world's quietest rebellion.", reaction: "The quietest rebellions are often the most enduring. Shouts fade. Written words do not." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 5,
      chapterTitle: "Exile and Endurance",
      stepNumber: 3,
      storyText: "Ezra connects the exile to the enduring power of encoded texts.",
      taskType: "encrypt",
      taskPlaintext: "IRON",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "When the exile ended and our people returned, the first thing they did was rebuild the temple. The second was to decode the hidden texts." },
        { speaker: "Ezra", text: "Seventy years of encoding had created a vast library of secret knowledge that had survived the destruction of everything else." },
        { speaker: "Ezra", text: "Stone had crumbled. Bronze had melted. But the cipher endured. Atbash proved stronger than the chains of Babylon." },
        { speaker: "Ezra", text: "Encrypt this word. It names the material of the chains \u2014 the very thing the cipher outlasted." },
        { speaker: "Ezra", text: "Let each letter you reverse remind you: ideas are more durable than any metal." },
      ],
      responseChoices: [
        { id: "c2ch5s3a", text: "The cipher outlasted iron chains. Words truly are the strongest material.", reaction: "You speak like a scribe now, traveler. The elders would be proud." },
        { id: "c2ch5s3b", text: "Seventy years of encoded texts? That is an incredible archive.", reaction: "Incredible and irreplaceable. Each fragment we recovered was a miracle." },
        { id: "c2ch5s3c", text: "Stronger than iron? I hope the cipher does not rust.", reaction: "Ideas do not rust. They only sharpen with age." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 6: The Mirror Alphabet (4 steps)
    {
      cipherId: 2,
      chapterNumber: 6,
      chapterTitle: "The Mirror Alphabet",
      stepNumber: 1,
      storyText: "Ezra formally teaches the self-inverse property of Atbash: applying it twice returns the original.",
      taskType: "encrypt",
      taskPlaintext: "MIRROR",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Now I will teach you the most beautiful property of Atbash \u2014 the one that makes it truly unique among ciphers." },
        { speaker: "Ezra", text: "If you encrypt a word with Atbash and then encrypt the result again, you get back the original word. The cipher is its own reverse." },
        { speaker: "Ezra", text: "Think of it like a mirror. Look into a mirror, and you see a reflection. Look into the reflection of a reflection, and you see yourself again." },
        { speaker: "Ezra", text: "Encrypt this word. And then, if you wish, encrypt the result \u2014 and watch the original reappear." },
      ],
      responseChoices: [
        { id: "c2ch6s1a", text: "Encryption and decryption are the same operation. A perfect symmetry.", reaction: "Perfect symmetry. You name it well. The ancients saw divine order in such things." },
        { id: "c2ch6s1b", text: "Why does this happen mathematically?", reaction: "Because reversing a reversal returns to the start. If A maps to Z, then Z maps back to A. The pairing is mutual." },
        { id: "c2ch6s1c", text: "A mirror cipher? I hope it doesn't show my messy hair.", reaction: "It shows only truth, traveler. Whether your hair is part of that truth, I leave to you." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 6,
      chapterTitle: "The Mirror Alphabet",
      stepNumber: 2,
      storyText: "Ezra demonstrates the self-inverse principle with a practical decryption.",
      taskType: "decrypt",
      taskPlaintext: "SOUL",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Because Atbash is self-inverse, there is no separate decryption process. You simply apply the same transformation." },
        { speaker: "Ezra", text: "This made Atbash invaluable to scribes who needed speed. In times of danger, fumbling with a different decryption method could mean capture." },
        { speaker: "Ezra", text: "One rule. One operation. Encode or decode in a single step. That simplicity saved lives." },
        { speaker: "Ezra", text: "Decrypt this word. Notice that you are performing the exact same operation as encryption." },
      ],
      responseChoices: [
        { id: "c2ch6s2a", text: "One rule for both directions. Elegant and practical.", reaction: "Elegance and practicality are not often friends. In Atbash, they are inseparable." },
        { id: "c2ch6s2b", text: "Are there other ciphers that are self-inverse?", reaction: "A few. ROT13 in the Roman tradition shares this property. Great minds arrive at similar truths." },
        { id: "c2ch6s2c", text: "So I have been decrypting this whole time using the same trick? Sneaky, Ezra.", reaction: "Not sneaky. Consistent. There is a difference." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 6,
      chapterTitle: "The Mirror Alphabet",
      stepNumber: 3,
      storyText: "Ezra explores the philosophical meaning of the mirror property.",
      taskType: "encrypt",
      taskPlaintext: "GRACE",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "The rabbis taught that creation itself contains mirrors. Day reflects night. Land reflects sea. The seen reflects the unseen." },
        { speaker: "Ezra", text: "Atbash embodies this teaching in letters. Every word has a hidden twin. Every message, a shadow self." },
        { speaker: "Ezra", text: "To know both the word and its cipher is to see creation from both sides. That is a rare gift." },
        { speaker: "Ezra", text: "Encrypt this word. It names the quality that makes such double vision possible." },
      ],
      responseChoices: [
        { id: "c2ch6s3a", text: "The cipher as a reflection of creation. That is a profound way to see it.", reaction: "Profundity hides in simple things, traveler. The mirror alphabet is proof." },
        { id: "c2ch6s3b", text: "Every word has a hidden twin. Does that mean every encrypted word is equally meaningful?", reaction: "An intriguing thought. Some scholars believe so. That the ciphertext itself carries its own truth." },
        { id: "c2ch6s3c", text: "Double vision? I usually need to visit a tavern for that.", reaction: "This kind of double vision will not give you a headache. Quite the opposite." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 6,
      chapterTitle: "The Mirror Alphabet",
      stepNumber: 4,
      storyText: "Ezra gives a final challenge on the mirror principle.",
      taskType: "decrypt",
      taskPlaintext: "FLAME",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Before we leave the mirror behind, one last reflection." },
        { speaker: "Ezra", text: "The eternal lamp in the temple was never allowed to go out. It burned as a symbol that truth persists even in darkness." },
        { speaker: "Ezra", text: "Atbash is like that lamp. No matter how many times you apply it, the truth always returns. It cannot be permanently hidden." },
        { speaker: "Ezra", text: "Decrypt this word. It names the light that never goes out." },
      ],
      responseChoices: [
        { id: "c2ch6s4a", text: "A cipher that always returns to truth. The eternal lamp of language.", reaction: "You speak beautifully, traveler. The lamp burns brighter in your hands." },
        { id: "c2ch6s4b", text: "Is that why Atbash was trusted with the most sacred texts?", reaction: "Partly, yes. A cipher that cannot permanently hide truth was seen as trustworthy by the priests." },
        { id: "c2ch6s4c", text: "A lamp that never goes out? Someone is paying a lot for oil.", reaction: "The oil of knowledge is freely given. It is the wick of discipline that costs effort." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 7: Guardians of the Word (3 steps)
    {
      cipherId: 2,
      chapterNumber: 7,
      chapterTitle: "Guardians of the Word",
      stepNumber: 1,
      storyText: "Ezra speaks of the scribe's sacred duty and the oath they take to protect encoded knowledge.",
      taskType: "encrypt",
      taskPlaintext: "SCRIBE",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "To be a scribe is more than copying letters onto parchment, traveler." },
        { speaker: "Ezra", text: "A scribe is a guardian. A keeper of meaning. When empires fall and cities burn, the scribe ensures truth survives." },
        { speaker: "Ezra", text: "We take an oath: to preserve, to protect, and to pass forward. Every letter we encrypt carries that weight." },
        { speaker: "Ezra", text: "Encrypt this word \u2014 the title that defines our calling and our burden." },
      ],
      responseChoices: [
        { id: "c2ch7s1a", text: "I understand the responsibility. I will not let you down.", reaction: "Your words have the weight of sincerity. That is rare and deeply valued." },
        { id: "c2ch7s1b", text: "Were all scribes trained in Atbash?", reaction: "Only the most trusted. Many scribes copied without ever knowing what lay beneath the words." },
        { id: "c2ch7s1c", text: "Guardian of letters? Sounds like the world's oldest desk job.", reaction: "This desk job has outlasted every throne in history. Show some respect." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 7,
      chapterTitle: "Guardians of the Word",
      stepNumber: 2,
      storyText: "Ezra discusses what happens when the chain of guardians is broken.",
      taskType: "decrypt",
      taskPlaintext: "OATH",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "There were times when the chain of guardians nearly broke. Wars, plagues, persecutions \u2014 each threatened to sever the line." },
        { speaker: "Ezra", text: "But always, at least one scribe survived. One keeper who remembered the method, who could decode the hidden texts." },
        { speaker: "Ezra", text: "That is why we never rely on a single keeper. The knowledge is shared among trusted few, never hoarded by one." },
        { speaker: "Ezra", text: "Decrypt this word. It names the bond that holds the guardians together across generations." },
      ],
      responseChoices: [
        { id: "c2ch7s2a", text: "A chain of guardians spanning centuries. I am honored to be a link.", reaction: "Every link matters equally, traveler. The chain is only as strong as its newest member." },
        { id: "c2ch7s2b", text: "How were new guardians chosen?", reaction: "Through years of observation. Character mattered more than skill. Skill can be taught; integrity cannot." },
        { id: "c2ch7s2c", text: "So the backup plan for the backup plan has a backup plan?", reaction: "You jest, but yes. Redundancy is the guardian's greatest ally." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 7,
      chapterTitle: "Guardians of the Word",
      stepNumber: 3,
      storyText: "Ezra reflects on the personal cost of being a guardian and tests with a meaningful word.",
      taskType: "encrypt",
      taskPlaintext: "SHIELD",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Being a guardian is not without cost, traveler. You carry secrets you can never speak aloud." },
        { speaker: "Ezra", text: "You watch others read the surface of the text, never knowing what lies beneath. And you cannot tell them." },
        { speaker: "Ezra", text: "The guardian is both sword and shield \u2014 protecting the text from those who would misuse it, and protecting the world from knowledge it is not ready for." },
        { speaker: "Ezra", text: "Encrypt this word. It names one half of the guardian's role." },
        { speaker: "Ezra", text: "And remember: a shield does not choose what it protects. It simply stands firm." },
      ],
      responseChoices: [
        { id: "c2ch7s3a", text: "To carry secrets in silence. That is a lonely burden, but a noble one.", reaction: "Loneliness and nobility often walk the same path. You understand this well." },
        { id: "c2ch7s3b", text: "Has a guardian ever been tempted to reveal everything?", reaction: "Temptation is constant. But the oath holds. It has held for three thousand years." },
        { id: "c2ch7s3c", text: "A shield made of letters. Not the most practical in a sword fight.", reaction: "You would be surprised. A well-placed word has stopped more wars than any sword." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 8: Whispers in Stone (4 steps)
    {
      cipherId: 2,
      chapterNumber: 8,
      chapterTitle: "Whispers in Stone",
      stepNumber: 1,
      storyText: "Ezra shows ancient inscriptions carved in stone that used Atbash encoding.",
      taskType: "encrypt",
      taskPlaintext: "STONE",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Come with me outside the scriptorium, traveler. I want to show you something carved into the foundation stones." },
        { speaker: "Ezra", text: "These inscriptions predate the building itself. They were carved by the original architects who laid these foundations." },
        { speaker: "Ezra", text: "The letters are weathered but still readable \u2014 to those who know Atbash. To everyone else, they are meaningless scratches." },
        { speaker: "Ezra", text: "Encrypt this word. It names the medium that has preserved these messages for longer than any scroll." },
      ],
      responseChoices: [
        { id: "c2ch8s1a", text: "Messages carved in stone, waiting centuries for someone to read them. Remarkable.", reaction: "Patience is carved into the very nature of stone. And into the nature of Atbash." },
        { id: "c2ch8s1b", text: "How did archaeologists know to look for Atbash in the carvings?", reaction: "Most did not. The carvings were dismissed as decorative marks for generations. Only a scribe would recognize the truth." },
        { id: "c2ch8s1c", text: "So the walls have been whispering secrets this whole time?", reaction: "Whispering patiently. Stone has nothing but time." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 8,
      chapterTitle: "Whispers in Stone",
      stepNumber: 2,
      storyText: "Ezra discusses how Atbash was found on pottery fragments and other archaeological finds.",
      taskType: "decrypt",
      taskPlaintext: "CLAY",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Not all inscriptions were carved in stone. Many were scratched onto fragments of pottery \u2014 broken vessels repurposed as writing surfaces." },
        { speaker: "Ezra", text: "Archaeologists have found these fragments scattered across the ancient world. Some contain lists, some contain prayers, and some contain Atbash." },
        { speaker: "Ezra", text: "The humble potsherd became an unlikely carrier of eternal secrets." },
        { speaker: "Ezra", text: "Decrypt this word. It names the material that held these fragile messages together." },
      ],
      responseChoices: [
        { id: "c2ch8s2a", text: "Eternal secrets on broken pottery. There is poetry in that.", reaction: "The divine often chooses humble vessels. Broken ones, especially." },
        { id: "c2ch8s2b", text: "How many of these fragments have been deciphered?", reaction: "Only a fraction. Many sit in museum storerooms, unread. Perhaps you will be the one to decode them." },
        { id: "c2ch8s2c", text: "Recycling broken pots as notepads? Ancient people were eco-friendly.", reaction: "Waste nothing. That principle applied to pottery and to words alike." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 8,
      chapterTitle: "Whispers in Stone",
      stepNumber: 3,
      storyText: "Ezra speaks of inscriptions found in burial sites.",
      taskType: "encrypt",
      taskPlaintext: "DUST",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Some of the most important Atbash inscriptions were found in burial sites, traveler." },
        { speaker: "Ezra", text: "The names of the departed were sometimes encoded \u2014 not to hide them, but to protect them from being invoked by sorcerers." },
        { speaker: "Ezra", text: "In the ancient world, to know a name was to hold power over a soul. Atbash kept the dead safe from those who would disturb them." },
        { speaker: "Ezra", text: "Encrypt this word. It names what all things return to, and what the cipher protects even beyond life." },
      ],
      responseChoices: [
        { id: "c2ch8s3a", text: "Protecting names even after death. That is a profound form of respect.", reaction: "Respect for the departed is the foundation of all our traditions. Atbash extends that respect into eternity." },
        { id: "c2ch8s3b", text: "Did people truly believe names held that kind of power?", reaction: "Belief shapes reality, traveler. Whether or not the power was real, the protection was earnest." },
        { id: "c2ch8s3c", text: "Anti-sorcery encryption? That is a use case I did not expect.", reaction: "The ancient world had concerns you cannot imagine. Atbash adapted to all of them." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 8,
      chapterTitle: "Whispers in Stone",
      stepNumber: 4,
      storyText: "Ezra reflects on how ciphers survive through centuries in physical form.",
      taskType: "decrypt",
      taskPlaintext: "TORCH",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Stone crumbles. Parchment burns. Clay shatters. And yet \u2014 the cipher endures." },
        { speaker: "Ezra", text: "Because the cipher is not the medium. It is the method. As long as one person remembers the method, every lost text can be recreated." },
        { speaker: "Ezra", text: "That is why I teach you now, traveler. You are not merely learning a technique. You are becoming a living vessel for it." },
        { speaker: "Ezra", text: "Decrypt this word. It names the light that passes from one generation to the next." },
      ],
      responseChoices: [
        { id: "c2ch8s4a", text: "I am a living vessel for the cipher. I will carry it forward.", reaction: "That is exactly what every guardian before you has said. And they kept their word." },
        { id: "c2ch8s4b", text: "The method outlives every physical medium. That is a powerful idea.", reaction: "The most powerful. Empires of stone fall. Empires of ideas persist." },
        { id: "c2ch8s4c", text: "A living vessel? I hope I do not leak.", reaction: "Keep your vessel sealed with discipline, and you will be fine." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 9: The Living Cipher (3 steps)
    {
      cipherId: 2,
      chapterNumber: 9,
      chapterTitle: "The Living Cipher",
      stepNumber: 1,
      storyText: "Ezra connects Atbash to the broader world of ciphers and modern cryptography.",
      taskType: "encrypt",
      taskPlaintext: "CIPHER",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Atbash is ancient, traveler, but it is only one thread in a vast tapestry of hidden writing." },
        { speaker: "Ezra", text: "In other lands, other scholars developed their own methods. The Romans shifted letters. The Greeks used grids. The Arabs pioneered frequency analysis." },
        { speaker: "Ezra", text: "But all share the same heart: the desire to protect what matters most. Atbash is the ancestor of every cipher that followed." },
        { speaker: "Ezra", text: "Encrypt this word. It names the art itself \u2014 the craft that connects all of us across time and culture." },
      ],
      responseChoices: [
        { id: "c2ch9s1a", text: "The art of ciphers connects civilizations. A beautiful thought.", reaction: "Across every border and every century, the need for secrecy unites us. You see the thread." },
        { id: "c2ch9s1b", text: "Did the Hebrew scribes know about the Roman ciphers?", reaction: "Perhaps. Traders and scholars carried knowledge farther than armies ever could." },
        { id: "c2ch9s1c", text: "So everyone was encrypting? Nobody trusted anyone?", reaction: "Trust is a luxury. Encryption is insurance. Wise people have both." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 9,
      chapterTitle: "The Living Cipher",
      stepNumber: 2,
      storyText: "Ezra speaks of how substitution ciphers evolved and asks for a decryption.",
      taskType: "decrypt",
      taskPlaintext: "SECRET",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Atbash is a substitution cipher \u2014 each letter is replaced by another according to a fixed rule." },
        { speaker: "Ezra", text: "From this simple idea, ever more complex methods grew. Multiple alphabets. Shifting keys. Polyalphabetic ciphers that changed the substitution with every letter." },
        { speaker: "Ezra", text: "And in the age to come, machines will perform substitutions millions of times per heartbeat. But the principle remains the same." },
        { speaker: "Ezra", text: "Decrypt this word. It names what every cipher, from Atbash to the future, is designed to protect." },
      ],
      responseChoices: [
        { id: "c2ch9s2a", text: "From a reversed alphabet to machines. What an incredible lineage.", reaction: "And every step of that lineage traces back to the idea of substitution. Our idea." },
        { id: "c2ch9s2b", text: "Machines that encrypt? You have a vivid imagination, Ezra.", reaction: "Every impossibility is just a future certainty waiting for its moment." },
        { id: "c2ch9s2c", text: "Millions of substitutions per heartbeat? My heart is racing just thinking about it.", reaction: "Channel that energy into your decryption, traveler." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 9,
      chapterTitle: "The Living Cipher",
      stepNumber: 3,
      storyText: "Ezra reflects on Atbash's enduring relevance and legacy.",
      taskType: "encrypt",
      taskPlaintext: "LEGACY",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Some say Atbash is too simple for the modern world. That it can be broken in moments by anyone who knows of it." },
        { speaker: "Ezra", text: "They are right about the breaking. But they are wrong about its value." },
        { speaker: "Ezra", text: "Atbash taught humanity that information can be transformed. That meaning can be hidden and revealed at will. That idea changed the world forever." },
        { speaker: "Ezra", text: "Encrypt this word. It names what Atbash has left for all the ciphers that followed." },
        { speaker: "Ezra", text: "A simple reversal of letters \u2014 and the entire future of secrecy was born from it." },
      ],
      responseChoices: [
        { id: "c2ch9s3a", text: "Atbash may be simple, but it planted the seed for everything that followed.", reaction: "And the mightiest cedar begins as the smallest seed. You understand perfectly." },
        { id: "c2ch9s3b", text: "Is Atbash still used anywhere today?", reaction: "As a teaching tool, yes. And occasionally as a layer in more complex systems. The old ways have not been entirely forgotten." },
        { id: "c2ch9s3c", text: "So Atbash is the grandparent of modern encryption? I hope it is proud.", reaction: "If alphabets could feel pride, I assure you, this one would be beaming." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 10: The Keeper's Final Test (5 steps)
    {
      cipherId: 2,
      chapterNumber: 10,
      chapterTitle: "The Keeper's Final Test",
      stepNumber: 1,
      storyText: "Ezra presents the final challenge: a series of tests to prove mastery of Atbash.",
      taskType: "encrypt",
      taskPlaintext: "KEEPER",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "You have journeyed far, traveler. From a curious stranger to someone I trust with the oldest cipher known to our people." },
        { speaker: "Ezra", text: "This final chapter is your trial of mastery. A series of challenges to prove that Atbash lives not just in your hands, but in your heart." },
        { speaker: "Ezra", text: "No hints. No guidance beyond the task itself. You have everything you need already." },
        { speaker: "Ezra", text: "We begin with the title you are about to earn. Encrypt the word KEEPER. Show me you are worthy of it." },
      ],
      responseChoices: [
        { id: "c2ch10s1a", text: "I am ready, Ezra. Everything you have taught me lives within.", reaction: "Then let it speak through your work. The trial begins." },
        { id: "c2ch10s1b", text: "A trial of mastery. What happens if I fail?", reaction: "You will not fail. I have watched you grow. But if you stumble, you will simply rise and try again." },
        { id: "c2ch10s1c", text: "A final test? Can I at least get a study break first?", reaction: "You have been studying for ten chapters, traveler. The break comes after." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 10,
      chapterTitle: "The Keeper's Final Test",
      stepNumber: 2,
      storyText: "Ezra tests decryption with a word that evokes the full journey.",
      taskType: "decrypt",
      taskPlaintext: "HIDDEN",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "Throughout our journey, we have spoken of things concealed \u2014 prophecies, inventories, names of the departed." },
        { speaker: "Ezra", text: "Atbash exists because some things must wait for the right moment and the right person to be revealed." },
        { speaker: "Ezra", text: "Decrypt this word. It describes the state of everything Atbash was designed to protect." },
      ],
      responseChoices: [
        { id: "c2ch10s2a", text: "The right moment, the right person. I hope I am both.", reaction: "You are here, and you are decrypting. That is all the proof required." },
        { id: "c2ch10s2b", text: "Is anything truly hidden forever?", reaction: "Nothing. Every secret has its appointed hour of revelation. Atbash merely chooses the hour." },
        { id: "c2ch10s2c", text: "I have gotten very good at finding hidden things. Check behind my ear next.", reaction: "I will leave the magic tricks to you. Focus on the cipher trick before you." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 10,
      chapterTitle: "The Keeper's Final Test",
      stepNumber: 3,
      storyText: "Ezra tests with a word that connects to the beginning of the journey.",
      taskType: "encrypt",
      taskPlaintext: "DAWN",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "We began this journey by lamplight, traveler. Now the lamp burns low, but something else is rising." },
        { speaker: "Ezra", text: "Outside the scriptorium, the sky is brightening. A new day approaches \u2014 your first as a keeper." },
        { speaker: "Ezra", text: "Encrypt this word. It names what awaits you beyond these walls." },
        { speaker: "Ezra", text: "Every ending is merely another beginning, viewed from the other side." },
      ],
      responseChoices: [
        { id: "c2ch10s3a", text: "From lamplight to a new day. The symbolism is not lost on me.", reaction: "Good. A keeper must read meaning in all things, not just in letters." },
        { id: "c2ch10s3b", text: "My first day as a keeper. What responsibilities does that carry?", reaction: "To remember. To protect. And when the time comes, to teach another as I have taught you." },
        { id: "c2ch10s3c", text: "A new day? I have been in this scriptorium so long I forgot what sunlight looks like.", reaction: "The sun has not changed. But you have. Go and see it with new eyes." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 10,
      chapterTitle: "The Keeper's Final Test",
      stepNumber: 4,
      storyText: "Ezra gives a penultimate challenge with a word that captures the essence of the cipher.",
      taskType: "decrypt",
      taskPlaintext: "SPIRIT",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "The cipher is not merely a technique, traveler. It is a living tradition carried by those who practice it." },
        { speaker: "Ezra", text: "When the last stone of the temple crumbled, the cipher survived. When the last scroll turned to ash, the cipher survived." },
        { speaker: "Ezra", text: "Because the cipher lives not in ink or stone, but in something far more enduring." },
        { speaker: "Ezra", text: "Decrypt this word. It names where the cipher truly resides." },
      ],
      responseChoices: [
        { id: "c2ch10s4a", text: "The cipher lives in the spirit of its keepers. Now it lives in mine.", reaction: "And it will burn there until you pass it forward. The chain continues through you." },
        { id: "c2ch10s4b", text: "A tradition that survives the destruction of every physical record. Extraordinary.", reaction: "Extraordinary, and true. You have witnessed the proof with your own work here." },
        { id: "c2ch10s4c", text: "Something more enduring than stone? That is a high bar.", reaction: "And yet the cipher clears it effortlessly. As do you, traveler." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 2,
      chapterNumber: 10,
      chapterTitle: "The Keeper's Final Test",
      stepNumber: 5,
      storyText: "The final test. Ezra asks you to decrypt the word that defines your transformation.",
      taskType: "decrypt",
      taskPlaintext: "FORGED",
      taskShift: 0,
      taskCiphertext: "",
      speaker: "Ezra",
      speakerAvatar: "ezra",
      dialogueLines: [
        { speaker: "Ezra", text: "This is it, traveler. The final word. The last test." },
        { speaker: "Ezra", text: "I chose this word carefully. It describes what has happened to you across these ten chapters." },
        { speaker: "Ezra", text: "You arrived as raw metal \u2014 curious but unformed. Through fire and patience, you have become something stronger." },
        { speaker: "Ezra", text: "Decrypt it. Speak it aloud. And know that you have earned your place among the keepers of Atbash." },
        { speaker: "Ezra", text: "It has been my honor, traveler. Go forth and guard the words of the world. Shalom." },
      ],
      responseChoices: [
        { id: "c2ch10s5a", text: "The honor has been mine, Ezra. I will carry this knowledge forever.", reaction: "And it will carry you. Through every challenge, every secret, every word yet unwritten. Shalom, keeper." },
        { id: "c2ch10s5b", text: "From the scriptorium to mastery. Thank you for this journey.", reaction: "The journey does not end here. It only changes direction. Go and build upon what we have started together." },
        { id: "c2ch10s5c", text: "Do I finally get a certificate of completion?", reaction: "Your certificate is the knowledge itself. It cannot be taken from you. Now go. Forge your own legacy, keeper." },
      ],
      stepType: "dialogue_task",
    },

    // ===== VIGENERE CIPHER (cipherId: 3) - 10 Chapters =====

    // Chapter 1: The Workshop (4 steps) - Introduction to polyalphabetic cipher, keyword concept
    {
      cipherId: 3,
      chapterNumber: 1,
      chapterTitle: "The Workshop",
      stepNumber: 1,
      storyText: "Bellaso welcomes you to his workshop and introduces the polyalphabetic cipher concept.",
      taskType: "encrypt",
      taskPlaintext: "HELLO",
      taskShift: 0,
      taskKeyword: "KEY",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Benvenuto, my friend! Welcome to my humble workshop in beautiful Italia. I am Giovan Battista Bellaso." },
        { speaker: "Bellaso", text: "You have studied Caesar's cipher, yes? A single shift for every letter. Elegant, but tragically simple to break." },
        { speaker: "Bellaso", text: "My invention is different. Instead of one shift, I use a keyword. Each letter of the keyword determines a different shift for each letter of the message." },
        { speaker: "Bellaso", text: "With the keyword KEY: K shifts by 10, E shifts by 4, Y shifts by 24 \u2014 and then the keyword repeats! Try it. Encrypt HELLO using the keyword KEY." },
      ],
      responseChoices: [
        { id: "c3ch1s1a", text: "A different shift for each letter? That is brilliant, Bellaso.", reaction: "Brilliance is my specialty, friend. But even brilliance requires practice to master." },
        { id: "c3ch1s1b", text: "How is this stronger than a single shift?", reaction: "Because the same letter encrypts differently each time! An E might become I, then J, then C. The pattern vanishes." },
        { id: "c3ch1s1c", text: "Can the keyword be PIZZA?", reaction: "Ha! An excellent keyword, and delicious too. But for now, let us stick with KEY. Capisce?" },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 1,
      chapterTitle: "The Workshop",
      stepNumber: 2,
      storyText: "Bellaso explains how decryption works with a keyword and asks you to reverse the process.",
      taskType: "decrypt",
      taskPlaintext: "PEACE",
      taskShift: 0,
      taskKeyword: "SUN",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Magnifico! You learn faster than most of my patrons, and they pay handsomely for the privilege." },
        { speaker: "Bellaso", text: "Now, to decrypt, you simply reverse the process. Instead of shifting forward by the keyword letter, you shift backward." },
        { speaker: "Bellaso", text: "If the keyword letter is S \u2014 the 19th letter \u2014 you shifted forward by 18 to encrypt. To decrypt, shift backward by 18." },
        { speaker: "Bellaso", text: "A message has arrived from a merchant in Padua. The keyword is SUN. Decrypt it and tell me what it says." },
      ],
      responseChoices: [
        { id: "c3ch1s2a", text: "Reverse the shift. I understand the symmetry.", reaction: "Symmetry is the soul of mathematics, friend. You have a good eye for it." },
        { id: "c3ch1s2b", text: "So both sender and receiver must know the keyword?", reaction: "Precisely! The keyword is the shared secret. Without it, the message is impenetrable." },
        { id: "c3ch1s2c", text: "A merchant from Padua? Is he selling ciphers or cheese?", reaction: "Both, knowing Paduan merchants. They are nothing if not enterprising." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 1,
      chapterTitle: "The Workshop",
      stepNumber: 3,
      storyText: "Bellaso explains how the keyword repeats across the message.",
      taskType: "encrypt",
      taskPlaintext: "TRADE",
      taskShift: 0,
      taskKeyword: "ROSE",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Here is the beautiful part, friend \u2014 the keyword repeats across the entire message, cycling endlessly." },
        { speaker: "Bellaso", text: "If your keyword is ROSE and your message is TRADE, the letters pair up: T-R, R-O, A-S, D-E, E-R." },
        { speaker: "Bellaso", text: "Notice that the keyword wraps around! After the E in ROSE, we go back to R. It is like a wheel turning." },
        { speaker: "Bellaso", text: "Encrypt TRADE with keyword ROSE. Feel the rhythm of the repeating key." },
      ],
      responseChoices: [
        { id: "c3ch1s3a", text: "A repeating wheel of shifts. Elegant design, Bellaso.", reaction: "Elegance and security, hand in hand. That is the Italian way." },
        { id: "c3ch1s3b", text: "What if the keyword is longer than the message?", reaction: "Then you only use as many keyword letters as you need. The rest wait patiently for the next message." },
        { id: "c3ch1s3c", text: "TRADE with ROSE? Are we encrypting or opening a flower shop?", reaction: "In Renaissance Italy, flowers and espionage go hand in hand. Encrypt it!" },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 1,
      chapterTitle: "The Workshop",
      stepNumber: 4,
      storyText: "Bellaso explains monoalphabetic vs polyalphabetic and gives a final introductory challenge.",
      taskType: "decrypt",
      taskPlaintext: "BLADE",
      taskShift: 0,
      taskKeyword: "KEY",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Let me explain why my cipher is revolutionary, friend. Caesar uses one alphabet \u2014 monoalphabetic." },
        { speaker: "Bellaso", text: "My cipher uses many alphabets \u2014 polyalphabetic. The letter A might become K in one position and F in another." },
        { speaker: "Bellaso", text: "This means a spy who counts letter frequencies will find nothing useful. The patterns are destroyed!" },
        { speaker: "Bellaso", text: "One more decryption before we leave the workshop. Keyword is KEY. Show me you understand the fundamentals." },
      ],
      responseChoices: [
        { id: "c3ch1s4a", text: "Many alphabets layered together. The foundation is clear.", reaction: "Good. A strong foundation supports everything we will build upon it." },
        { id: "c3ch1s4b", text: "So frequency analysis is completely useless against this?", reaction: "Completely! That single fact kept my cipher unbroken for three hundred years." },
        { id: "c3ch1s4c", text: "Polyalphabetic. I am going to need more syllables for this.", reaction: "Ha! Think of it as 'many shifts.' Fewer syllables, same genius." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 2: Letters to Venice (4 steps) - Practice with simple keywords
    {
      cipherId: 3,
      chapterNumber: 2,
      chapterTitle: "Letters to Venice",
      stepNumber: 1,
      storyText: "Bellaso sends encrypted letters to a contact in Venice using a short keyword.",
      taskType: "encrypt",
      taskPlaintext: "GUILD",
      taskShift: 0,
      taskKeyword: "SUN",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Enough theory, friend. It is time for real work. I have a contact in Venice \u2014 a glassmaker who also trades in secrets." },
        { speaker: "Bellaso", text: "We use short keywords for everyday correspondence. Three or four letters. Easy to remember, quick to apply." },
        { speaker: "Bellaso", text: "The keyword SUN has served us well this month. Short, but it still gives us three different shifts to cycle through." },
        { speaker: "Bellaso", text: "Encrypt GUILD for our Venetian friend. He needs to know which guild is meeting tonight." },
      ],
      responseChoices: [
        { id: "c3ch2s1a", text: "Short keywords for routine messages. Practical and efficient.", reaction: "Exactly. Not every message needs a fortress. Some just need a sturdy lock." },
        { id: "c3ch2s1b", text: "Do you change keywords often?", reaction: "Every month, like clockwork. A keyword that lingers too long becomes a liability." },
        { id: "c3ch2s1c", text: "A glassmaker who trades secrets? Venice sounds exciting.", reaction: "Venice is a city built on water and intrigue. Everyone there has at least two professions." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 2,
      chapterTitle: "Letters to Venice",
      stepNumber: 2,
      storyText: "A reply arrives from Venice. Bellaso asks you to decrypt it.",
      taskType: "decrypt",
      taskPlaintext: "SILK",
      taskShift: 0,
      taskKeyword: "SUN",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "A gondolier just arrived carrying a sealed letter from our Venetian contact. Encrypted, of course." },
        { speaker: "Bellaso", text: "Same keyword \u2014 SUN. We agreed to use it for all correspondence this month." },
        { speaker: "Bellaso", text: "With a three-letter keyword, each third letter in the message shares the same shift. S, then U, then N, then S again." },
        { speaker: "Bellaso", text: "Decrypt the reply. I am curious what our friend has to say." },
      ],
      responseChoices: [
        { id: "c3ch2s2a", text: "Same keyword for the whole month. I will remember the pattern.", reaction: "Consistency within a period, then change. That is the rhythm of secure communication." },
        { id: "c3ch2s2b", text: "Every third letter shares a shift \u2014 does that create a weakness?", reaction: "Astute observation! With short keywords, yes. That is why longer keywords are better for sensitive messages." },
        { id: "c3ch2s2c", text: "A gondolier courier? That is the most Venetian thing I have ever heard.", reaction: "Wait until you hear about the carrier pigeons trained to fly between bell towers." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 2,
      chapterTitle: "Letters to Venice",
      stepNumber: 3,
      storyText: "Bellaso introduces a new keyword for a different correspondent.",
      taskType: "encrypt",
      taskPlaintext: "HONOR",
      taskShift: 0,
      taskKeyword: "DAWN",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Now here is an important practice, friend. Different correspondents should use different keywords." },
        { speaker: "Bellaso", text: "If Venice uses SUN and Florence uses DAWN, then even if one keyword is compromised, the other channel remains safe." },
        { speaker: "Bellaso", text: "Compartmentalization, friend! Never put all your secrets in one basket." },
        { speaker: "Bellaso", text: "Encrypt HONOR with the keyword DAWN. This goes to our contact in Florence." },
      ],
      responseChoices: [
        { id: "c3ch2s3a", text: "Different keywords for different contacts. Smart security practice.", reaction: "A breach in one channel should never sink the entire network. Remember that always." },
        { id: "c3ch2s3b", text: "How many different keywords do you keep track of?", reaction: "At least a dozen at any given time. My memory is one of my greatest tools." },
        { id: "c3ch2s3c", text: "I can barely remember one keyword, let alone a dozen.", reaction: "Practice, friend! Soon they will stick in your mind like a catchy Neapolitan song." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 2,
      chapterTitle: "Letters to Venice",
      stepNumber: 4,
      storyText: "Bellaso tests with a four-letter keyword on a longer word.",
      taskType: "decrypt",
      taskPlaintext: "MARKET",
      taskShift: 0,
      taskKeyword: "DAWN",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Our Florence contact has replied. Same keyword \u2014 DAWN. Four letters, giving us four distinct shifts." },
        { speaker: "Bellaso", text: "Notice how the keyword DAWN cycles: D-A-W-N-D-A. The fifth letter of the message uses D again, the sixth uses A again." },
        { speaker: "Bellaso", text: "With four shifts cycling, a codebreaker must solve four separate monoalphabetic ciphers simultaneously. Quite a challenge!" },
        { speaker: "Bellaso", text: "Decrypt this message from Florence. Our contact reports on the markets." },
      ],
      responseChoices: [
        { id: "c3ch2s4a", text: "Four interlocking ciphers. The complexity multiplies beautifully.", reaction: "Now you see why even the best codebreakers in Europe threw up their hands in frustration." },
        { id: "c3ch2s4b", text: "So a four-letter keyword creates four sub-ciphers?", reaction: "Precisely! And a five-letter keyword creates five. The more letters, the more tangled the web becomes." },
        { id: "c3ch2s4c", text: "Markets and ciphers. The Renaissance was wild.", reaction: "You have no idea, friend. The markets themselves were more cutthroat than any battlefield." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 3: The Keyword's Power (3 steps) - How keyword length affects security
    {
      cipherId: 3,
      chapterNumber: 3,
      chapterTitle: "The Keyword's Power",
      stepNumber: 1,
      storyText: "Bellaso demonstrates that longer keywords create stronger encryption.",
      taskType: "encrypt",
      taskPlaintext: "CASTLE",
      taskShift: 0,
      taskKeyword: "FLAME",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Let us discuss something critical, friend. The keyword is the heart of my cipher, and its length is its lifeblood." },
        { speaker: "Bellaso", text: "A keyword of 3 letters means every third letter shares the same shift. A spy could separate those letters and attack each group." },
        { speaker: "Bellaso", text: "But a keyword of 5 letters? Now every fifth letter shares a shift. The groups are smaller, the patterns harder to find." },
        { speaker: "Bellaso", text: "Encrypt CASTLE with the keyword FLAME \u2014 five letters, five distinct shifts cycling through your message." },
      ],
      responseChoices: [
        { id: "c3ch3s1a", text: "Longer keyword, more shifts, stronger security. The logic is clear.", reaction: "Clear as Venetian glass! You understand the principle perfectly." },
        { id: "c3ch3s1b", text: "What would a keyword as long as the message itself achieve?", reaction: "Perfection! If the keyword never repeats, the cipher becomes theoretically unbreakable. But sharing such a long key is impractical." },
        { id: "c3ch3s1c", text: "FLAME sounds like a keyword a dramatic Italian would choose.", reaction: "I am dramatic AND Italian, so yes. FLAME it is. Now encrypt!" },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 3,
      chapterTitle: "The Keyword's Power",
      stepNumber: 2,
      storyText: "Bellaso shows how a short keyword can reveal patterns, then asks you to decrypt.",
      taskType: "decrypt",
      taskPlaintext: "TRUST",
      taskShift: 0,
      taskKeyword: "AB",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Now let me show you the danger of a short keyword, friend. Imagine the keyword is just AB." },
        { speaker: "Bellaso", text: "A shifts by 0 \u2014 no change at all! B shifts by 1. So every other letter is unchanged, and the rest shift by just 1." },
        { speaker: "Bellaso", text: "A child could break this. The lesson? Never use a keyword shorter than three letters, and avoid common words." },
        { speaker: "Bellaso", text: "Decrypt this message. The keyword is AB. See how weak it feels." },
      ],
      responseChoices: [
        { id: "c3ch3s2a", text: "A weak keyword undermines the entire system. I see the danger.", reaction: "The strongest vault means nothing if the key is made of paper. Remember this." },
        { id: "c3ch3s2b", text: "So keyword choice is as important as the cipher itself?", reaction: "More important! A brilliant cipher with a foolish keyword is a foolish cipher." },
        { id: "c3ch3s2c", text: "AB as a keyword? That is practically waving a white flag.", reaction: "Ha! Exactly. We might as well hand the enemy a copy of our message and an apology." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 3,
      chapterTitle: "The Keyword's Power",
      stepNumber: 3,
      storyText: "Bellaso emphasizes choosing keywords that are not common words.",
      taskType: "encrypt",
      taskPlaintext: "DUKE",
      taskShift: 0,
      taskKeyword: "WOLF",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "One more lesson about keywords, friend. Never use a common word that a spy might guess." },
        { speaker: "Bellaso", text: "If the Duke uses his own name as the keyword, a clever adversary might try it. Personal names, city names, dates \u2014 all too predictable." },
        { speaker: "Bellaso", text: "Choose something unexpected. Something with no obvious connection to the sender or the message." },
        { speaker: "Bellaso", text: "Encrypt DUKE with the keyword WOLF. The Duke would never choose something so ferocious himself, which is exactly the point." },
        { speaker: "Bellaso", text: "Unpredictability is the soul of a good keyword." },
      ],
      responseChoices: [
        { id: "c3ch3s3a", text: "Avoid predictable keywords. The element of surprise protects us.", reaction: "You think like a true cryptographer now. Unpredictability is your greatest weapon." },
        { id: "c3ch3s3b", text: "Should keywords be random strings of letters then?", reaction: "Ideally, yes. But humans must remember them. A balance between randomness and memorability is best." },
        { id: "c3ch3s3c", text: "WOLF for the Duke? He would not be pleased with that comparison.", reaction: "What the Duke does not know will not hurt him. What his enemies do not know will save him." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 4: Dukes and Diplomats (4 steps) - Diplomatic encryption, Italian politics
    {
      cipherId: 3,
      chapterNumber: 4,
      chapterTitle: "Dukes and Diplomats",
      stepNumber: 1,
      storyText: "Bellaso tells of being hired by the Duke of Milan to protect diplomatic messages.",
      taskType: "encrypt",
      taskPlaintext: "SECRET",
      taskShift: 0,
      taskKeyword: "CROWN",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Let me tell you a story, friend. Last spring, the Duke of Milan hired me to protect his diplomatic correspondence." },
        { speaker: "Bellaso", text: "His rivals in Florence had been intercepting every letter. Bribing couriers. Reading state secrets like bedtime stories." },
        { speaker: "Bellaso", text: "With my cipher and a carefully chosen keyword, his messages became invisible to Florentine eyes." },
        { speaker: "Bellaso", text: "Encrypt SECRET with the keyword CROWN. This is how we protect the affairs of state." },
      ],
      responseChoices: [
        { id: "c3ch4s1a", text: "Your cipher changed the balance of power between the cities.", reaction: "Power belongs to those who control information. The Duke understood this immediately." },
        { id: "c3ch4s1b", text: "Did the Florentines ever break your cipher?", reaction: "They hired their own cryptographer. He spent six months and found nothing. I was flattered." },
        { id: "c3ch4s1c", text: "You basically invented Renaissance cybersecurity.", reaction: "I have no idea what that means, but I love the sound of it!" },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 4,
      chapterTitle: "Dukes and Diplomats",
      stepNumber: 2,
      storyText: "An intercepted Florentine dispatch needs decrypting.",
      taskType: "decrypt",
      taskPlaintext: "ATTACK",
      taskShift: 0,
      taskKeyword: "IRON",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Fortune smiles upon us, friend! Our agents in Florence captured a dispatch from the Medici court." },
        { speaker: "Bellaso", text: "They foolishly used my own cipher against me. My own creation! The audacity." },
        { speaker: "Bellaso", text: "But we know their keyword \u2014 IRON. A Florentine servant sold it for a handful of florins." },
        { speaker: "Bellaso", text: "Decrypt their message. Let us see what the Medici are planning." },
      ],
      responseChoices: [
        { id: "c3ch4s2a", text: "They used your cipher against you? That must sting.", reaction: "It is the highest compliment, friend. But also the highest insult. I will have my revenge through decryption." },
        { id: "c3ch4s2b", text: "A servant sold the keyword? That is the weakest link.", reaction: "Always! The cipher is only as strong as the people who hold the keyword. Human nature is the true vulnerability." },
        { id: "c3ch4s2c", text: "A handful of florins for a state secret? Inflation is real.", reaction: "In Florence, everything has a price. Even betrayal comes remarkably cheap." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 4,
      chapterTitle: "Dukes and Diplomats",
      stepNumber: 3,
      storyText: "Bellaso drafts a treaty in cipher for the Duke.",
      taskType: "encrypt",
      taskPlaintext: "TREATY",
      taskShift: 0,
      taskKeyword: "SILK",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "The Duke now wishes to propose a secret alliance with the Republic of Venice." },
        { speaker: "Bellaso", text: "This message must travel by sea, through waters patrolled by Genoese pirates. If they intercept it, war could erupt." },
        { speaker: "Bellaso", text: "I have chosen the keyword SILK \u2014 a word Venice understands better than any other. The Venetians will know to try it." },
        { speaker: "Bellaso", text: "Encrypt TREATY. The peace of Italy may depend on these six letters." },
      ],
      responseChoices: [
        { id: "c3ch4s3a", text: "The fate of nations, sealed in a cipher. The weight of this is extraordinary.", reaction: "Every letter you encrypt carries the weight of a thousand lives. Never forget that responsibility." },
        { id: "c3ch4s3b", text: "Using SILK as a hint to Venice is clever. A keyword with meaning to the recipient.", reaction: "As long as the meaning is subtle. Too obvious, and the enemy guesses it. A delicate balance." },
        { id: "c3ch4s3c", text: "Genoese pirates? This is getting better than a novel.", reaction: "In Italy, reality is always more dramatic than fiction. Now encrypt before the pirates arrive." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 4,
      chapterTitle: "Dukes and Diplomats",
      stepNumber: 4,
      storyText: "Venice sends a reply to the Duke's proposal.",
      taskType: "decrypt",
      taskPlaintext: "ACCEPT",
      taskShift: 0,
      taskKeyword: "SILK",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "A ship has arrived from Venice! The Doge's personal seal is on the letter. Same keyword \u2014 SILK." },
        { speaker: "Bellaso", text: "I must confess, friend, my hands tremble. The future of Milan rests on this single word." },
        { speaker: "Bellaso", text: "This is why I created my cipher. Not for glory, not for gold \u2014 but for moments like this, when the right word changes history." },
        { speaker: "Bellaso", text: "Decrypt it. Tell me what Venice has decided." },
      ],
      responseChoices: [
        { id: "c3ch4s4a", text: "A cipher that changes history. Your legacy is assured, Bellaso.", reaction: "Legacy matters less to me than the lives my cipher protects. But I appreciate the sentiment." },
        { id: "c3ch4s4b", text: "Your hands are trembling? The great Bellaso, nervous?", reaction: "Even the greatest cryptographer is human, friend. When the stakes are this high, nerves are natural." },
        { id: "c3ch4s4c", text: "No pressure or anything. Just the fate of Milan. Easy.", reaction: "Ha! Under pressure is where we do our best work. Or so I tell myself. Decrypt it!" },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 5: The Tabula Recta (4 steps) - The Vigenere table/square concept
    {
      cipherId: 3,
      chapterNumber: 5,
      chapterTitle: "The Tabula Recta",
      stepNumber: 1,
      storyText: "Bellaso introduces the tabula recta \u2014 a grid that simplifies encryption.",
      taskType: "encrypt",
      taskPlaintext: "MARCH",
      taskShift: 0,
      taskKeyword: "STORM",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Come, friend, let me show you my most beautiful creation \u2014 the tabula recta!" },
        { speaker: "Bellaso", text: "It is a grid of 26 rows and 26 columns. Each row is the alphabet shifted by one more position than the last." },
        { speaker: "Bellaso", text: "To encrypt: find the plaintext letter along the top, the keyword letter along the side. Where they meet is your ciphertext!" },
        { speaker: "Bellaso", text: "It turns the entire cipher into a simple table lookup. Encrypt MARCH using keyword STORM and imagine the grid guiding your fingers." },
      ],
      responseChoices: [
        { id: "c3ch5s1a", text: "A lookup table for encryption. Ingenious simplification.", reaction: "Even a merchant's apprentice can use the tabula recta. That is its power \u2014 accessible brilliance." },
        { id: "c3ch5s1b", text: "So the tabula recta contains all 26 possible Caesar shifts?", reaction: "Precisely! Every row is a different Caesar cipher. My keyword simply tells you which row to use for each letter." },
        { id: "c3ch5s1c", text: "A 26 by 26 grid? That is a LOT of letters.", reaction: "Six hundred and seventy-six letters, to be exact. But beauty often comes in abundance." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 5,
      chapterTitle: "The Tabula Recta",
      stepNumber: 2,
      storyText: "Bellaso explains decryption using the tabula recta.",
      taskType: "decrypt",
      taskPlaintext: "NIGHT",
      taskShift: 0,
      taskKeyword: "FLAME",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "For decryption, you use the tabula recta in reverse, friend." },
        { speaker: "Bellaso", text: "Find the keyword letter along the side. Look across that row until you find the ciphertext letter. The column header gives you the plaintext!" },
        { speaker: "Bellaso", text: "It is like reading a map. The keyword is your compass, the table is your territory." },
        { speaker: "Bellaso", text: "Decrypt this message using keyword FLAME. Let the tabula recta guide you." },
      ],
      responseChoices: [
        { id: "c3ch5s2a", text: "Forward for encryption, reverse for decryption. The table works both ways.", reaction: "Like a door that opens in both directions. One tool, two purposes." },
        { id: "c3ch5s2b", text: "Did people actually carry these tables around?", reaction: "Some carved them into wooden tablets! Others memorized the first few rows and computed the rest mentally." },
        { id: "c3ch5s2c", text: "A cipher with a cheat sheet? Now we are talking.", reaction: "I prefer to call it an 'efficiency tool.' Cheat sheet sounds so undignified." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 5,
      chapterTitle: "The Tabula Recta",
      stepNumber: 3,
      storyText: "Bellaso shows how the table makes alternating between keywords effortless.",
      taskType: "encrypt",
      taskPlaintext: "GUARD",
      taskShift: 0,
      taskKeyword: "EAGLE",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Here is another advantage of the tabula recta, friend. Switching keywords is effortless." },
        { speaker: "Bellaso", text: "With mental arithmetic, changing keywords means recalculating every shift. With the table, you simply look up different rows." },
        { speaker: "Bellaso", text: "A diplomat might use one keyword for the morning dispatch and another for the evening. The table handles both equally." },
        { speaker: "Bellaso", text: "Encrypt GUARD with keyword EAGLE. Five keyword letters, five different rows in the table." },
      ],
      responseChoices: [
        { id: "c3ch5s3a", text: "The table makes keyword changes seamless. Very practical.", reaction: "Practicality is the difference between a clever invention and a useful one." },
        { id: "c3ch5s3b", text: "Could someone reconstruct the keyword from the table if they watched you use it?", reaction: "If they saw which rows you visited, yes! That is why the table must be used in private. Always." },
        { id: "c3ch5s3c", text: "Morning keyword, evening keyword. Spies never rest.", reaction: "Nor do the enemies who hunt them. Vigilance is not optional in this business." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 5,
      chapterTitle: "The Tabula Recta",
      stepNumber: 4,
      storyText: "Bellaso gives a tabula recta mastery challenge.",
      taskType: "decrypt",
      taskPlaintext: "CIPHER",
      taskShift: 0,
      taskKeyword: "QUEST",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "You know what frustrates me, friend? Everyone calls this the 'Vigenere cipher.' Even the tabula recta bears his name!" },
        { speaker: "Bellaso", text: "Blaise de Vigenere gets all the credit, but I published this method first! In 1553!" },
        { speaker: "Bellaso", text: "History is not always fair to inventors. But the cipher itself endures, and that is what matters." },
        { speaker: "Bellaso", text: "Decrypt this word \u2014 the name of the very art we practice. Keyword is QUEST." },
      ],
      responseChoices: [
        { id: "c3ch5s4a", text: "History may forget names, but your work speaks for itself, Bellaso.", reaction: "You are kind, friend. And correct. The work is immortal, even if the name fades." },
        { id: "c3ch5s4b", text: "Wait, so the Vigenere cipher is really the Bellaso cipher?", reaction: "FINALLY someone who listens! Yes! It should be named after ME! Write that down somewhere." },
        { id: "c3ch5s4c", text: "That is rough, Bellaso. Want me to write a letter of complaint?", reaction: "Encrypt it first. We would not want Vigenere to intercept it." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 6: Shadows Over Florence (4 steps) - Espionage, intercepted messages
    {
      cipherId: 3,
      chapterNumber: 6,
      chapterTitle: "Shadows Over Florence",
      stepNumber: 1,
      storyText: "Bellaso learns of a Florentine spy network and must encrypt a warning.",
      taskType: "encrypt",
      taskPlaintext: "DANGER",
      taskShift: 0,
      taskKeyword: "RUBY",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Dark news, friend. Our agents in Florence report a network of spies operating within Milan's walls." },
        { speaker: "Bellaso", text: "They have been copying our dispatches, studying our cipher. Fortunately, without the keyword, they see only gibberish." },
        { speaker: "Bellaso", text: "But we must warn our allies. A single compromised keyword could unravel months of secret correspondence." },
        { speaker: "Bellaso", text: "Encrypt DANGER with keyword RUBY. This warning must reach the garrison before nightfall." },
      ],
      responseChoices: [
        { id: "c3ch6s1a", text: "Spies in Milan. The cipher is our shield now more than ever.", reaction: "Exactly. In times of danger, the cipher is not a luxury \u2014 it is survival." },
        { id: "c3ch6s1b", text: "If they are studying the cipher, could they deduce the method?", reaction: "The method is no secret. But without the keyword, it is like having a lock with no key. Useless." },
        { id: "c3ch6s1c", text: "Spies, danger, rubies. My life was much calmer before I met you.", reaction: "Calmer, perhaps. But infinitely more boring. Admit it." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 6,
      chapterTitle: "Shadows Over Florence",
      stepNumber: 2,
      storyText: "An intercepted enemy message needs decrypting urgently.",
      taskType: "decrypt",
      taskPlaintext: "AMBUSH",
      taskShift: 0,
      taskKeyword: "GOLD",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Our counter-spies have intercepted a Florentine dispatch! They found it sewn into a courier's boot." },
        { speaker: "Bellaso", text: "A defector provided the keyword \u2014 GOLD. The Florentines pay their spies in gold, so they use the word as a reminder." },
        { speaker: "Bellaso", text: "Terribly unimaginative keyword choice, but their loss is our gain." },
        { speaker: "Bellaso", text: "Decrypt it immediately, friend. Lives hang in the balance." },
      ],
      responseChoices: [
        { id: "c3ch6s2a", text: "Sewn into a boot? These spies are dedicated.", reaction: "Desperation breeds creativity, friend. Never underestimate a cornered spy." },
        { id: "c3ch6s2b", text: "GOLD as a keyword because they pay in gold? That is a terrible practice.", reaction: "The worst! I would never make such a predictable choice. This is why Florence loses the cipher war." },
        { id: "c3ch6s2c", text: "I hope the courier washed his feet first.", reaction: "Focus, friend! The smell of the message is less important than its contents." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 6,
      chapterTitle: "Shadows Over Florence",
      stepNumber: 3,
      storyText: "Bellaso sends a counter-intelligence report using a new keyword.",
      taskType: "encrypt",
      taskPlaintext: "STRIKE",
      taskShift: 0,
      taskKeyword: "SHADE",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "We now know their plan, friend. It is time to turn their own tactics against them." },
        { speaker: "Bellaso", text: "I am sending counter-intelligence to our garrison. We will use a new keyword \u2014 SHADE \u2014 because this operation moves in the shadows." },
        { speaker: "Bellaso", text: "Changing keywords after a security breach is essential. The old keyword dies, a new one is born." },
        { speaker: "Bellaso", text: "Encrypt STRIKE with keyword SHADE. Let the shadows work for us now." },
      ],
      responseChoices: [
        { id: "c3ch6s3a", text: "Keyword rotation after a breach. Good operational security.", reaction: "A keyword is like milk, friend. It has an expiration date. Use it while fresh, then replace it." },
        { id: "c3ch6s3b", text: "How do you safely communicate the new keyword to your allies?", reaction: "A trusted messenger, in person, who memorizes the word and never writes it down. The old way is still the best." },
        { id: "c3ch6s3c", text: "SHADE for a shadow operation? Your keywords are getting very thematic.", reaction: "A good keyword tells a story, friend. Even if only I appreciate the poetry." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 6,
      chapterTitle: "Shadows Over Florence",
      stepNumber: 4,
      storyText: "The spy network is dismantled and a final encrypted confirmation arrives.",
      taskType: "decrypt",
      taskPlaintext: "SAFE",
      taskShift: 0,
      taskKeyword: "SHADE",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "A rider has arrived from the garrison, breathless and grinning. He carries one word, encrypted with our new keyword SHADE." },
        { speaker: "Bellaso", text: "If this says what I think it says, the Florentine spy network has been dismantled." },
        { speaker: "Bellaso", text: "My cipher protected Milan when steel and stone could not. That, friend, is the true power of cryptography." },
        { speaker: "Bellaso", text: "Decrypt it. Let us hear the good news together." },
      ],
      responseChoices: [
        { id: "c3ch6s4a", text: "The cipher saved Milan. You should be proud, Bellaso.", reaction: "I am proud of us both, friend. You decrypted when it mattered most. That takes nerve." },
        { id: "c3ch6s4b", text: "So cryptography won a shadow war without a single sword drawn?", reaction: "The best victories are the ones nobody sees. That is the cryptographer's creed." },
        { id: "c3ch6s4c", text: "A breathless, grinning rider? That is either very good news or very bad news.", reaction: "In Italy, we grin in either case. Decrypt it and find out which." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 7: The Unbreakable Code (3 steps) - Why frequency analysis fails
    {
      cipherId: 3,
      chapterNumber: 7,
      chapterTitle: "The Unbreakable Code",
      stepNumber: 1,
      storyText: "Bellaso explains why his cipher defeated frequency analysis for centuries.",
      taskType: "encrypt",
      taskPlaintext: "HIDDEN",
      taskShift: 0,
      taskKeyword: "SHIELD",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "For three hundred years, friend \u2014 three hundred years! \u2014 no one could break my cipher. Do you know why?" },
        { speaker: "Bellaso", text: "Frequency analysis. The Arabs perfected it centuries ago. In any normal text, E is the most common letter, then T, then A." },
        { speaker: "Bellaso", text: "With Caesar's cipher, the most common ciphertext letter maps to E. Simple. But with my cipher? The letter E encrypts differently every time!" },
        { speaker: "Bellaso", text: "Encrypt HIDDEN with keyword SHIELD. Six letters, six different shifts. The frequencies are scrambled beyond recognition." },
      ],
      responseChoices: [
        { id: "c3ch7s1a", text: "Three centuries unbroken. That is an extraordinary achievement.", reaction: "I do not like to boast. Actually, that is a lie. I love to boast. Three centuries!" },
        { id: "c3ch7s1b", text: "So each letter of the keyword creates its own frequency distribution?", reaction: "Exactly! And those distributions overlap and cancel each other out. The total pattern is flat. Beautiful chaos." },
        { id: "c3ch7s1c", text: "Three hundred years? You must have been insufferable at parties.", reaction: "I was spectacular at parties. Everyone wanted to hear about the unbreakable code. Well, almost everyone." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 7,
      chapterTitle: "The Unbreakable Code",
      stepNumber: 2,
      storyText: "Bellaso demonstrates how the same letter encrypts differently.",
      taskType: "decrypt",
      taskPlaintext: "LETTER",
      taskShift: 0,
      taskKeyword: "WOLF",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Consider this beautiful fact, friend. In the word LETTER, the letter T appears twice." },
        { speaker: "Bellaso", text: "With a keyword like WOLF, the first T pairs with keyword letter L, and the second T pairs with W. Different shifts!" },
        { speaker: "Bellaso", text: "So the two T's in the plaintext become two completely different letters in the ciphertext. A spy sees no pattern at all." },
        { speaker: "Bellaso", text: "Decrypt this message. Keyword is WOLF. Notice how repeated plaintext letters vanish in the encryption." },
      ],
      responseChoices: [
        { id: "c3ch7s2a", text: "Repeated letters disappear. That is what makes it unbreakable.", reaction: "Precisely. The cipher destroys the very patterns that codebreakers depend on. It is beautiful destruction." },
        { id: "c3ch7s2b", text: "So a codebreaker cannot even identify repeated words in the original?", reaction: "Not easily. Though if the keyword length divides evenly into the word spacing... but I get ahead of myself." },
        { id: "c3ch7s2c", text: "WOLF as a keyword? Very mysterious. Very brooding.", reaction: "I chose it because wolves are cunning and patient. Like a good cryptographer." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 7,
      chapterTitle: "The Unbreakable Code",
      stepNumber: 3,
      storyText: "Bellaso proudly declares the cipher le chiffre indechiffrable.",
      taskType: "encrypt",
      taskPlaintext: "LEGEND",
      taskShift: 0,
      taskKeyword: "CROWN",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "They called it 'le chiffre indechiffrable' \u2014 the unbreakable cipher. The French, giving credit to the wrong man, but at least they recognized the achievement." },
        { speaker: "Bellaso", text: "For centuries, every cryptanalyst who tried to break it failed. Kings, generals, mathematicians \u2014 all defeated by a simple keyword." },
        { speaker: "Bellaso", text: "Of course, nothing is truly unbreakable. But it held longer than any cipher before it, and that is something." },
        { speaker: "Bellaso", text: "Encrypt LEGEND with keyword CROWN. Because that is what this cipher has become \u2014 a legend." },
        { speaker: "Bellaso", text: "And legends, friend, are immortal." },
      ],
      responseChoices: [
        { id: "c3ch7s3a", text: "Le chiffre indechiffrable. Your cipher earned its title.", reaction: "Even if they attached the wrong name to it. Vigenere! Bah. But the title itself? I accept it with pride." },
        { id: "c3ch7s3b", text: "You said nothing is truly unbreakable. Was it eventually broken?", reaction: "Ah, friend. That is a story for another chapter. Let us enjoy the glory a moment longer." },
        { id: "c3ch7s3c", text: "A legend? You are really leaning into the dramatic storytelling.", reaction: "I am Italian, friend. Dramatic storytelling is not a choice. It is a birthright." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 8: Kasiski's Ghost (4 steps) - Cryptanalysis and weaknesses
    {
      cipherId: 3,
      chapterNumber: 8,
      chapterTitle: "Kasiski's Ghost",
      stepNumber: 1,
      storyText: "Bellaso reluctantly admits that Friedrich Kasiski found a weakness.",
      taskType: "decrypt",
      taskPlaintext: "REPEAT",
      taskShift: 0,
      taskKeyword: "SUN",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "I must tell you something that pains me, friend. In 1863, a Prussian officer named Friedrich Kasiski found a crack in my perfect cipher." },
        { speaker: "Bellaso", text: "He noticed that when a word in the plaintext aligns with the same position in the repeating keyword, it creates identical ciphertext." },
        { speaker: "Bellaso", text: "These repeated patterns reveal the keyword length. And once you know the keyword length, you can separate the letters into groups and attack each with frequency analysis." },
        { speaker: "Bellaso", text: "Decrypt this message with keyword SUN. The short keyword makes these repetitions more likely." },
      ],
      responseChoices: [
        { id: "c3ch8s1a", text: "Repeated patterns from the keyword cycling. The Achilles heel.", reaction: "Every great creation has a vulnerability. Even my cipher. Even Achilles. At least I lasted longer." },
        { id: "c3ch8s1b", text: "So longer keywords reduce the chance of repetition?", reaction: "Exactly! A longer keyword means larger gaps between repeats. Harder to spot, harder to exploit." },
        { id: "c3ch8s1c", text: "A Prussian broke your cipher? That must have been embarrassing.", reaction: "I was already dead for three centuries, friend. So I was spared the embarrassment. Small mercies." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 8,
      chapterTitle: "Kasiski's Ghost",
      stepNumber: 2,
      storyText: "Bellaso explains how the Kasiski examination works step by step.",
      taskType: "encrypt",
      taskPlaintext: "WEAK",
      taskShift: 0,
      taskKeyword: "SUN",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Let me explain Kasiski's method, friend. It is clever, I must admit \u2014 grudgingly." },
        { speaker: "Bellaso", text: "Step one: find repeated sequences in the ciphertext. Step two: measure the distances between those repetitions." },
        { speaker: "Bellaso", text: "Step three: the keyword length is likely a common factor of those distances. Once you have the length, you split the ciphertext into that many groups." },
        { speaker: "Bellaso", text: "Each group is then a simple Caesar cipher. Encrypt WEAK with keyword SUN. Short keywords are the most vulnerable to this attack." },
      ],
      responseChoices: [
        { id: "c3ch8s2a", text: "Find repetitions, measure distances, factor them. Methodical and devastating.", reaction: "Like a surgeon with a scalpel. Precise, patient, and ultimately fatal to the cipher's secrecy." },
        { id: "c3ch8s2b", text: "So the keyword length is the critical secret, not just the keyword itself?", reaction: "Both matter, but yes \u2014 knowing the length is the first domino. Once it falls, the rest follow." },
        { id: "c3ch8s2c", text: "Kasiski sounds like the kind of person I would not want to play cards with.", reaction: "He counted cards, counted letters, counted everything. A very tedious dinner guest, I imagine." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 8,
      chapterTitle: "Kasiski's Ghost",
      stepNumber: 3,
      storyText: "Bellaso teaches how to mitigate Kasiski's attack.",
      taskType: "decrypt",
      taskPlaintext: "DEFEND",
      taskShift: 0,
      taskKeyword: "SHIELD",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "But do not despair, friend! There are ways to resist Kasiski's examination." },
        { speaker: "Bellaso", text: "First: use longer keywords. A keyword of six letters creates far fewer detectable repetitions than one of three." },
        { speaker: "Bellaso", text: "Second: avoid using common words as keywords. Random-seeming combinations are best." },
        { speaker: "Bellaso", text: "Third: keep messages short. The fewer letters, the fewer chances for patterns to emerge. Decrypt this with keyword SHIELD \u2014 a strong six-letter keyword." },
        { speaker: "Bellaso", text: "The cipher can still resist attack if used wisely. It is the user, not the method, that determines security." },
      ],
      responseChoices: [
        { id: "c3ch8s3a", text: "Longer keywords, random choices, short messages. Defense in depth.", reaction: "Exactly. No single measure is perfect, but together they create a formidable barrier." },
        { id: "c3ch8s3b", text: "So the cipher's weakness is really about how it is used?", reaction: "As with most things in life, friend. A sharp sword is useless in clumsy hands." },
        { id: "c3ch8s3c", text: "SHIELD against Kasiski. I see what you did there.", reaction: "I may be three centuries dead, but my sense of humor is eternal." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 8,
      chapterTitle: "Kasiski's Ghost",
      stepNumber: 4,
      storyText: "Bellaso accepts that all ciphers evolve and challenges you with a final exercise.",
      taskType: "encrypt",
      taskPlaintext: "EVOLVE",
      taskShift: 0,
      taskKeyword: "DAWN",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "In the end, friend, every cipher is eventually broken. That is the nature of this eternal dance between maker and breaker." },
        { speaker: "Bellaso", text: "But each cipher advances the art. My work inspired Kasiski, who inspired better ciphers, which inspired better attacks." },
        { speaker: "Bellaso", text: "Cryptography does not stand still. It evolves. And that evolution is my true legacy." },
        { speaker: "Bellaso", text: "Encrypt EVOLVE with keyword DAWN. A new day rises for every generation of codemakers." },
      ],
      responseChoices: [
        { id: "c3ch8s4a", text: "An eternal arms race between ciphers and codebreakers. A beautiful cycle.", reaction: "Beautiful and necessary. Without the breakers, the makers grow complacent. Without the makers, there is nothing to protect." },
        { id: "c3ch8s4b", text: "Your cipher lasted three centuries. What could last longer?", reaction: "Perhaps a cipher that uses a keyword as long as the message itself. But that is a dream for future generations." },
        { id: "c3ch8s4c", text: "EVOLVE with DAWN? That sounds like a motivational poster.", reaction: "In Italy, we invented motivational posters. We just called them frescoes." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 9: Legacy of the Renaissance (4 steps) - Connecting to modern encryption
    {
      cipherId: 3,
      chapterNumber: 9,
      chapterTitle: "Legacy of the Renaissance",
      stepNumber: 1,
      storyText: "Bellaso connects his cipher to the concept of modern encryption keys.",
      taskType: "encrypt",
      taskPlaintext: "FUTURE",
      taskShift: 0,
      taskKeyword: "FLAME",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Friend, I want to tell you about the future. Not my future \u2014 yours." },
        { speaker: "Bellaso", text: "One day, machines will encrypt messages using keys not of 5 or 6 letters, but of hundreds. Thousands, even." },
        { speaker: "Bellaso", text: "The principle will be the same as my cipher: a key that determines how each piece of the message is transformed. But the scale will be unimaginable." },
        { speaker: "Bellaso", text: "Encrypt FUTURE with keyword FLAME. You stand at the bridge between my Renaissance and your modern world." },
      ],
      responseChoices: [
        { id: "c3ch9s1a", text: "Keys of thousands of characters. The principle endures even at that scale.", reaction: "That is what makes it timeless. The idea transcends the technology. My keyword concept lives on in every encrypted message." },
        { id: "c3ch9s1b", text: "Machines that encrypt? You have a wild imagination, Bellaso.", reaction: "Every impossibility is just a future certainty waiting for its moment. Mark my words." },
        { id: "c3ch9s1c", text: "You are being awfully philosophical for a cipher lesson.", reaction: "I am Italian and a genius. Philosophy is an occupational hazard." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 9,
      chapterTitle: "Legacy of the Renaissance",
      stepNumber: 2,
      storyText: "Bellaso discusses the one-time pad \u2014 the ultimate evolution of his idea.",
      taskType: "decrypt",
      taskPlaintext: "RANDOM",
      taskShift: 0,
      taskKeyword: "QUEST",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "I mentioned a keyword as long as the message itself, friend. That concept has a name: the one-time pad." },
        { speaker: "Bellaso", text: "If the keyword is truly random, as long as the message, and never reused \u2014 the cipher is mathematically unbreakable. Not three centuries unbreakable. Forever unbreakable." },
        { speaker: "Bellaso", text: "The problem? Sharing such a long, random key is enormously difficult. But the principle? It is my keyword concept taken to its logical perfection." },
        { speaker: "Bellaso", text: "Decrypt this with keyword QUEST. Even our short keywords echo in the halls of future mathematics." },
      ],
      responseChoices: [
        { id: "c3ch9s2a", text: "A keyword as long as the message, never reused. Perfect security from a simple idea.", reaction: "And that simple idea started right here, in this workshop. From my quill to mathematical proof." },
        { id: "c3ch9s2b", text: "How would you share a key that long?", reaction: "Couriers carrying books of random letters. Governments actually did this during wars. Cumbersome, but unbreakable." },
        { id: "c3ch9s2c", text: "One-time pad? Sounds like a Renaissance notepad.", reaction: "In a way, it is! A notepad of chaos. Use each page once, then burn it." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 9,
      chapterTitle: "Legacy of the Renaissance",
      stepNumber: 3,
      storyText: "Bellaso reflects on how his work laid the foundation for all modern cryptography.",
      taskType: "encrypt",
      taskPlaintext: "ORIGIN",
      taskShift: 0,
      taskKeyword: "IRON",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Every modern cipher \u2014 every one \u2014 uses the same core idea, friend: a secret key that transforms a message." },
        { speaker: "Bellaso", text: "Whether the key is three letters or three million, the concept is identical. A shared secret between sender and receiver." },
        { speaker: "Bellaso", text: "I did not just create a cipher. I created a framework. A way of thinking about secrecy that will outlast empires." },
        { speaker: "Bellaso", text: "Encrypt ORIGIN with keyword IRON. Because this workshop is where it all began." },
      ],
      responseChoices: [
        { id: "c3ch9s3a", text: "A framework for all future encryption. Your legacy is vast, Bellaso.", reaction: "And you are part of it now, friend. Every cipher you solve carries a piece of this workshop forward." },
        { id: "c3ch9s3b", text: "From a Renaissance workshop to global encryption. The journey is staggering.", reaction: "Great journeys always begin in small rooms with stubborn people and too much candlelight." },
        { id: "c3ch9s3c", text: "You invented the concept of encryption keys? Can I get your autograph?", reaction: "I will sign it in cipher, naturally. You will have to decrypt my signature." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 9,
      chapterTitle: "Legacy of the Renaissance",
      stepNumber: 4,
      storyText: "Bellaso looks to the future with hope and gives a final reflection exercise.",
      taskType: "decrypt",
      taskPlaintext: "SPARK",
      taskShift: 0,
      taskKeyword: "EAGLE",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Every great fire, friend, begins with a single spark." },
        { speaker: "Bellaso", text: "My cipher was that spark. It ignited a flame that burned through centuries of cryptographic advancement." },
        { speaker: "Bellaso", text: "From the tabula recta to machines I cannot imagine, the fire I lit still burns." },
        { speaker: "Bellaso", text: "Decrypt this with keyword EAGLE. It names what my humble workshop gave to the world." },
      ],
      responseChoices: [
        { id: "c3ch9s4a", text: "A spark that lit centuries of progress. A perfect metaphor.", reaction: "And now that spark lives in you. Carry it forward, friend. The fire must never go out." },
        { id: "c3ch9s4b", text: "From Renaissance Italy to the entire world. That is quite a reach.", reaction: "Ideas have no borders, friend. They fly farther than any eagle, faster than any ship." },
        { id: "c3ch9s4c", text: "Should I be worried about fire safety in this wooden workshop?", reaction: "The only fire here is intellectual, friend. Though I should probably move those candles." },
      ],
      stepType: "dialogue_task",
    },

    // Chapter 10: The Master's Final Cipher (5 steps) - Mastery test, farewell
    {
      cipherId: 3,
      chapterNumber: 10,
      chapterTitle: "The Master's Final Cipher",
      stepNumber: 1,
      storyText: "Bellaso announces the final mastery trial with mixed challenges.",
      taskType: "encrypt",
      taskPlaintext: "HONOR",
      taskShift: 0,
      taskKeyword: "CROWN",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "We have arrived at the end, friend. Ten chapters. Dozens of encryptions and decryptions. You have grown beyond anything I imagined." },
        { speaker: "Bellaso", text: "This final chapter is your trial of mastery. Mixed tasks, different keywords, no warnings." },
        { speaker: "Bellaso", text: "Prove that you can handle any keyword, any word, any challenge I set before you." },
        { speaker: "Bellaso", text: "We begin with a word that describes what you have shown throughout this journey. Encrypt HONOR with keyword CROWN." },
      ],
      responseChoices: [
        { id: "c3ch10s1a", text: "The final trial. I am ready, Bellaso. You have prepared me well.", reaction: "I gave you the tools, friend. The skill? That is entirely yours. Now prove it." },
        { id: "c3ch10s1b", text: "Mixed challenges with no warnings? What happens if I struggle?", reaction: "You will not struggle. I have watched you grow. But if you stumble, you rise and try again." },
        { id: "c3ch10s1c", text: "A mastery trial? Can I get a study break first?", reaction: "You have been studying for ten chapters, friend. The break comes after. Encrypt!" },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 10,
      chapterTitle: "The Master's Final Cipher",
      stepNumber: 2,
      storyText: "Bellaso tests decryption with a word that evokes the full journey.",
      taskType: "decrypt",
      taskPlaintext: "MASTER",
      taskShift: 0,
      taskKeyword: "WOLF",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Now a decryption. Keyword WOLF \u2014 four letters, four shifts cycling through the message." },
        { speaker: "Bellaso", text: "By now, you should feel the keyword's rhythm intuitively. W-O-L-F, W-O-L-F, repeating endlessly." },
        { speaker: "Bellaso", text: "Decrypt this word. It describes what you are becoming with each challenge you complete." },
      ],
      responseChoices: [
        { id: "c3ch10s2a", text: "The rhythm of the keyword is second nature now.", reaction: "That is mastery, friend. When the complex becomes natural. You have arrived." },
        { id: "c3ch10s2b", text: "Four shifts cycling. I can almost see the tabula recta in my mind.", reaction: "When you see the table without looking at it, the cipher has become part of you." },
        { id: "c3ch10s2c", text: "WOLF again? You really like that keyword.", reaction: "Wolves are loyal, clever, and they hunt in packs. Like good cryptographers." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 10,
      chapterTitle: "The Master's Final Cipher",
      stepNumber: 3,
      storyText: "Bellaso gives a challenging encryption with a six-letter keyword.",
      taskType: "encrypt",
      taskPlaintext: "LEGACY",
      taskShift: 0,
      taskKeyword: "SHIELD",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "A six-letter keyword now, friend. SHIELD. The strongest defense I can offer you." },
        { speaker: "Bellaso", text: "Six shifts, six different transformations for every group of six letters. This is the kind of keyword that kept my cipher unbroken." },
        { speaker: "Bellaso", text: "Encrypt LEGACY. Because that is what we are building together in this final chapter." },
        { speaker: "Bellaso", text: "Your legacy and mine, intertwined through the art of the cipher." },
      ],
      responseChoices: [
        { id: "c3ch10s3a", text: "Our legacies intertwined. I will carry your teaching forward.", reaction: "That is all any teacher can hope for, friend. That the student surpasses the master." },
        { id: "c3ch10s3b", text: "SHIELD with six letters \u2014 the maximum keyword strength we have practiced.", reaction: "And you handle it with ease. That tells me everything I need to know about your readiness." },
        { id: "c3ch10s3c", text: "LEGACY sounds very grand for someone who just learned to encrypt.", reaction: "You underestimate yourself, friend. You have earned every letter of that word." },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 10,
      chapterTitle: "The Master's Final Cipher",
      stepNumber: 4,
      storyText: "Bellaso gives a penultimate decryption challenge.",
      taskType: "decrypt",
      taskPlaintext: "BRAVE",
      taskShift: 0,
      taskKeyword: "STORM",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "Almost there, friend. One more decryption before the final test." },
        { speaker: "Bellaso", text: "Keyword STORM \u2014 a word that suits this moment. We have weathered storms together, you and I." },
        { speaker: "Bellaso", text: "Through spies and diplomats, through tables and tabulas, through Kasiski's ghost and the unbreakable code." },
        { speaker: "Bellaso", text: "Decrypt this word. It describes the quality you needed most to reach this point." },
      ],
      responseChoices: [
        { id: "c3ch10s4a", text: "Through every storm, the cipher held. And so did I.", reaction: "You weathered it all, friend. Not everyone who enters this workshop makes it to the end." },
        { id: "c3ch10s4b", text: "We have covered an incredible amount of ground together.", reaction: "From the first keyword to the last decryption. The journey was as important as the destination." },
        { id: "c3ch10s4c", text: "A storm before the finale? You really know how to build suspense.", reaction: "I told you \u2014 dramatic storytelling is an Italian birthright. Now decrypt!" },
      ],
      stepType: "dialogue_task",
    },
    {
      cipherId: 3,
      chapterNumber: 10,
      chapterTitle: "The Master's Final Cipher",
      stepNumber: 5,
      storyText: "The final test. Bellaso asks you to decrypt the word that defines your transformation.",
      taskType: "decrypt",
      taskPlaintext: "FORGED",
      taskShift: 0,
      taskKeyword: "BLADE",
      taskCiphertext: "",
      speaker: "Bellaso",
      speakerAvatar: "bellaso",
      dialogueLines: [
        { speaker: "Bellaso", text: "This is it, friend. The final word. The last test." },
        { speaker: "Bellaso", text: "I chose the keyword BLADE for this moment. A blade is shaped through fire and hammering, just as you have been shaped through challenge and practice." },
        { speaker: "Bellaso", text: "The word itself describes what has happened to you across these ten chapters. You arrived as raw metal. You leave as something stronger." },
        { speaker: "Bellaso", text: "Decrypt it. Speak it aloud. And know that you have earned your place among the finest cryptographers in all of Europe." },
        { speaker: "Bellaso", text: "It has been my greatest honor, friend. Now go forth and guard the secrets of the world. Arrivederci." },
      ],
      responseChoices: [
        { id: "c3ch10s5a", text: "The honor has been mine, Bellaso. I will carry this knowledge forever.", reaction: "And it will carry you. Through every challenge, every secret, every cipher yet unwritten. Arrivederci, friend." },
        { id: "c3ch10s5b", text: "From the workshop to mastery. Thank you for this incredible journey.", reaction: "The journey does not end here. It only changes direction. Go and build upon what we have started together." },
        { id: "c3ch10s5c", text: "Do I finally get a Renaissance diploma for this?", reaction: "You get something far greater than parchment. You get the knowledge to protect any secret in the world. Now go. Forge your own legacy." },
      ],
      stepType: "dialogue_task",
    },
  ];

  const stepsWithCiphertext = storySteps.map((step) => {
    let ciphertext = "";
    if (step.cipherId === 1) {
      ciphertext = caesarCipher.encrypt(step.taskPlaintext, { shift: step.taskShift });
    } else if (step.cipherId === 2) {
      ciphertext = atbashCipher.encrypt(step.taskPlaintext, {});
    } else if (step.cipherId === 3) {
      ciphertext = vigenereCipher.encrypt(step.taskPlaintext, { keyword: step.taskKeyword || "KEY" });
    }
    return { ...step, taskCiphertext: ciphertext };
  });

  const finalSteps = filterCipherId
    ? stepsWithCiphertext.filter(s => s.cipherId === filterCipherId)
    : stepsWithCiphertext;

  if (finalSteps.length > 0) {
    await db.insert(storyContent).values(finalSteps);
  }

  console.log(`Story content seeded successfully (${finalSteps.length} steps)`);
}

async function seedStoryContentForCipher(cipherId: number) {
  await seedStoryContent(cipherId);
}
